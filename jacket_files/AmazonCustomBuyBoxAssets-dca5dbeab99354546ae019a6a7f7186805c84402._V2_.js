(function(s,B,u){s.execute(function(){(function(){s.when("A","ready").register("ac-base",function(l){var j=l.$;l.on("pc-single-text-loaded",function(){j("html").hasClass("a-canvas")||(j(".pc-customization-disabled").addClass("active"),j(".pc-customization-enabled").remove())});return{getASIN:function(){return j(".ac-mobile-app").length>=1?j(".ac-meta-data").find("#asin").val():j("#ASIN").val()},getOfferListingID:function(){return j("#offerListingID").val()},getMerchantID:function(){return j(".ac-mobile-app").length>=
1?j(".ac-meta-data").find("#merchantID").val():j("#merchantID").val()},isApp:function(){return j(".ac-mobile-app").length>=1}}});s.when("A","ac-base","ready").execute(function(l,j){function h(b){var e="/gp/product/features/log-message.html/ref="+b.refTag,f;a++;f="ajax_amzon_custom_log"+a;if(B.ue){var c=B.uet;c("tc",f)}d.ajax({type:"POST",url:e,dataType:"json",data:{component:b.component,message:b.msg,isMetricsNeeded:b.isMetricsNeeded},success:function(b){if(B.ue){var a=B.ues,e=B.uet,c=B.uex;a("id",
f,b.result.rid);a("t0",f,new Date);a("ctb",f,"1");e("cf",f);e("be",f);c("ld",f)}}})}var d=l.$,a=0,g=j.getASIN(),c={CustomizeNowClick:{refTag:"amz_custom_cn_clk_"+g,component:"Amazon Custom customize now button",msg:"Amazon Custom customize now button clicked",isMetricsNeeded:!1},AddToCartClick:{refTag:"amz_custom_atc_clk_"+g,component:"Amazon Custom Add to cart",msg:"Amazon Custom add to cart clicked",isMetricsNeeded:!1},CloseClick:{refTag:"amz_custom_cls_clk_"+g,component:"Amazon Custom Add to cart",
msg:"Amazon Custom close button clicked",isMetricsNeeded:!1},FontChange:{refTag:"amz_custom_font_chg_"+g,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},FontColorChange:{refTag:"amz_custom_color_chg_"+g,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},logCustomImageTabClick:{refTag:"pc_ci_tab_clk",component:"Custom image",msg:"Custom Image click",isMetricsNeeded:!1},logVendorGalleryTabClick:{refTag:"pc_ig_tab_clk",
component:"Vendor image gallery",msg:"Vendor image gallery click",isMetricsNeeded:!1},logAddTextTabClick:{refTag:"pc_at_tab_clk",component:"Add Text",msg:"Add Text Click",isMetricsNeeded:!1},logUseThisDesignClick:{refTag:"pc_utdbtn_clk_"+g,component:"UseThisDesignClick",msg:"Use this design click",isMetricsNeeded:!0},logS3TextUploadError:{refTag:"pc_s3_txt_err",component:"S3TextUploadError",msg:"S3 error on text upload",isMetricsNeeded:!0},logS3ImageUploadError:{refTag:"pc_s3_img_pst_err",component:"S3ImageUploadError",
msg:"S3 error on image upload",isMetricsNeeded:!0},logUseThisDesignKindleHucClick:{refTag:"pc_utdgbtn_clk_kin_huc_"+g,component:"UseThisDesignKindleHucClick",msg:"Use this Design From Kindle Click",isMetricsNeeded:!1}};l.on("amazon-custom-popup-open",function(){this.popupOpenTime=new Date});l.on("amazon-custom-popup-close",function(b){b-=this.popupOpenTime;b/=1E3;B.ue.count("pcSingleTextTimer",b);B.ue.count("pcSingleTextTimer")});l.on("logVendor-ref-Click",function(b){b={refTag:"pc_vi_"+b.categoryName.substring(0,
4)+"_"+g,component:"theme for selected vendor image",msg:"Theme selected for vendor image is "+b.categoryName,isMetricsNeeded:!1};h(b)});l.on("amazon-custom-log-ref-tag",function(b){b!==u&&(b=c[b],b!==u&&h(b))})})})();(function(){s.when("A","fabric-js","ac-base","ac-utils","ac-constants","ac-simple-textInput","ac-gallery","ac-image-gallery","ac-text-image","ac-error-handling","ready").register("ac-canvas",function(l,j,h,d,a,g,c,b,e,f){var k=l.$;return function(a,c){var i=this;i.isActive=!1;i.surface=
c;i.childCanvas=[];i.canvas=a;i.isChild=i.canvas.isChild?i.canvas.isChild:!1;i.controls={};i.canvasObjects=[];i.name="";i.canvas.index!==u?(i.id=i.surface.id+"-area-"+i.canvas.index,i.data=c.data.areas[i.canvas.index],i.name=i.data.name):(i.id=i.surface.id+"-primary",i.isChild=!1);i.currentSelectedObject=null;i.enableBuyBox=!1;i.renderAll=function(b){b=b?b:1;i.isChild?(i.canvas.renderAll(),setTimeout(function(){d.debounce(i.surface.updatePrimaryCanvas(i.canvas.index),25)},b)):i.canvas.renderAll()};
i.getObjects=function(){return i.canvas.getObjects()};i.toDataURL=function(){try{i.canvas.toDataURL()}catch(b){return null}};i.verifyScaling=function(){i.canvas.off("object:modified");i.canvas.on("object:modified",function(b){b=b.target;i.renderAll();b.type!=="text"&&(b.scaleX>1.5||b.scaleY>1.5?f.show("pc-scale-warning-message"):(b.scaleX<1.5||b.scaleY<1.5)&&f.hide(),i.canvas.calcOffset());i.dragResetObject()})};i.dragResetObject=function(){var b=parseInt(i.canvas.width,10),a=parseInt(i.canvas.height,
10),e=new j.Rect({left:0,top:0,width:b,height:a,opacity:0}),c=new j.Point(0,0),k=new j.Point(0+b,0+a);i.canvas.add(e);c=i.canvas.getActiveObject().intersectsWithObject(e)||i.canvas.getActiveObject().isContainedWithinRect(c,k);i.canvas.remove(e);c||(i.canvas.getActiveObject().set({left:0+(b/2-i.canvas.getActiveObject().width/2),top:0+(a/2-i.canvas.getActiveObject().height/2),scaleX:1,scaleY:1,angle:0}),f.hide(),i.canvas.getActiveObject().setCoords(),i.canvas.calcOffset(),i.renderAll(50))};i.clear=
function(){i.canvas.clear();for(var b in i.controls)if(i.controls.hasOwnProperty(b)&&i.controls[b].cleared)i.controls[b].cleared(),i.controls[b].isControlActive=!1;i.renderAll()};i.childCanvas=[];i.addGalleryImage=function(b){var f;f=i.getObjects();d.imageLoading.show();for(var a=i.canvas.size()-1;a>=0;a--)(f[a].name&&f[a].name==="galImage"||f[a].name&&f[a].name==="cusImage"||f[a].type==="text")&&i.canvas.remove(f[a]);if(i.controls.textInput&&i.controls.textInput.imgText)i.controls.textInput.imgText.resetControl(),
i.controls.textInput.isControlActive=!1;k("#pcTextArea").val("");k(".ac-upload-tnC").fadeOut();j.Image.fromURL(b.imageUrl,function(f){i.canvas.add(f);f.name="galImage";d.imageLoading.hide();i.renderAll();f.vendorGalleryFileId=b.vendorGalleryFileId;f.vendorGalleryId=b.vendorGalleryId;f.originalURL=b.originalURL;k(".pc-two-column-layout .ac-delete-button").fadeIn()},{height:i.canvas.height,width:i.canvas.width,selectable:!1,crossOrigin:"anonymous"})};i.addCustomerImage=function(f){var a,e;a=i.getObjects();
for(var c=i.canvas.size()-1;c>=0;c--)i.canvas.deactivateAll(),(a[c].name&&a[c].name==="galImage"||a[c].name&&a[c].name==="cusImage")&&i.canvas.remove(a[c]);e=function(b){b.height>=b.width&&b.height>=i.canvas.height?(b.width*=i.canvas.height/b.height,b.height=i.canvas.height,b.width>i.canvas.width?(b.height*=i.canvas.width/b.width,b.width=i.canvas.width,b.left=0,b.top=(i.canvas.height-b.height)/2):(b.top=0,b.left=(i.canvas.width-b.width)/2)):b.width>=b.height&&b.width>=i.canvas.width?(b.height*=i.canvas.width/
b.width,b.width=i.canvas.width,b.height>i.canvas.height?(b.width*=i.canvas.height/b.height,b.height=i.canvas.height,b.left=(i.canvas.width-b.width)/2,b.top=0):(b.left=0,b.top=(i.canvas.height-b.height)/2)):(b.left=(i.canvas.width-b.width)/2,b.top=(i.canvas.height-b.height)/2);i.canvas.calcOffset();b.setCoords();i.renderAll()};f=b.prototype.scaleImage(f);j.Image.fromURL(f,function(b){i.canvas.add(b);e(b);d.imageLoading.hide();b.name="cusImage";b.sendToBack();i.canvas.setActiveObject(b);i.renderAll()},
{crossOrigin:"anonymous",transparentCorners:!1,borderColor:"white",centeredScaling:!0,lockUniScaling:!0});k(".ac-upload-tnC").fadeIn()};i.setActiveControl=function(b){for(var f in i.controls)if(i.controls.hasOwnProperty(f)&&i.controls[f])i.controls[f].isControlActive=!1;i.controls[b].isControlActive=!0};i.resetControls=function(){var b=!1,f;f=function(){k(".ac-btn-makeOwn.ac-imageUpload").trigger("click")};for(var a in i.controls)if(i.controls.hasOwnProperty(a)&&i.controls[a].isControlActive)switch(a){case "textInput":k(".ac-btn-makeOwn.ac-textInput").trigger("click");
b=!0;break;case "imageUpload":k(".ac-btn-makeOwn.ac-imageUpload").trigger("click"),b=!0}b||f()};i.activate=function(){};i.bindEvents={commonEvent:function(){i.canvas.off("canvas:cleared");i.canvas.on("canvas:cleared",function(){for(var b=0;b<=i.controls.length;b++)i.controls[b].cleared&&i.controls[b].cleared()});i.canvas.off("object:modified");i.canvas.on("object:modified",function(b){b=b.target;i.controls.textInput?(b.type!=="text"&&((b.scaleX>1.5||b.scaleY>1.5)&&f.show("pc-scale-warning-message"),
(b.scaleX<1.5||b.scaleY<1.5)&&f.hide(),i.canvas.calcOffset()),i.dragResetObject(),i.renderAll()):i.controls.imageUpload&&(i.dragResetObject(),i.renderAll())})},imageUpload:function(){i.controls.imageUpload.cleared=function(){f.hide();k(".ac-upload-tnC").fadeOut()}},imageAndText:function(){i.controls.textInput={};i.canvas.off("object:selected");i.canvas.on("object:selected",function(b){if(b.target)b.target.type==="text"?(i.currentSelectedObject="text",b.target.text!==""&&k(".pc-two-column-layout .ac-delete-button").fadeIn(),
l.trigger("slideUpTextArea")):(i.currentSelectedObject="other",l.trigger("slideDownTextArea"),k(".pc-two-column-layout .ac-delete-button").fadeIn())});i.canvas.off("selection:cleared");i.canvas.on("selection:cleared",function(){if(i.currentSelectedObject==="text")i.currentSelectedObject="other",l.trigger("slideDownTextArea");k(".pc-two-column-layout .ac-delete-button").fadeOut()});i.controls.textInput.cleared=function(){var b=i.getObjects();k("#pcTextArea").val("");i.controls.textInput.imgText.cleared();
for(var f=0;f<b.length;f++)b[f].type==="text"&&b[f].remove();l.trigger("slideDownTextArea")}}};i.bindControls=function(){var b=k(".ac-area-control."+i.id+", .ac-area-control.ac-widget-control"),f;k.each(b,function(b,a){f=k(a).attr("data-control-template");switch(f){case "simple-textInput":var c=new g(a,i,{});i.controls.simpleTextInput=c;break;case "imageUpload":if(i.surface.customizationType==="ImagePrinting")i.verifyScaling(),i.controls.imageUpload={isControlActive:!0},i.bindEvents.imageUpload();
break;case "textInput":if(i.surface.customizationType==="ImagePrinting"&&i.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported)i.bindEvents.imageAndText(),i.controls.textInput.imgText=new e(i,{})}})};i.controlRenderingHandle=function(){var b,f,a;if(i.surface.customizationType==="ImagePrinting"){var e,c,g,d,m=!1;b=!1;f=!1;a=!1;k(".ac-imageUpload-control");e=k(".ac-btn-makeOwn.ac-imageUpload");k(".ac-textInput-control");c=k(".ac-btn-makeOwn.ac-textInput");g=k('.a-tab-heading[data-a-tab-name="gallery"]');
d=k('.a-tab-heading[data-a-tab-name="makeOwn"]');i.data.customizationTypeSettings.ImagePrinting&&(i.data.customizationTypeSettings.ImagePrinting.isGallerySupported&&i.data.customizationTypeSettings.ImagePrinting.galleries&&i.data.customizationTypeSettings.ImagePrinting.galleries.length&&(b=!0),i.data.customizationTypeSettings.ImagePrinting.isCustomerUploadSupported&&(f=!0),i.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported&&(a=!0));g.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");
e.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item");b?g.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item"):d.trigger("click");
f?e.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"):(k(".ac-imageUpload-control").removeClass("active"),k(".ac-btn-makeOwn.ac-imageUpload").removeClass("active"));a&&(c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"),f||(i.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var b=b.getObjects(),f=0;f<b.length;f++)b[f].name&&
b[f].name==="galImage"&&(m=!0)})}),m||setTimeout(function(){c.trigger("click")},50)));!f&&!a&&(d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden"),g.addClass("a-active"),g.parents(".a-tab-container").find('.a-tab-content[data-a-name="makeOwn"]').addClass("a-hidden").siblings('.a-tab-content[data-a-name="gallery"]').removeClass("a-hidden").addClass("a-active"))}};i.fulfillmentJSON=function(){var b={},f=i.getObjects(),a,e;i.canvas.deactivateAll();
e=function(){var b,f;f={};for(f=0;f<i.surface.data.FontSettings.colors.length;f++)if(i.surface.data.FontSettings.colors[f].value===i.surface.color){b=i.surface.data.FontSettings.colors[f].name;break}f=i.data.customizationTypeSettings.TextPrinting.placeHolderText;f={fontFamily:i.surface.fontName,text:i.controls.simpleTextInput.inputBox.val(),fill:i.surface.color,customizationType:"TextPrinting",label:f?f:""};if(b)f.colorName=b;return f};b.name=i.name;b.Position=i.data.specifications.position;b.Dimensions=
i.data.specifications.dimension;if(i.surface.customizationType==="ImagePrinting"){for(e=0;e<f.length;e++)if(f[e].name&&f[e].name==="galImage"){var c=f[e].originalURL;a="VendorGallery";b.vendorGalleryImagePath=c;b.vendorGalleryFileId=f[e].vendorGalleryFileId;b.vendorGalleryId=f[e].vendorGalleryId;b.customizationType="ImagePrinting"}else f[e].type==="text"&&!f[e].text.replace(" ","").length&&f[e].remove();if(!a&&f.length)a="SVG",b.canvas=i.canvas,b.customizationType="ImagePrinting"}else a="JSON",b=
k.extend(b,e());if(k("#amazonCustomUseCaseId").val()==="AC_ImgTxtPersonalization_3")b.id=i.id;b.fulfillmentType=a;return b};i.init=function(){i.isChild&&(i.bindControls(),i.controlRenderingHandle());if(k(".ac-mobile-app").length>=1)l.on("resize-preview-text",function(){i.controls.simpleTextInput&&i.controls.simpleTextInput.inputBox&&i.controls.simpleTextInput.inputBox.trigger("keyup")})}}})})();(function(){s.when("A","ac-base","fabric-js","ac-utils","ac-canvas","ac-color-picker","ac-font-picker",
"ac-constants","ac-base","ready").register("ac-surface",function(l,j,h,d,a,g,c,b,e){var f=l.$;return function(k,m,o){var i={},n,p,y,w,C,P,D;i.isActive=!1;i.name="";i.productImageUrl="";i.maskImageUrl="";i.primaryCanvas=null;i.thumbnail=null;i.childCanvasList=[];i.controls={};i.font=j.getMerchantID()+"-Arial";i.customizationType=k.areas[0].customizationType;i.data=k;i.widget=m;i.isApp=e.isApp();D=f("html.a-ie9").length||l.capabilities.isIE10;i.miniThumbnailCanvas=[];n=function(b,f){var c=new a(b,i);
c.init();if(e.isApp())l.on("resize-preview-text",function(){if(f!==u){var a=d.getScaleRatio(),e=f.specifications.dimension.height*a+5;b.setWidth(f.specifications.dimension.width*a);b.setHeight(e)}});return c};y=function(){for(var b=f('.ac-controls-container[data-surface="surface-'+k.index+'"]').find('[type="text"]'),a=0;a<b.length;a++)if(b[a].value.length)return!0;return!1};p=function(b,a){var e,c,k,g,m,o,n=i.isApp,p;if(a.isChild)return null;c=b.specifications.position.y;k=b.specifications.position.x;
g=b.specifications.dimension.height;m=b.specifications.dimension.width;o=b.specifications.angle?b.specifications.angle:0;e=document.createElement("canvas");e.id=i.id+"-area-"+b.index;e.className+=" canvasArea";n?(p=d.getScaleRatio(),e.setAttribute("data-left",k*p),e.setAttribute("data-top",c*p),e.setAttribute("data-initial-left",k),e.setAttribute("data-initial-top",c),e.setAttribute("data-initial-width",m),e.setAttribute("data-initial-height",g),e.setAttribute("data-angle",o),e.height=g*p+5,e.width=
m*p):(e.setAttribute("data-left",k),e.setAttribute("data-top",c),e.setAttribute("data-angle",o),e.height=g+5,e.width=m);f('.ac-preview-container[data-surface="'+i.id+'"]').append(e);e.getContext("2d");var w=new h.Canvas(e.id);o="rotate("+o+"deg)";n?f(e).parent(".canvas-container").css({width:m*p,height:g*p,position:"absolute",top:c*p+"px",left:k*p+"px","-ms-transform":o,"-webkit-transform":o,transform:o}):f(e).parent(".canvas-container").css({position:"absolute",top:c+"px",left:k+"px","-ms-transform":o,
"-webkit-transform":o,transform:o});w.isChild=!0;w.parent=a;w.index=b.index;return w};w=function(b){var a=new Image;a.crossOrigin="anonymous";a.src=k.preview.url;a.onload=function(){b.canvas.setBackgroundImage(new h.Image(a,{originX:"left",originY:"top",left:0,top:0}),function(){b.renderAll.bind(b.canvas);d.debounce(i.updateThumbnail(),50)})};if(k.mask&&k.mask.url){var e=new Image;e.crossOrigin="anonymous";e.src=k.mask.url;e.style.top="-"+k.areas[0].specifications.position.y+"px";e.style.left="-"+
k.areas[0].specifications.position.x+"px";e.onload=function(){b.canvas.setOverlayImage(new h.Image(e,{originY:"top",originX:"left",left:0,top:0}),function(){b.renderAll.bind(b.canvas);d.debounce(i.updateThumbnail(),25)});f("#"+i.id+"-area-0").after(e).parent(".canvas-container").css({height:"400px",width:"400px"})}}};C=function(b){for(var f,e=0;e<k.areas.length;e++)f=k.areas[e],f.index=e,f=i.isApp?n(p(f,b),f):n(p(f,b)),e===0&&i.setActiveArea(f),b.childCanvas.push(f);w(b);return b.childCanvas};P=function(){var b,
e=i.data.areas[0].customizationTypeSettings.ImagePrinting.galleries,a,c=!1,k,g;f("#ac-gallery.vendor-categories > .vendor-category").css({display:"none"});if(i.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery)a=i.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery;for(var d=0;d<e.length;d++)if(b="",b=e[d].charAt(0)==="/"?e[d].substr(1,e[d].length):e[d])k=f('#ac-gallery.vendor-categories > .vendor-category > a[data-themename="'+b+'"]'),g=f('#ac-gallery.vendor-categories > .vendor-category > a[data-categoryid="'+
b+'"]'),k.length?(k.parent(".vendor-category").css({display:"block"}),a&&a.substr(1,a.length)===b&&(k.trigger("click"),c=!0)):g.length&&(g.parent(".vendor-category").css({display:"block"}),a&&a.substr(1,a.length)===b&&(g.trigger("click"),c=!0));c||f("#ac-gallery.vendor-categories > .vendor-category > a").each(function(b,e){f(e).parent(".vendor-category").css("display")==="block"&&f(e).trigger("click")})};i.setActiveArea=function(b){for(var f=0;f<i.childCanvasList.length;f++)i.childCanvasList[f].isActive=
!1;b.isActive=!0;return b};i.updateTickerOnTab=function(){y()?f(".pc-surface-nav-carousel").find('[data-surface-num="'+(k.index+1)+'"]').addClass("customized"):f(".pc-surface-nav-carousel").find('[data-surface-num="'+(k.index+1)+'"]').removeClass("customized")};i.isSurfaceCustomized=function(){for(var b=f('.ac-controls-container[data-surface="surface-'+k.index+'"]').find('[type="text"]'),e=0;e<b.length;e++)if(b[e].value.length)return!0;return!1};i.getActiveArea=function(){var b,f;for(b=0;b<i.childCanvasList.length;b++)i.childCanvasList[b].isActive===
!0&&(f=i.childCanvasList[b]);return f};i.enableBuyBox=function(){for(var b=!1,f=0;f<i.childCanvasList.length;f++)if(i.childCanvasList[f].enableBuyBox===!0){b=!0;break}return b};i.setPrimaryCanvas=function(){var b;b=n(new h.Canvas("ac-preview-canvas-"+i.id));b.isChild=!1;return b};i.updatePrimaryCanvas=function(b){var e,a,c,k,g=!1;e=function(){var e={};e.height=i.primaryCanvas.childCanvas[b].canvas.height;e.width=i.primaryCanvas.childCanvas[b].canvas.width;e.top=f("canvas#"+i.id+"-area-"+b).data("top");
e.left=f("canvas#"+i.id+"-area-"+b).data("left");e.angle=f("canvas#"+i.id+"-area-"+b).data("angle");return e};if(i.primaryCanvas.childCanvas[b]){var o=i.primaryCanvas.childCanvas[b].getObjects(),n;k=i.primaryCanvas.getObjects();for(var p=i.primaryCanvas.canvas.size()-1;p>=0;p--)k[p].areaId!==u&&k[p].areaId===b&&i.primaryCanvas.canvas.remove(k[p]);if(o.length)if(o.length===1&&o[0].type==="text"&&(o[0].text===""||o[0].text===" "))i.primaryCanvas.childCanvas[b].canvas.deactivateAll();else{g=!0;for(p=
i.primaryCanvas.childCanvas[b].canvas.size()-1;p>=0;p--)o[p].active&&(n=o[p]);c=e();var w=function(b){var f={},e=!1,f={left:-b.width/2,top:-b.height/2,width:b.width,height:b.height};if(b.left<0){if(e=!0,f.left=-b.width/2-b.left,b.width+b.left>c.width)f.width=c.width}else if(b.width+b.left>c.width)e=!0,f.left=-b.width/2-(b.width+b.left-c.width);if(b.top<0){if(e=!0,f.top=-b.height/2-b.top,b.height+b.top>c.height)f.height=c.height}else if(b.height+b.top>c.height)e=!0,f.top=-b.height/2-(b.height+b.top-
c.height);f.clipNeeded=e;return f};e=function(){i.primaryCanvas.canvas.forEachObject(function(f){f.areaId===b&&f.remove()});D?i.primaryCanvas.childCanvas[b].canvas.forEachObject(function(f){var e=h.util.object.clone(f);if(!D&&e.type==="group")for(var k=e.getObjects(),g=0;g<k.length;g++)k[g].text&&(f=h.util.object.clone(k[g]),f.top+=e.top,f.top+=e.top,e=f);i.primaryCanvas.canvas.calcOffset();i.primaryCanvas.canvas.add(e);if(e.type==="image"){e.sendToBack();try{var m={},o,n,p,y;o=e.getBoundingRect();
m=w(o);n=new h.Rect({left:c.left,top:c.top,height:c.height,width:c.width,selectable:!1,fill:"none",strokeWidth:0,opacity:0});i.primaryCanvas.canvas.add(n);p=function(b){return b*(Math.PI/180)};y=function(b,f){f.setCoords();b.save();b.translate(-(f.width/2)+n.strokeWidth,-(f.height/2)+n.strokeWidth);b.rotate(p(f.angle*-1));b.scale(1,1);b.beginPath();b.rect(n.left-f.oCoords.tl.x,n.top-f.oCoords.tl.y,n.width,n.height);b.closePath();b.restore()};e.clipTo=function(b){return y(b,e)}}catch(C){}}e.type===
"text"?e.text.replace(/\s/g,"")===""?i.primaryCanvas.canvas.remove(e):(m={},o=e.getBoundingRect(),m=w(o),m.clipNeeded?(a=e.toDataURL(),h.Image.fromURL(a,function(f){f.set({top:o.top+c.top,left:o.left+c.left,selectable:!1,areaId:b});i.primaryCanvas.canvas.remove(e);e=f;i.primaryCanvas.canvas.add(f);f.clipTo=function(b){b.rect(m.left,m.top,m.width,m.height)};i.primaryCanvas.canvas.renderAll();d.debounce(i.updateThumbnail(),50)})):(e.left+=c.left,e.top+=c.top,e.areaId=b)):(e.left+=c.left,e.top+=c.top,
e.areaId=b);e.setCoords()}):(a=i.primaryCanvas.childCanvas[b].canvas.toDataURL("png"),h.Image.fromURL(a,function(f){f.set({height:c.height,width:c.width,top:c.top,left:c.left,selectable:!1});f.areaId=b;i.primaryCanvas.canvas.add(f);i.primaryCanvas.canvas.renderAll();d.debounce(i.updateThumbnail(),50)}));i.primaryCanvas.canvas.renderAll()};n?(i.primaryCanvas.childCanvas[b].canvas.deactivateAll(),e(),i.primaryCanvas.childCanvas[b].canvas.setActiveObject(n)):e()}d.debounce(i.updateThumbnail(),50);i.primaryCanvas.childCanvas[b].enableBuyBox=
!1;if(g)i.primaryCanvas.childCanvas[b].enableBuyBox=!0;m.buybox.verify()}};i.updateThumbnail=function(){if(!i.widget.showThumbnail)return null;try{if(i.customizationType==="TextPrinting"&&!D){var e=i.primaryCanvas.canvas.toDataURL("png");f(".thumbnail-container").find('.thumbnail-image[ac-target="'+i.id+'"]').html("<img src='"+e+"' class='thumbnail-image "+i.id+"' />")}else{var a,c,k,g,d;a=b.defaults.thumbnailHeight/b.defaults.galHeight;d=f(".thumbnail-container").find('.thumbnail-image[ac-target="'+
i.id+'"]');if(!d.find(".ieThumbnail-bg").length)c=f("<img />",{"class":"ieThumbnail-bg",src:i.data.preview.url,alt:"Thumbnail Image",height:b.defaults.thumbnailHeight+"px",width:b.defaults.thumbnailWidth="px"});d.html(c);k=function(b,e){var c,k,g,d,m,n;k=b.position.y*a;g=b.position.x*a;d=b.dimension.height*a;m=b.dimension.width*a;n=b.angle?o.specifications.angle:0;c=document.createElement("canvas");c.id="thumbnail-"+i.id+"-area-"+e;c.className+="thumbnail-canvasArea";c.height=d;c.width=m;f(".thumbnail-container").find('.thumbnail-image[ac-target="'+
i.id+'"]').append(c);c.getContext("2d");d=new h.Canvas(c.id);n="rotate("+n+"deg)";f(c).parent(".canvas-container").css({position:"absolute",top:k+"px",left:g+"px","-ms-transform":n,"-webkit-transform":n,transform:n});return d};for(e=0;e<i.childCanvasList.length;e++)f("#thumbnail-"+i.id+"-area-"+e).length?(g=i.miniThumbnailCanvas[e],g.clear()):(g=k(i.childCanvasList[e].data.specifications,e),i.miniThumbnailCanvas[e]=g),i.customizationType==="ImagePrinting"?i.childCanvasList[e].canvas.forEachObject(function(b){var f=
h.util.object.clone(b);g.calcOffset();g.add(f);f.top=b.top*a;f.left=b.left*a;f.scaleX*=a;f.scaleY*=a;f.selectable=!1;g.deactivateAll();f.type!=="text"&&f.sendToBack();f.setCoords();g.renderAll()}):i.customizationType==="TextPrinting"&&function(b,f){h.Image.fromURL(b,function(b){f.add(b);b.scaleX=a;b.scaleY=a;b.selectable=!1;f.renderAll()})}(i.childCanvasList[e].canvas.toDataURL("png"),g);if(i.data.mask&&i.data.mask.url&&!d.find(".ieThumbnail-mask").length){var m=f("<img />",{"class":"ieThumbnail-mask",
src:i.data.mask.url,alt:"Thumbnail Mask Image"});f(m).load(function(){var b,e;b=this.naturalHeight;e=this.naturalWidth;f(this).height(b*a).width(e*a)});d.find(".canvas-container").after(m)}}}catch(n){return console.log(n),null}};i.activateSurface=function(){m.setActiveSurface(i.id);i.customizationType==="ImagePrinting"&&(i.getActiveArea().resetControls(),i.getActiveArea().controlRenderingHandle());i.customizationType==="TextPrinting"&&f("#ac-simple-text-font-picker",f("div[data-surface='"+i.id+"']")).val(i.font)};
i.bindEvents=function(){f(".thumbnail-container .ac-thumbnail.surface-0").addClass("active");f(".thumbnail-container").delegate('[ac-target="'+i.id+'"]',"click",function(){if(f('.ac-preview-container[data-surface="'+i.id+'"]').css("display").toLowerCase()==="block")return null;f(".ac-thumbnail").removeClass("active");f(".ac-thumbnail."+i.id).addClass("active");f(".ac-preview-container").css("display","none").parent().find('[data-surface="'+i.id+'"]').css("display","block");i.customizationType==="ImagePrinting"?
(f(".ac-controls-container").css("display","none").parent().find(".ac-controls-container.ac-image-text-control").css("display","block"),i.data.areas[0].customizationTypeSettings.ImagePrinting.galleries&&P(),f(".ac-single-text-preview-guideline").css({display:"none"})):(f(".ac-controls-container").css("display","none").parent().find('[data-surface="'+i.id+'"]').css("display","block"),f(".pc-two-column-layout .ac-delete-button").fadeOut(),f(".ac-single-text-preview-guideline").css({display:"block"}));
i.activateSurface()});return P};i.notifySubscribers=function(b,f){switch(b){case "colorpicker":i.color=f;for(var e=0;e<i.childCanvasList.length;e++)i.childCanvasList[e].controls.simpleTextInput&&(i.childCanvasList[e].controls.simpleTextInput.changePreview(),l.trigger("amazon-custom-log-ref-tag","FontColorChange"));break;case "fontpicker":i.font=f;for(e=0;e<i.childCanvasList.length;e++)i.childCanvasList[e].controls.simpleTextInput&&(i.childCanvasList[e].controls.simpleTextInput.changePreview(),l.trigger("amazon-custom-log-ref-tag",
"FontChange"))}};i.bindControls=function(){var b=f(".ac-surface-control."+i.id),e;f.each(b,function(b,a){e=f(a).attr("data-control-template");switch(e){case "colorpicker":var k=new g(a,i);i.controls.colorPicker=k;break;case "fontpicker":k=new c(a,i),i.controls.fontPicker=k}})};i.initiateEvents=function(){};i.fulfillmentJSON=function(){var b={},e=[];b.name=i.name;if(f("#amazonCustomUseCaseId").length&&f("#amazonCustomUseCaseId").val()==="AC_ImgTxtPersonalization_3"){b.images={};if(k.preview&&k.preview.url)b.images.previewUrl=
k.preview.url;if(k.mask&&k.mask.url)b.images.maskUrl=k.mask.url;if(i.customizationType==="TextPrinting"){b.font={};if(i.font.substring(0,3)==="ac_"){b.font.isDefault=0;var a=i.data.FontSettings.fonts.filter(function(b){if(b.name===i.fontName)return!0});if(a.length===1)b.font.fontUrl=a[0].fontURL}else b.font.isDefault=1;b.font.fontName=i.fontName}b.id=i.id}for(a=0;a<i.childCanvasList.length;a++)e.push(i.childCanvasList[a].fulfillmentJSON());b.areas=e;return b};i.init=function(){i.name=k.name;i.isActive=
k.isActive;i.id="surface-"+k.index;i.productImageUrl=k.preview.productImageUrl;i.maskImageUrl=k.preview.maskImageUrl;i.primaryCanvas=i.setPrimaryCanvas();i.childCanvasList=C(i.primaryCanvas);i.bindEvents();i.bindControls();i.initiateEvents()};i.init();return i}})})();(function(){s.when("A","ac-base","ready").register("ac-utils",function(l,j){var h=l.$,d,a,g,c;d={};a=function(b){var e=null;try{e=l.state(b)?l.state(b):null}catch(f){e=null}finally{return e}};c=function(){for(var b=h(".pc-customization-enabled script"),
e=0,f=b.length;e<f;e++)if(!h.data(b[e],"a-eval")){var a=h(b[e]),c=a.attr("data-a-state");c&&(c=l.parseJSON(c),c.key&&(a=l.parseJSON(a.html()),l.state.replace(c.key,a)))}return!0};d.init=function(){c();g=a("wssStringArray")};d.getState=function(b,e){if(e){var f=!1,f=c();if(!f)return}g||(g=a("wssStringArray"));return a(b)};d.validator=function(){var b={AlphaNumeric:function(){return!0},Digits:function(b){return/^[\s\d]*$/.test(b)}};return{Validate:function(e,f){return b[f]!==u&&typeof b[f]==="function"?
b[f](e):!0}}};d.debounce=function(b,e,f){var a;return function(){var c=this,g=arguments,d=f&&!a;clearTimeout(a);a=setTimeout(function(){a=null;f||b.apply(c,g)},e);d&&b.apply(c,g)}};d.showDialog={show:function(b,e,f){f&&f.ok&&h(".ac-btn.ac-btn-dialog-ok").text(f.ok);f&&f.cancel&&h(".ac-btn.ac-btn-dialog-cancel").text(f.cancel);b&&h("#ac-dialog-confirm p").html(b);h("#ac-dialog-confirm").fadeIn();h(".ac-image-backdrop").fadeIn();h("#ac-dialog-confirm").undelegate(".ac-btn-dialog-ok","click");h("#ac-dialog-confirm").delegate(".ac-btn-dialog-ok",
"click",function(){h("#ac-dialog-confirm").fadeOut();h(".ac-image-backdrop").fadeOut();e()});h("#ac-dialog-confirm").undelegate(".ac-btn-dialog-cancel","click");h("#ac-dialog-confirm").delegate(".ac-btn-dialog-cancel","click",function(){h("#ac-dialog-confirm").fadeOut();h(".ac-image-backdrop").fadeOut();f&&f.cancelCallBack&&f.cancelCallBack();d.imageLoading.hide()})}};d.imageLoading={show:function(){h(".ac-image-loader").fadeIn();h(".ac-image-backdrop").fadeIn()},hide:function(){h(".ac-image-loader").fadeOut();
h(".ac-image-backdrop").fadeOut()}};d.arrFilterUnique=function(b){return b.filter(function(b,f,a){return a.indexOf(b)===f})};d.stringHandler=function(b){return g&&g[b]?g[b]:""};d.getScaleRatio=function(){var b=1;if(j.isApp()){var e=h(".ac-surface-background-image"),b=e.width();e.height();e=e.get()[0].naturalWidth;b/=e}return b};return d})})();(function(){s.when("A","fabric-js","ac-base","BuyBox","ac-constants","ac-surface","ac-utils","ac-gallery","ac-image-gallery","ready").register("ac-widget",function(l,
j,h,d,a,g,c,b){var e=l.$;return function(){var f=this,k,m;f.surfaceList=[];f.data={};f.showThumbnail=!0;f.acTempCanvas=new j.Canvas("acTempCanvas");m=function(){e(".pc-two-column-layout").delegate(".ac-delete-button","click",function(){var b=f.getActiveArea();b.canvas.forEachObject(function(f){var e;if(f&&f.active||f&&f.name&&f.name==="galImage"){if(f.type&&f.type==="text")e=b.controls.textInput.cleared;if(f.name&&f.name==="cusImage")e=b.controls.imageUpload.cleared;e&&e();b.canvas.remove(f)}});b.canvas.discardActiveGroup();
e(".pc-two-column-layout .ac-delete-button").fadeOut();b.renderAll()})};f.getActiveSurface=function(){for(var b=null,e=0;e<f.surfaceList.length;e++)f.surfaceList[e].isActive===!0&&(b=f.surfaceList[e]);return b};f.setActiveSurface=function(b){for(var e=0;e<f.surfaceList.length;e++)if(f.surfaceList[e].isActive=!1,f.surfaceList[e].id===b)f.surfaceList[e].isActive=!0};f.getActiveArea=function(){return f.getActiveSurface().getActiveArea()};f.fulfillmentJSON=function(){var b={},c=[],g=[],k,d;d=f.acTempCanvas;
d.setDimensions(a.outputSVGDimention);k=function(b){var f=a.scaleRatio,c,g,k,i;k=parseInt(e(b.lowerCanvasEl).parent(b.wrapperEl).css("top").replace("px",""),10);i=parseInt(e(b.lowerCanvasEl).parent(b.wrapperEl).css("left").replace("px",""),10);d.clear();b.forEachObject(function(b){b=j.util.object.clone(b);d.calcOffset();d.add(b);b.type!=="rect"&&(b.type==="image"&&(b.sendToBack(),c=b.getSrc()),b.type==="text"&&b.text.replace(/\s/g,"")===""&&d.remove(b),b.top+=k,b.left+=i,b.scaleX*=f,b.scaleY*=f,b.left*=
f,b.top*=f,b.setCoords())});d.renderAll();c&&c.indexOf("._")!==-1&&c.indexOf("._")!==-1?(g=c.split("._")[0]+"."+c.split("_.")[1],b=d.toSVG(null,function(b){return b.replace(RegExp(/xlink:href=\"\S*\"/),'xlink:href="'+g+'"').replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,"$1<![CDATA[$3]]\>$4")})):b=d.toSVG(null,function(b){return b.replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,"$1<![CDATA[$3]]\>$4")});return b};b.customizationInfo={fulfillmentDetails:f.data.fulfillmentDetails,"version3.0":{surfaces:[]}};
b.merchantId=h.getMerchantID();for(var m=0;m<f.surfaceList.length;m++)c.push(f.surfaceList[m].fulfillmentJSON());for(m=0;m<c.length;m++)for(var C=0;C<c[m].areas.length;C++)c[m].areas[C].fulfillmentType==="SVG"?(c[m].areas[C].svgImage=k(c[m].areas[C].canvas),delete c[m].areas[C].canvas):c[m].areas[C].fulfillmentType||c[m].areas.splice(C,1);for(m=0;m<c.length;m++)c[m].areas.length&&g.push(c[m]);b.customizationInfo["version3.0"].surfaces=g;return b};f.bindControls={galleryImage:function(){l.on("addGalleryImage",
function(b){var e,a,g,k=!1;e=f.getActiveSurface();l.trigger("amazon-custom-log-ref-tag","logVendorGalleryTabClick");a=e.getActiveArea();if(a.getObjects().length===1&&a.getObjects()[0].name==="galImage"&&a.getObjects()[0].getSrc()===b.imageUrl)return null;e=c.stringHandler("pc-clear-custom-msg");g=function(){f.surfaceList.forEach(function(f){f.childCanvasList.forEach(function(f){for(var e=f.getObjects(),a=!1,c=0;c<e.length;c++)e[c].name&&e[c].name==="galImage"&&e[c].getSrc()===b.imageUrl&&(a=!0);a||
f.clear()})});a.addGalleryImage(b)};for(var d=0;d<f.surfaceList.length;d++){for(var m=0;m<f.surfaceList[d].childCanvasList.length;m++){var h,D=f.surfaceList[d].childCanvasList[m];h=D.getObjects();for(var j=D.canvas.size()-1;j>=0;j--)if(h[j].type==="text"&&!h[j].text.replace(" ","").length)h[j].remove(),D.controls.textInput.isControlActive=!1;else if(h[j].name&&h[j].name==="cusImage"||h[j].type==="text"){k=!0;break}if(k)break}if(k)break}k?c.showDialog.show(e,g,{ok:"Clear"}):g()})},uploadImage:function(){l.off("addCustomerImage");
l.on("addCustomerImage",function(b){var e,a,g,k=!1;e=f.getActiveSurface().getActiveArea();e.getObjects();a=c.stringHandler("pc-clear-design-msg");g=function(){f.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var f=b.getObjects(),e=0;e<f.length;e++)f[e].name&&f[e].name==="galImage"&&b.clear()})});e.addCustomerImage(b)};f.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var b=b.getObjects(),f=0;f<b.length;f++)if(b[f].name&&b[f].name==="galImage"){k=
!0;break}})});k?c.showDialog.show(a,g,{ok:"Clear"}):g()});e(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-imageUpload","click",function(){e(".ac-imageUpload-control").addClass("active");e(".ac-btn-makeOwn.ac-imageUpload").addClass("active");e(".ac-textInput-control").removeClass("active");e(".ac-btn-makeOwn.ac-textInput").removeClass("active");f.getActiveSurface().getActiveArea().setActiveControl("imageUpload");l.trigger("amazon-custom-log-ref-tag","logCustomImageTabClick")})},textOnImage:function(){(function(){e("#pcTextArea").unbind().bind("keyup",
function(){var b=e(this).val().replace('"',"''");e(this).val(b);if(b.length>50)return b=b.substring(0,50),e(this).val(b),null;f.getActiveArea().controls.textInput.imgText.updateText(b);e(this).val()});e(".pc-textArea-fontStyle-li").unbind().bind("click",function(){e(this).toggleClass("button-active");var b=e(this).attr("data-style");b+=e(this).hasClass("button-active")?"on":"off";f.getActiveArea().controls.textInput.imgText.toggleStyle(b)});e(".pc-textArea-fontAlign-li").unbind().bind("click",function(){e(".pc-textArea-fontAlign-li").removeClass("button-active");
e(this).addClass("button-active");var b=e(this).attr("data-align");f.getActiveArea().controls.textInput.imgText.changeAlign(b)});l.off("a:dropdown:fontPicker:select");l.on("a:dropdown:fontPicker:select",function(b){f.getActiveArea().controls.textInput.imgText.changeFont(b.value)});e(".pc-textArea-fontColor-li").unbind().bind("click",function(){f.getActiveArea().controls.textInput.imgText.changeTextColor(e(this).find("div").attr("data-color"))});l.off("a:popover:show:text-color");l.on("a:popover:show:text-color",
function(b){b.popover.$popover.css("z-index",999999)});l.off("slideUpTextArea");l.on("slideUpTextArea",function(){var b=e(".pc-textArea-overlay");b.parents().is(":hidden")?b.hide():b.slideUp(100,function(){e("#pcTextArea").focus()})});l.off("slideDownTextArea");l.on("slideDownTextArea",function(){e(".pc-textArea-overlay").slideDown()})})();e(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-textInput","click",function(){var b;e(".ac-imageUpload-control").removeClass("active");e(".ac-btn-makeOwn.ac-imageUpload").removeClass("active");
e(".ac-textInput-control").addClass("active");e(".ac-btn-makeOwn.ac-textInput").addClass("active");b=f.getActiveArea();b.controls.textInput.imgText.updateControl();b.controls.textInput.imgText.select();b.setActiveControl("textInput");l.trigger("slideUpTextArea");l.trigger("amazon-custom-log-ref-tag","logAddTextTabClick")})}};f.initiateBuyBox=function(){(new d({controller:{getJSON:f.fulfillmentJSON}})).Init()};f.buybox={enable:function(){l.trigger("enableBuybox")},disable:function(){l.trigger("disableBuybox")},
verify:function(){for(var b=!1,e=0;e<f.surfaceList.length;e++)if(f.surfaceList[e].enableBuyBox()){b=!0;break}b?f.buybox.enable():f.buybox.disable()}};f.init=function(){var a,d,h=!1,p=[],y;c.init();d=c.getState("ctsStateData",!0);f.data=d;for(var w=0;w<d.surfaces.length;w++){a=d.surfaces[w];a.index=w;w===0?a.isActive=!0:a.isActive=!1;a=new g(a,f);if(w===0)a.isActive=!0,a.customizationType==="ImagePrinting"?(e(".ac-single-text-preview-guideline").css({display:"none"}),e(".ac-image-text-preview-guideline").css({display:"block"})):
e(".ac-single-text-preview-guideline").css({display:"block"});if(a.customizationType==="ImagePrinting"){var h=!0,C=a.data.areas[0].customizationTypeSettings.ImagePrinting.galleries;if(C&&C.length&&(p=p.concat(C),!y&&a.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery))y=a.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery}f.surfaceList.push(a)}if(d.surfaces.length===1&&d.surfaces[0].areas[0].customizationType==="TextPrinting")e(".thumbnail-container").fadeOut("fast"),
e(".ac-image-text-preview-guideline").fadeOut("fast"),e(".pc-two-column-layout .pc-input-controls").addClass("ac-single-text-only"),e(".pc-two-column-layout .ac-controls-container").addClass("ac-single-text-only"),e(".pc-two-column-layout").addClass("ac-single-text-only"),e(".pc-atc-wrapper").addClass("a-button-span12"),e(".ac-price").addClass("ac-single-text-only"),e(".ac-quantity").addClass("ac-single-text-only"),f.showThumbnail=!1;p=c.arrFilterUnique(p);m();f.initiateBuyBox();h===!0&&(p.length&&
(k=new b(null,p,y),k.Fetch()),f.bindControls.galleryImage(),f.bindControls.uploadImage(),f.bindControls.textOnImage())}}})})();s.when("A","ready").execute(function(l){function j(){h("html").hasClass("a-canvas")||(h(".pc-customization-disabled").addClass("active"),h(".pc-customization-enabled").remove())}var h=l.$;l.on("pc-single-text-loaded",function(){j()});j()});s.when("A","a-modal","ac-utils","ac-widget","ac-base","ready").execute(function(l,j,h,d){function a(){if(g(".ac-mobile-app").length>=1){var b=
g(".ac-surface-background-image"),e=b.width(),b=b.height();h.getScaleRatio();g(".canvas-container > .ac-parent-canvas").attr({width:e,height:b}).css({width:e+"px",height:b+"px"});g(".canvas-container .canvasArea").each(function(b,e){var a=g(e).attr("data-initial-top"),c=g(e).attr("data-initial-left"),d=g(e).attr("data-initial-width"),n=g(e).attr("data-initial-height"),p=h.getScaleRatio();a!==u&&c!==u&&(g(e).attr({"data-top":parseInt(a,10)*p,"data-left":parseInt(c,10)*p}),g(e).parent().css({top:parseInt(a,
10)*p,left:parseInt(c,10)*p,width:d+"px",height:n+"px"}))});g(".ac-preview-container").css({"min-height":b+10});l.trigger("resize-preview-text")}}var g=l.$,c=[];l.on("a:popover:afterShow:pc-buybox-secondary-view",function(){a();g("#pc-customize-now-div").attr("data-customization-clicked")==="false"&&((new d).init(),g("#pc-customize-now-div").attr("data-customization-clicked","true"));l.on("resize-preview",function(){a()})});l.on("a:popover:afterHide:pc-popover-content",function(){l.trigger("amazon-custom-log-ref-tag",
"CloseClick");l.trigger("amazon-custom-popup-close",new Date)});g("html").hasClass("a-canvas")&&(g(".pc-customization-disabled").remove(),l.declarative("popover-trigger","click",function(){var b=g(".pc-popover-button"),e=j.get(b);l.trigger("amazon-custom-log-ref-tag","CustomizeNowClick");if(e===null){if(c.length>0){for(e=0;e<c.length;e++)j.remove(c[e]);c.length=0}e=j.create(b,{name:"pc-popover-content",header:g(".pc-popover-header").html(),activate:"onclick"});g(".pc-popover-header").remove();e.lock().show();
c.push(e);b=g("#ASIN",g(".pc-buy-box",g(".pc-two-column-layout"))).val();g(".pc-two-column-layout").attr("asin",b);(new d).init()}}))});(function(){s.when("A","fabric-js","ac-utils","ac-base","ready").register("ac-simple-textInput",function(l,j,h,d){var a=l.$;return function(g,c,b){var e={},f,k,m;e.inputBox=d.isApp()?a(g).find(".pc-simple-text-input input"):a(g).find("input.pc-simple-text-input");e.maxLength=parseInt(e.inputBox.attr("maxLength"),10);e.textLimitElement=a(g).find(".pc-char-limit-length");
e.charType=a(e.inputBox).data("input-type");e.acCanvas=c;e.options=b;e.isEmpty=function(){var b=!1;e.inputBox.val().replace(/\s/g,"")===""&&(b=!0);return b};e.isValid=function(){return h.validator().Validate(e.inputBox.val(),e.charType)&&!e.isEmpty()};e.cleared=function(){e.inputBox.val("")};e.changePreview=function(b){b||(b=e.inputBox.val());if(e.acCanvas.canvasObjects[e.acCanvas.id]!==u){var f=e.acCanvas.canvasObjects[e.acCanvas.id];f.forEachObject(function(b){e.acCanvas.canvasObjects[e.acCanvas.id].removeWithUpdate(b)});
e.acCanvas.canvas.remove(f)}if(b&&b.replace(/\s+/g,"").length){f={fontFamily:e.acCanvas.surface.font,fontSize:e.acCanvas.canvas.height,fill:e.acCanvas.surface.color,selectable:!1,textAlign:"center",originX:"center",originY:"center",lockMovementX:!0,lockMovementY:!0,lineHeight:1.3/1.13};if(d.isApp())f.fontSize=Math.round(e.acCanvas.canvas.height);b=new j.Text(b,f);f={originX:"center",originY:"center",fill:"",opacity:0,width:e.acCanvas.canvas.width,height:e.acCanvas.canvas.height,selectable:!1,lockMovementX:!0,
lockMovementY:!0,clipTo:function(b){b.rect(-(e.acCanvas.canvas.width/2),-(e.acCanvas.canvas.height/2),e.acCanvas.canvas.width,e.acCanvas.canvas.height+5)}};if(d.isApp())f.width=Math.round(e.acCanvas.canvas.width),f.height=Math.round(e.acCanvas.canvas.height);var f=new j.Rect(f),a={left:0,top:0,width:e.acCanvas.canvas.width,height:e.acCanvas.canvas.height,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,selectable:!1,name:"simple-text"};if(d.isApp())a.width=Math.round(e.acCanvas.canvas.width),
a.height=Math.round(e.acCanvas.canvas.height);a=new j.Group([f,b],a);e.acCanvas.canvasObjects[e.acCanvas.id]=a;e.acCanvas.canvas.add(a);k(b,f)}else e.acCanvas.renderAll();d.isApp()&&e.acCanvas.surface.updateTickerOnTab()};k=function(b){var f,c;a(".parentReferenceDiv").length?f=a(".parentReferenceDiv"):(f=a(document.createElement("div")),a(".ac-image-backdrop").after(a(f)));c=a(".referenceDiv").length?a(".referenceDiv"):a(document.createElement("div"));a(f).addClass("parentReferenceDiv");a(c).addClass("referenceDiv");
a(c).css({"font-family":e.acCanvas.surface.font,"font-size":b.getFontSize()});a(c).text(b.text);for(a(f).html(a(c));b.getWidth()>e.acCanvas.canvas.width-e.acCanvas.canvas.width*0.1||a(c).height()>e.acCanvas.canvas.height-e.acCanvas.canvas.height*0.1;)if(f=b.getFontSize(),f>2)f-=1,b.setFontSize(f-1),a(c).css({"font-size":f+"px"}),b.set({top:-f*(1.3/1.13)*(1-1/1.13)*0.5}),b.setCoords();else break;e.acCanvas.renderAll()};m=function(){var b=e.inputBox.val(),f=parseInt(b.length,10),a=parseInt(e.maxLength,
10),c=a;e.textLimitElement.length>0&&(c=a-f,c<0?(e.textLimitElement.html(0),e.inputBox.val(b.substring(0,a))):e.textLimitElement.html(c));e.isValid()?(e.inputBox.removeClass("a-form-error"),e.inputBox.siblings(".pc-input-invalid").removeClass("active"),e.changePreview(b)):(e.isEmpty()&&e.changePreview(b),e.isEmpty()?(e.inputBox.siblings(".pc-input-invalid").removeClass("active"),e.inputBox.removeClass("a-form-error")):(e.inputBox.siblings(".pc-input-invalid").addClass("active"),e.inputBox.addClass("a-form-error")),
e.changePreview(""))};f=function(){e.inputBox.bind("keyup",function(){m()});e.inputBox.bind("change",function(){m()});e.inputBox.bind("cut",function(){setTimeout(function(){m()},100)});e.inputBox.bind("paste",function(){setTimeout(function(){m()},100)})};e.init=function(){f()};e.init();return e}})})();(function(){s.when("A","a-popover","ac-utils","ac-base","ready").register("ac-color-picker",function(l,j,h,d){var a=l.$;return function(g,c){var b={};b.elem=g;b.notify=function(b){c.notifySubscribers("colorpicker",
b)};b.bindEvents=function(){a(".ac-color-li",b.elem).bind("click",function(){var e=a(this).find("div").attr("data-color"),f=j.get(a(".ac-color-picker-trigger",b.elem).parent());a(".ac-simplecolorpicker",b.elem).css("background-color",e);b.notify(e);f.hide()})};b.init=function(){a(".ac-is-single-color").length===a(".ac-controls-container").length?(b.notify(a(".ac-is-single-color").attr("data-color")),d.isApp()&&a(".ac-colorpicker").hide()):(b.bindEvents(),b.notify(a(".ac-color-li",b.elem).find("div").attr("data-color")))};
b.init();return b}})})();(function(){s.when("A","a-dropdown","ac-utils","ready").register("ac-font-picker",function(l,j){var h=l.$;return function(d,a){var g={};g.elem=d;g.notify=function(c){a.notifySubscribers("fontpicker",c)};g.init=function(){h(".ac-simple-text-font-picker",d);var c;h(".ac-mobile-app").length>=1&&(c="pcFont"+h("#a",h("#addToCart")).val(),c=j.getSelect(c),c.update({option_prompt:c.getOption(0).info()[0].text}),c.getOptions().size()===1&&(c.update({status:"disabled"}),h(".ac-fontpicker").hide()));
h("select",h(".ac-simple-text-font-picker",h("div[data-surface='"+a.id+"']"))).change(function(){var b=h(this).val();a.fontName=h(this).find("option:selected").text();g.notify(b)});h("select option:first-child",h(".ac-simple-text-font-picker")).click().change()};g.init();return g}})})();(function(){s.when("A","ready").register("ac-constants",function(){return{AssetType:{IMAGE:"image"},StatusCode:{NON_HTML5_BROWSER:"NON-HTML5-BROWSER",NON_IMAGE_TYPE:"NON-IMAGE-TYPE",INVALID_FILE_TYPE:"INVALID_FILE_TYPE",
READ_SUCCESS:"READ-SUCCESS",READ_NOT_REQUIRED:"READ_NOT_REQUIRED",INVALIDFILESIZE:"INVALID-FILE-SIZE"},defaults:{thumbnailWidth:80,thumbnailHeight:80,thresholdImageWidth:50,thresholdImageHeight:50,galWidth:400,galHeight:400},scaleRatio:8,outputSVGDimention:{height:3200,width:3200},textDefaults:{fontFamily:"Arial, Helvetica, sans-serif",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",fill:"#FF9900",text:"",angle:0,opacity:1,fontSize:20}}})})();(function(){s.when("A","ac-utils",
"ac-gallery-base","ac-constants","ac-error-handling","ready").register("ac-image-gallery",function(l,j,h,d,a){var g=l.$,c=function(){};c.prototype=new h;c.prototype.Init=function(){};g.extend(c.prototype,{getMediaServerUrl:function(){var b="";return"https://images-na.ssl-images-amazon.com/images/S/"+this.bucket+"/"+this.getResourcePath()+"._SL80_"+this.extension},isValidFile:function(b,e){var f=d.StatusCode;if(typeof FileReader!=="undefined")if(/(jpg|jpeg|png)$/i.test(b.name.toLowerCase())){var a=
new FileReader;a.onload=function(){var c=new Image,g=b.size/1024;g>7168?e({statusCode:f.INVALIDFILESIZE}):(c.onload=function(){e&&typeof e==="function"&&e({statusCode:f.READ_SUCCESS,imageHeight:c.height,imageWidth:c.width,imageSize:g})},c.onerror=function(){e&&typeof e==="function"&&e({statusCode:f.INVALID_FILE_TYPE})},c.src=a.result)};a.readAsDataURL(b)}else e&&typeof e==="function"&&e({statusCode:f.INVALID_FILE_TYPE});else e&&typeof e==="function"&&e({statusCode:f.NON_HTML5_BROWSER})},setKey:function(){this.resourcePath=
this.getResourcePath();this.extension=this.getFileExtension();this.key=this.resourcePath+this.extension},isValidFileType:function(b){return/(jpg|jpeg|png)$/i.test(b.name.toLowerCase())?!0:!1},createResourceStub:function(b,e){var f=g(".ac-custom-image-container").clone();f.find("img").attr("id","ac-custom-image-"+e);b.parent().find("#ac-custom-upload-preview-container").append(f)},updateView:function(b,e){e===d.StatusCode.NON_HTML5_BROWSER?this.validateImage(b):this.updateImage(b)},displayWarningIfRequired:function(b){var e=
d.defaults.thresholdImageWidth,f=d.defaults.thresholdImageHeight,c=b.imageHeight,g=b.imageWidth,b=c>g?c:g,c=c>g?g:c;a.hide();c<e||b<f?a.show("pc-resolution-warning"):a.hide()},updateImage:function(b){var e=this.getMediaServerUrl(),f,c;f=g("<div>").addClass("customer-image-container");c=g("<img>").addClass("a-declarative customer-uploaded-image");c.attr({id:"#ac-custom-image-"+b.resourceIndex,src:e,"data-original-url":b.pcImageUrl,"data-original-width":b.imageWidth,"data-original-height":b.imageHeight,
"data-preview-url":b.pcImageUrl,"data-action":"customer-uploaded-image","data-token":b.imageToken});b=g("<div>").addClass("swatch-arrow");f.append(c);f.append(b);c.load(function(){c.trigger("click");g(".ac-uploaded-image").prepend(f);g(".ac-select-uploaded-image").fadeIn()}).error(function(){c.parent(".customer-image-container").remove();a.show("pc-image-mime-type-incorrect");g(".ac-select-uploaded-image").fadeOut();j.imageLoading.hide()})},validateImage:function(b){var e={bucketName:this.getBucket(),
fileKey:b.imageToken.split("/")[1]},f=this;j.imageLoading.show();l.ajax("/gp/product/features/callValidateImage.html/ref=dp_pc_val_img",{method:"POST",params:e,success:function(e){e.result.isValid==="1"?(b.imageWidth=e.result.width,b.imageHeight=e.result.height,f.updateImage(b)):(j.imageLoading.hide(),e.result.errorString&&e.result.errorString.length?a.show(null,{type:"error",message:e.result.errorString}):a.show("pc-upload-error-message"))},error:function(){a.show("pc-upload-error-message");j.imageLoading.hide()}})},
populateImageObject:function(b,e){var f={};f.imageUrl=b.attr("data-preview-url");f.isCustomerImage=e;f.element=b;return f},imageSelection:function(){var b=this.populateImageObject,e=this.displayWarningIfRequired;l.declarative.remove("customer-uploaded-image","click");l.declarative("customer-uploaded-image","click",function(f){var a=b(f.$currentTarget,!0);g(".selected.customer-image-container").removeClass("selected");f.$currentTarget.parent().addClass("selected");l.trigger("addCustomerImage",a);e({imageWidth:f.$currentTarget.attr("data-original-width"),
imageHeight:f.$currentTarget.attr("data-original-height")});j.imageLoading.show()})},scaleImage:function(b){var e,f,a,c;f=parseInt(g(b.element).attr("data-original-width"),10)/d.scaleRatio;parseInt(g(b.element).attr("data-original-height"),10);e=/[.]/.exec(b.imageUrl)?/[^.]+$/.exec(b.imageUrl):u;b=b.imageUrl.split(e[0]);a=e[0];c="";a.toLowerCase()==="png"&&(c="_AL__FMPng_");return b[0]+"_SX"+f+"_"+c+"."+e[0]}});return c})})();(function(){s.when("A","ac-base").register("ac-gallery",function(l,j){var h=
l.$,d;d=function(a,g,c){var b=this;this.options=h.extend({thumbnailWidth:80,thumbnailHeight:80,pageSize:100,categoryContainerSelector:"#ac-gallery",enableLazyLoading:!0,confineToContainerSelector:"body"},a);var e=h(b.options.confineToContainerSelector),f,k=u,d={checkIfCategoryAlreadyLoaded:function(b){var f=!1,e="";h('.theme-image-container[data-theme="'+b+'"]').length>0?(e=h('.theme-image-container[data-theme="'+b+'"]'),f=!0):e=h("<div>").addClass("theme-image-container").attr({"data-theme":b});
return{container:e,isEmpty:!f}},checkIfCategoryExistsInObject:function(b){for(var e=f.contentLibraryList.length,a=0,c=!1,a=0;a<e;a+=1)if(f.contentLibraryList[a].title===b||f.contentLibraryList[a].contentLibraryId===b){c=!0;break}return c},formatResponseObject:function(b){if(b.inlineData!==u)b.contentLibraryList=b.inlineData.contentLibraryList,b.contentLibraryIds=b.inlineData.contentLibraryIds;for(var f=0;f<b.contentLibraryIds.length;f++){var e=b.contentLibraryIds[f];b.contentLibraryIds[f]=d.getFormattedName(e)}for(f=
0;f<b.contentLibraryList.length;f++){var a=b.contentLibraryList[f],e=a.title;a.title=d.getFormattedName(e)}b.defaultLibrary=d.getFormattedName(b.defaultLibrary);return b},formatNewResponseObject:function(b){if(b.contentList.length)b.contentLibraryList=[b],b.contentLibraryIds="/"+b.title;for(var f=0;f<b.contentLibraryIds.length;f++){var e=b.contentLibraryIds[f];b.contentLibraryIds[f]=d.getFormattedName(e)}for(f=0;f<b.contentLibraryList.length;f++){var a=b.contentLibraryList[f],e=a.title;a.title=d.getFormattedName(e)}b.defaultLibrary=
d.getFormattedName(b.defaultLibrary);return b},getFormattedName:function(b){if(!b)return null;var f=b;b.charAt(0)==="/"&&(f=b.substr(1,b.length));return f},getGalleryInputData:function(b){var f={};if(j.getOfferListingID()!==u)f.url="/gp/product/features/getContentLibrary.html",f.data={merchantId:j.getMerchantID(),contentLibraryName:String(b)};return f},getContentLibraryObject:function(b){if(f===k)return k;b=d.getIndexOfCategory(f.contentLibraryList,b);return b===-1?k:f.contentLibraryList[b]},getIndexOfCategory:function(b,
f){var e=b.length,a;for(a=0;a<e;a+=1)if(b[a].title.toLowerCase()===f.toLowerCase())return a;return-1},lazyload:function(){var b=h(".ac-gallery-container"),f=h(".pc-lazyload-error-message");return{success:function(){f.removeClass("active");b.show()},error:function(){b.hide();f.addClass("active");d.loading.hide()}}}(),loading:function(){var b=h(".pc-lazyload-image");return{show:function(){b.addClass("active")},hide:function(){b.removeClass("active")}}}(),populateImageObject:function(b,f){var e={},a=
b.data("original-url"),a=a.substr(a.lastIndexOf("."),a.length);e.imageUrl=b.data("preview-url");e.isCustomerImage=f;e.token=h(".pc-category-name.active").attr("data-themename")+"/"+b.attr("data-token")+a;return e}},o=u,i=function(){var f={categorySelection:function(){l.declarative.remove("category-selection","click");l.declarative("category-selection","click",function(f){var e=f.$currentTarget.attr("data-themename"),a=f.$currentTarget.attr("data-categoryid");p.BuildGallery(e);h(".ac-selected-gallery-name").html(e).attr({"data-contentId":a,
title:e});h("a",h(b.options.categoryContainerSelector)).removeClass("active");f.$currentTarget.addClass("active");h(".vendor-category",h(b.options.categoryContainerSelector)).removeClass("a-active");f.$currentTarget.parent(".vendor-category").addClass("a-active");o!==u&&o.hide()})},imageContainerScroll:function(){if(b.options.enableLazyLoading){var f=h(".ac-gallery-container");f.scroll(function(b){b.preventDefault();if(f.scrollTop()>=h(".ac-gallery-content").height()-f.height()){var b=h("a.active",
h(".vendor-categories")).attr("data-themename"),e=d.checkIfCategoryAlreadyLoaded(b);p.AppendImages(b,e,!1)}})}},imageSelection:function(){l.declarative.remove("ac-gallery-content-image","click");l.declarative("ac-gallery-content-image","click",function(b){var f=d.populateImageObject(b.$currentTarget,!1);f.vendorGalleryFileId=h(b.$target).attr("data-contentid");f.vendorGalleryId=h(".vendor-category .pc-category-name.active").attr("data-categoryid");f.originalURL=h(b.$target).attr("data-original-url");
h(".selected.ac-gallery-content-container").removeClass("selected");b.$currentTarget.parent().addClass("selected");l.trigger("hideWarningMessage");l.trigger("addGalleryImage",f);h("a.active",h(".vendor-category")).attr("data-themename")})},popover:function(){l.off("a:popover:show:vendor-categories");l.on("a:popover:show:vendor-categories",function(b){o=b.popover})}};return{Init:function(){f.categorySelection();f.imageSelection();f.imageContainerScroll();f.popover()}}}(),n=function(){function a(b,
f,e){var c=h("<li>"),g=h("<a>");g.attr({"data-themename":b,"data-action":"category-selection","data-categoryId":f?f:b,title:b});c.addClass("a-tab-heading vendor-category");g.addClass(" a-declarative ");g.attr("href","#").addClass("pc-category-name").html(b);c.append(g);e.append(c)}var c={defaultCategory:function(){h(".pc-category-name").each(function(b,e){if(h(e).attr("data-themename")===f.defaultLibrary||h(e).attr("data-categoyid")===f.defaultLibraryId)return setTimeout(function(){h(e).trigger("click")},
200),!1});h(".ac-selected-gallery-name").text(f.defaultLibrary).attr({"data-categoryid":f.defaultLibraryId,title:f.defaultLibrary})}};return{Build:function(){var g;d.loading.hide();try{for(var k=f.contentLibraryIds.length,o=h("<div>"),n,p=0;p<f.contentLibraryList.length;p++){f.contentLibraryList[p].contentLibraryId=d.getFormattedName(f.contentLibraryList[p].contentLibraryId);if(f.contentLibraryList[p].contentLibraryId&&f.contentLibraryList[p].contentLibraryId===f.defaultLibrary)f.defaultLibraryId=
f.contentLibraryList[p].contentLibraryId,f.defaultLibrary=f.contentLibraryList[p].title;if(!f.contentLibraryList[p].contentLibraryId)f.contentLibraryList[p].contentLibraryId=f.contentLibraryList[p].title}if(!f.defaultLibraryId)f.defaultLibraryId=f.defaultLibrary;d.checkIfCategoryExistsInObject(f.defaultLibrary)&&a(f.defaultLibrary,f.defaultLibraryId,o);for(n=0;n<k;n+=1)g=f.contentLibraryList[n].title,g!==f.defaultLibrary&&d.checkIfCategoryExistsInObject(f.defaultLibrary)&&a(g,f.contentLibraryList[n].contentLibraryId,
o);h(b.options.categoryContainerSelector,e).append(o.html());i.Init();c.defaultCategory()}catch(y){d.lazyload.error()}}}}(),p=function(){function f(e,a,c){var g=d.getContentLibraryObject(e),e=g.contentList,g=g.contentList.length,k=h("<div>"),i;if(b.options.enableLazyLoading||c){b.options.enableLazyLoading?c?(i=0,c=g<b.options.pageSize?g:b.options.pageSize):(c=a.container.data("endIndex"),i=c+1,c=g<c+b.options.pageSize?g:c+b.options.pageSize):(i=0,c=g);for(;i<c;i+=1){var o=e[i],n=h("<div>").addClass("ac-gallery-content-container"),
p=h("<img>"),y=h("<div>").addClass("swatch-arrow");o.status&&o.status!=="Active"||!o.isActive||!o.info||(p.attr({src:o.info.thumbnailURL,"data-original-url":o.info.url,alt:o.description,"data-original-width":o.width?o.width:2500,"data-original-height":o.height?o.height:3500,"data-preview-url":o.info.previewURL,"data-thumbnail-url":o.info.thumbnailURL,"data-action":"ac-gallery-content-image","data-token":o.title,"data-contentId":o.ContentId?o.ContentId:o.title,isExclusive:1}),p.addClass("ac-gallery-content-image a-declarative"),
n.append(p),n.append(y),k.append(n))}e=k.html();a.isEmpty?(h(".ac-gallery-content").append(a.container.append(e)),a.container.data("endIndex",c),a.container.data("length",g)):(a.container.data("endIndex",c),a.container.append(e))}}return{AppendImages:f,BuildGallery:function(b){var a=d.checkIfCategoryAlreadyLoaded(b);h(".theme-image-container",e).hide();h(".ac-gallery-container").scrollTop(0);a.isEmpty?f(b,a,!0):(h(".ac-gallery-container").scrollTop(0),h('.theme-image-container[data-theme="'+b+'"]',
e).show())}}}(),y=function(b,e){var a=d.getGalleryInputData(b),c=h.Deferred();a.data.contentLibraryName="/"+a.data.contentLibraryName.replace("/","");h.ajax({type:"GET",url:a.url,dataType:"json",data:a.data,success:function(b){d.lazyload.success();f=h.parseJSON(b.result);if(f===null||f.Status==="Error")d.lazyload.error();else return c.resolve(f,e)},error:function(b){return c.reject(b,e)}});return c.promise()};return{Fetch:function(){var b=[],e={},a=0,k;k=function(){++a;if(a===g.length){for(var k=
0;k<b.length;k++)b[k]||(b.splice(k,1),g.splice(k,1));e.inlineData={contentLibraryList:b,contentLibraryIds:g};k=!1;if(c)for(var i=0;i<e.inlineData.contentLibraryList.length;i++)if(e.inlineData.contentLibraryList[i].contentLibraryId===c||e.inlineData.contentLibraryList[i].title===c){k=!0;break}e.defaultLibrary=k?c:g[0];f=d.formatResponseObject(e);n.Build()}};for(var i=0;i<g.length;i++)h.when(y(g[i],i)).then(function(f,e){b[e]=f.status&&f.status==="Active"&&f.contentList||f.isActive&&f.contentList?f:
null;k()},function(f,e){b[e]=null;k()})}}};d.prototype=j;return d})})();(function(){s.when("A","ac-utils","ac-constants","ac-image-gallery","ac-error-handling","ready").register("AssetUploader",function(l,j,h,d,a){var g=l.$,c=function(b){this.assetType=b.assetType;this.$form=b.$form;this.mediaServer=b.mediaServer;this.index=0};c.prototype.getComponentName=function(){return"AssetUploader"};c.prototype.getUploadTypeObject=function(b){var e;b==="image"&&(e=new d);e.index=this.index++;return e};c.prototype.Init=
function(){var b=this.$form,e=this.getUploadTypeObject(this.assetType);b.find("input[type='file']").attr("multiple",!1);e.imageSelection();b.fileupload({autoUpload:!0,url:g(".ac-custom-upload-form").attr("action"),dataType:"json",type:"POST",add:function(f,c){var d=c.files[0];c.resourceIndex=e.index;e.isValidFile(d,function(f){g.extend(c,f);c.statusCode===h.StatusCode.INVALID_FILE_TYPE?a.show("pc-image-mime-type-incorrect",{timeOut:"6000"}):c.statusCode===h.StatusCode.INVALIDFILESIZE?a.show("pc-image-size-incorrect",
{timeOut:"6000"}):(e.createResourceStub(b,c.resourceIndex),l.post("/gp/features/fetch-imageUpload-s3post-parameters.html",{dataType:"json",params:{contentType:"image",csrfToken:g(".ac-custom-upload-form").attr("data-csrf"),uid:e.getResourcePath(),extension:"."+c.fileInput.val().split(".").pop().toLowerCase(),isDPX:1},success:function(f){c.uploadObject=e;e.setBucket(f.imageToken.split("/")[0]);e.setFileName(d.name);e.setKey(c.resourceIndex);e.setResourcePath(f.key.split(".")[0]);e.getKey();b.attr("action",
f.action);g("#key",b).val(f.key);g("#AWSAccessKeyId",b).val(f.AWSAccessKeyId);g("#policy",b).val(f.policy);g("#signature",b).val(f.signature);g("#success_action_status",b).val(f.statusCode);g("#expires",b).val(f.expires);c.pcImageUrl=f.thumbnailUrl;c.imageName=f.key;c.imageToken=f.imageToken;c.submit()},error:function(){a.show("pc-upload-error-message",{timeOut:"6000"});l.trigger("amazon-custom-log-ref-tag","logS3TextUploadError")}}))})},send:function(){g(".ac-upload-progress").text("0%");j.imageLoading.show()},
fail:function(){j.imageLoading.hide();a.show("pc-upload-error-message",{timeOut:"6000"});g(".ac-upload-progress").text("");l.trigger("amazon-custom-log-ref-tag","logS3ImageUploadError")},done:function(b,e){g(".ac-upload-progress").text("100%");j.imageLoading.hide();e.uploadObject.updateView(e,e.statusCode);g(".ac-upload-progress").text("")},progress:function(b,e){var a=parseInt(e.loaded/e.total*100,10);g(".ac-upload-progress").text(a+"%")}})};return c});s.when("A","AssetUploader","ac-constants","ready").execute(function(l,
j){l.declarative("asset-upload","click",function(h){var d;h.$target.data("asset-upload")===u&&(d=new j({$form:h.$target.parentsUntil(".ac-custom-upload-container","form"),assetType:"image",uploadType:h.data["upload-type"],mediaServer:"https://images-na.ssl-images-amazon.com/images/S/"}),d.Init(),h.$target.data("asset-upload",d))})})})();(function(){s.when("A","ready").register("ac-gallery-base",function(){var l=function(){};l.prototype={generateUUID:function(){function j(){return Math.floor((1+Math.random())*
65536).toString(16).substring(1)}return j()+j()+"-"+j()+"-"+j()+"-"+j()+"-"+j()+j()+j()},getTimeStamp:function(){var j=new Date;return j.getUTCFullYear()+"-"+j.getUTCMonth()+"-"+j.getUTCDate()+"-"+j.getUTCHours()+"-"+j.getUTCMinutes()},getFileExtension:function(){var j=/^.+\.([^.]+)$/.exec(this.fileName);return j===null?"":"."+j[1].toLowerCase()},getFileNameWithoutExtension:function(){var j=this.fileName.split(".")[0];return j===null?"":j.toLowerCase()},getKey:function(){return this.key},isValidFile:function(){console.log("No Implementation - isValidFile")},
setBucket:function(j){this.bucket=j},getBucket:function(){return this.bucket},setFileName:function(j){this.fileName=j},updateView:function(){console.log("No Implementation - ValidateAndUpdate")},setResourcePath:function(j){this.ResourcePath=j},getResourcePath:function(){return this.ResourcePath}};return l})})();(function(){s.when("A","ac-base","ac-utils","ready").register("ac-error-handling",function(l,j,h){var d=l.$,a,g,c,b,e;a=function(){return d(".ac-error-container")};g=function(){return d(".ac-error-container .a-alert-heading")};
c=function(){return d(".ac-error-container .a-alert-content")};b=function(b){var a;a={type:b.type?b.type:"error",message:b.message};if(e.indexOf(b.id)!==-1)a.type="warning";return a};e=["pc-error-generic-text","pc-resolution-warning","pc-scale-warning-message","pc-generic-warning-text"];return{show:function(f,e){var d={};f?d=b({id:f,message:h.stringHandler(f)}):(d.type=e.type,d.message=e.message);a().removeClass("a-alert-warning a-alert-error a-alert-success a-alert-info").addClass("a-alert-"+d.type);
g().text(d.type.charAt(0).toUpperCase()+d.type.slice(1)+" Message");c().html(d.message);a().addClass("active");e&&e.timeOut&&setTimeout(function(){a().removeClass("active")},parseInt(e.timeOut,10))},hide:function(){a().removeClass("active")}}})})();(function(){s.when("A","a-dropdown","ac-base","ac-utils","fabric-js","ac-constants","ready").register("ac-text-image",function(l,j,h,d,a,g){var c=l.$;return function(b){var e=this,f,k,m={},h;h=function(){m=c.extend({},g.textDefaults);k&&k.setText("")};
e.isInitialized=!1;e.changeFont=function(b){e.updateText({fontFamily:b})};e.toggleStyle=function(b){var f={};switch(b){case "boldoff":f.fontWeight="normal";e.updateText(f);break;case "boldon":f.fontWeight="bold";e.updateText(f);break;case "italicson":f.fontStyle="italic";e.updateText(f);break;case "italicsoff":f.fontStyle="normal";e.updateText(f);break;case "underlineon":f.textDecoration="underline";e.updateText(f);break;case "underlineoff":f.textDecoration="normal",e.updateText(f)}};e.style=function(){};
e.changeAlign=function(b){var f={};switch(b){case "left":f.textAlign="left";e.updateText(f);break;case "center":f.textAlign="center";e.updateText(f);break;case "right":f.textAlign="right",e.updateText(f)}};e.changeTextColor=function(b){c(".simplecolorpicker.icon").css("background-color",b);e.updateText({fill:b})};e.editText=function(b){k.setText(b);e.updateText(null)};e.resetControl=function(){c("#pcTextArea").val("");c(".pc-textArea-fontStyle-li").removeClass("button-active");c(".pc-textArea-fontAlign-li").removeClass("button-active");
c('.pc-textArea-fontAlign-li[data-align="left"]').addClass("button-active");j.getSelect("fontPicker").setValue("Arial");c(".simplecolorpicker.icon").css({"background-color":c("ul.pc-textArea-fontColor-ul li.pc-textArea-fontColor-li:first-child div").css("background-color")})};e.updateControl=function(){if(e.isInitialized){e.resetControl();var f=b.getObjects();m.text="";for(var a=0;a<f.length;a++)if(f[a].type==="text")m.text=f[a].text;c("#pcTextArea").val(m.text);m.fontWeight==="bold"&&c('.pc-textArea-fontStyle-li[data-style="bold"]').addClass("button-active");
m.textDecoration==="underline"&&c('.pc-textArea-fontStyle-li[data-style="underline"]').addClass("button-active");m.fontStyle==="italic"&&c('.pc-textArea-fontStyle-li[data-style="italics"]').addClass("button-active");m.textAlign==="right"?(c(".pc-textArea-fontAlign-li").removeClass("button-active"),c('.pc-textArea-fontAlign-li[data-align="right"]').addClass("button-active")):m.textAlign==="center"&&(c(".pc-textArea-fontAlign-li").removeClass("button-active"),c('.pc-textArea-fontAlign-li[data-align="center"]').addClass("button-active"));
j.getSelect(c("#fontPicker")).setValue(m.fontFamily);c(".simplecolorpicker.icon").css({"background-color":m.fill})}else e.init(),e.resetControl()};e.select=function(){for(var f=b.getObjects(),e=b.canvas.size()-1;e>=0;e--)f[e].id&&f[e].id==="text-"+b.id&&b.canvas.setActiveObject(f[e])};e.deSelect=function(){for(var f=b.getObjects(),e=b.canvas.size()-1;e>=0;e--)f[e].id&&f[e].id==="text-"+b.id&&b.canvas.setActiveObject(f[e])};f=function(f){for(var k,d=b.getObjects(),i=b.canvas.size()-1;i>=0;i--)if(d[i].id&&
d[i].id===f.id)return null;k=function(f){b.canvas.add(f);f.bringToFront();b.canvas.calcOffset();f.setCoords();b.canvas.setActiveObject(f);b.renderAll()};f=function(f){var e={};c.extend(e,f,g.textDefaults);e.id="text-"+b.id;return m=e}(f?f:{});f.fontSize=b.canvas.width/5;f.fill=b.surface.data.FontSettings.colors[0].value;c("#pcTextArea").val("");e.updateText(null);return function(){var e=new a.Text(f.text,{angle:f.angle,opacity:f.opacity,fontFamily:f.fontFamily,fontSize:f.fontSize,fontWeight:f.fontWeight,
fontStyle:f.fontStyle,id:f.id,cursorColor:"#ffffff",fill:f.fill,transparentCorners:!1,centeredRotation:!0,centeredScaling:!0,padding:5,originX:"left",originY:"top",selectable:!0,textAlign:f.textAlign});e.set({left:20,top:b.canvas.height/2-f.fontSize/2});k(e);return e}()};var i=function(f){for(var e=b.getObjects(),a=e.length-1;a>=0;a--)e[a].name&&e[a].name==="galImage"&&b.canvas.remove(e[a]);if(k){k.bringToFront();b.canvas.calcOffset();if(typeof f==="object")k.set(f),c.extend(m,m,f);else if(typeof f===
"string")k.setText(f),m.text=f,c("#pcTextArea").val(f);k.setCoords();b.canvas.setActiveObject(k);m.text===""?c(".pc-two-column-layout .ac-delete-button").fadeOut():c(".pc-two-column-layout .ac-delete-button").fadeIn()}b.renderAll()};e.updateText=function(f){var a,c,g,k,m=!1;a=b.getObjects();c=d.stringHandler("pc-clear-design-msg");g=function(){b.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var f=b.getObjects(),e=0;e<f.length;e++)f[e].name&&f[e].name==="galImage"&&
b.clear()})});i(f)};k=function(){for(var f=b.canvas.size()-1;f>=0;f--)if(a[f].type==="text"){a[f].remove();break}e.cleared();b.controls.textInput.isControlActive=!1};b.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var b=b.getObjects(),f=0;f<b.length;f++)if(b[f].name&&b[f].name==="galImage"){m=!0;break}})});m?d.showDialog.show(c,g,{ok:"Clear",cancelCallBack:k}):g()};e.cleared=function(){e.resetControl();h();e.isInitialized=!1};e.init=function(){e.isInitialized=
!0;k=f()}}})})()})})(function(){var s=window.AmazonUIPageJS||window.P,B=s._namespace||s.attributeErrors;return B?B("ProductCustomizationSingleTextAssets"):s}(),window);
(function(s,B,u){s.execute(function(){s.when("A","jQuery").register("jq-ui-widget",function(l,j){(function(h){h(j)})(function(h,d){var a=0,g=Array.prototype.slice,c=h.cleanData;h.cleanData=function(b){for(var e=0,f;(f=b[e])!=null;e++)try{h(f).triggerHandler("remove")}catch(a){}c(b)};h.widget=function(b,e,f){var a,c,g,d,n={},p=b.split(".")[0],b=b.split(".")[1];a=p+"-"+b;if(!f)f=e,e=h.Widget;h.expr[":"][a.toLowerCase()]=function(b){return!!h.data(b,a)};h[p]=h[p]||{};c=h[p][b];g=h[p][b]=function(b,f){if(!this._createWidget)return new g(b,
f);arguments.length&&this._createWidget(b,f)};h.extend(g,c,{version:f.version,_proto:h.extend({},f),_childConstructors:[]});d=new e;d.options=h.widget.extend({},d.options);h.each(f,function(b,f){n[b]=h.isFunction(f)?function(){var a=function(){return e.prototype[b].apply(this,arguments)},c=function(f){return e.prototype[b].apply(this,f)};return function(){var b=this._super,e=this._superApply,g;this._super=a;this._superApply=c;g=f.apply(this,arguments);this._super=b;this._superApply=e;return g}}():
f});g.prototype=h.widget.extend(d,{widgetEventPrefix:c?d.widgetEventPrefix||b:b},n,{constructor:g,namespace:p,widgetName:b,widgetFullName:a});c?(h.each(c._childConstructors,function(b,f){var e=f.prototype;h.widget(e.namespace+"."+e.widgetName,g,f._proto)}),delete c._childConstructors):e._childConstructors.push(g);h.widget.bridge(b,g)};h.widget.extend=function(b){for(var e=g.call(arguments,1),f=0,a=e.length,c,o;f<a;f++)for(c in e[f])o=e[f][c],e[f].hasOwnProperty(c)&&o!==d&&(b[c]=h.isPlainObject(o)?
h.isPlainObject(b[c])?h.widget.extend({},b[c],o):h.widget.extend({},o):o);return b};h.widget.bridge=function(b,e){var f=e.prototype.widgetFullName||b;h.fn[b]=function(a){var c=typeof a==="string",o=g.call(arguments,1),i=this,a=!c&&o.length?h.widget.extend.apply(null,[a].concat(o)):a;c?this.each(function(){var e,c=h.data(this,f);if(!c)return h.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+a+"'");if(!h.isFunction(c[a])||a.charAt(0)==="_")return h.error("no such method '"+
a+"' for "+b+" widget instance");e=c[a].apply(c,o);if(e!==c&&e!==d)return i=e&&e.jquery?i.pushStack(e.get()):e,!1}):this.each(function(){var b=h.data(this,f);b?b.option(a||{})._init():h.data(this,f,new e(a,this))});return i}};h.Widget=function(){};h.Widget._childConstructors=[];h.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,e){e=h(e||this.defaultElement||this)[0];this.element=h(e);this.uuid=a++;this.eventNamespace=
"."+this.widgetName+this.uuid;this.options=h.widget.extend({},this.options,this._getCreateOptions(),b);this.bindings=h();this.hoverable=h();this.focusable=h();if(e!==this)h.data(e,this.widgetFullName,this),this._on(!0,this.element,{remove:function(b){b.target===e&&this.destroy()}}),this.document=h(e.style?e.ownerDocument:e.document||e),this.window=h(this.document[0].defaultView||this.document[0].parentWindow);this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:h.noop,
_getCreateEventData:h.noop,_create:h.noop,_init:h.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(h.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},
_destroy:h.noop,widget:function(){return this.element},option:function(b,e){var f=b,a,c,g;if(arguments.length===0)return h.widget.extend({},this.options);if(typeof b==="string")if(f={},a=b.split("."),b=a.shift(),a.length){c=f[b]=h.widget.extend({},this.options[b]);for(g=0;g<a.length-1;g++)c[a[g]]=c[a[g]]||{},c=c[a[g]];b=a.pop();if(arguments.length===1)return c[b]===d?null:c[b];c[b]=e}else{if(arguments.length===1)return this.options[b]===d?null:this.options[b];f[b]=e}this._setOptions(f);return this},
_setOptions:function(b){for(var e in b)this._setOption(e,b[e]);return this},_setOption:function(b,e){this.options[b]=e;b==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"));return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,e,f){var a,c=this;typeof b!==
"boolean"&&(f=e,e=b,b=!1);f?(e=a=h(e),this.bindings=this.bindings.add(e)):(f=e,e=this.element,a=this.widget());h.each(f,function(f,g){function d(){return!b&&(c.options.disabled===!0||h(this).hasClass("ui-state-disabled"))?void 0:(typeof g==="string"?c[g]:g).apply(c,arguments)}if(typeof g!=="string")d.guid=g.guid=g.guid||d.guid||h.guid++;var p=f.match(/^(\w+)\s*(.*)$/),y=p[1]+c.eventNamespace;(p=p[2])?a.delegate(p,y,d):e.bind(y,d)})},_off:function(b,e){e=(e||"").split(" ").join(this.eventNamespace+
" ")+this.eventNamespace;b.unbind(e).undelegate(e)},_delay:function(b,e){var f=this;return setTimeout(function(){return(typeof b==="string"?f[b]:b).apply(f,arguments)},e||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b);this._on(b,{mouseenter:function(b){h(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){h(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b);this._on(b,{focusin:function(b){h(b.currentTarget).addClass("ui-state-focus")},
focusout:function(b){h(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,e,f){var a,c=this.options[b],f=f||{},e=h.Event(e);e.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();e.target=this.element[0];if(b=e.originalEvent)for(a in b)a in e||(e[a]=b[a]);this.element.trigger(e,f);return!(h.isFunction(c)&&c.apply(this.element[0],[e].concat(f))===!1||e.isDefaultPrevented())}};h.each({show:"fadeIn",hide:"fadeOut"},function(b,e){h.Widget.prototype["_"+b]=function(f,
a,c){typeof a==="string"&&(a={effect:a});var g,d=!a?b:a===!0||typeof a==="number"?e:a.effect||e,a=a||{};typeof a==="number"&&(a={duration:a});g=!h.isEmptyObject(a);a.complete=c;a.delay&&f.delay(a.delay);if(g&&h.effects&&h.effects.effect[d])f[b](a);else if(d!==b&&f[d])f[d](a.duration,a.easing,c);else f.queue(function(e){h(this)[b]();c&&c.call(f[0]);e()})}})})});s.when("A","jQuery").register("jq-IframeTransport",function(l,j){(function(h){h(j)})(function(h){var d=0;h.ajaxTransport("iframe",function(a){if(a.async){var g=
a.initialIframeSrc||"javascript:false;",c,b,e;return{send:function(f,k){c=h('<form style="display:none;"></form>');c.attr("accept-charset",a.formAcceptCharset);e=/\?/.test(a.url)?"&":"?";if(a.type==="DELETE")a.url=a.url+e+"_method=DELETE",a.type="POST";else if(a.type==="PUT")a.url=a.url+e+"_method=PUT",a.type="POST";else if(a.type==="PATCH")a.url=a.url+e+"_method=PATCH",a.type="POST";d+=1;b=h('<iframe src="'+g+'" name="iframe-transport-'+d+'"></iframe>').bind("load",function(){var f,e=h.isArray(a.paramName)?
a.paramName:[a.paramName];b.unbind("load").bind("load",function(){var f;try{if(f=b.contents(),!f.length||!f[0].firstChild)throw Error();}catch(e){f=u}k(200,"success",{iframe:f});h('<iframe src="'+g+'"></iframe>').appendTo(c);B.setTimeout(function(){c.remove()},0)});c.prop("target",b.prop("name")).prop("action",a.url).prop("method",a.type);a.formData&&h.each(a.formData,function(b,f){f.name!=="file"&&h('<input type="hidden"/>').prop("name",f.name).val(f.value).appendTo(c)});a.fileInput&&a.fileInput.length&&
a.type==="POST"&&(f=a.fileInput.clone(),a.fileInput.after(function(b){return f[b]}),a.paramName&&a.fileInput.each(function(b){h(this).prop("name",e[b]||a.paramName)}),c.append(a.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),a.fileInput.removeAttr("form"));c.submit();f&&f.length&&a.fileInput.each(function(b,e){var a=h(f[b]);h(e).prop("name",a.prop("name")).attr("form",a.attr("form"));a.replaceWith(e)})});c.append(b).appendTo(document.body)},abort:function(){b&&
b.unbind("load").prop("src",g);c&&c.remove()}}}});h.ajaxSetup({converters:{"iframe text":function(a){return a&&h(a[0].body).text()},"iframe json":function(a){return a&&h.parseJSON(h(a[0].body).text())},"iframe html":function(a){return a&&h(a[0].body).html()},"iframe xml":function(a){return(a=a&&a[0])&&h.isXMLDoc(a)?a:h.parseXML(a.XMLDocument&&a.XMLDocument.xml||h(a.body).html())},"iframe script":function(a){return a&&h.globalEval(h(a[0].body).text())}}})})});s.when("A","jQuery","jq-ui-widget").register("jq-fileupload",
function(l,j){(function(h){h(j)})(function(h){h.support.fileInput=!(RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(B.navigator.userAgent)||h('<input type="file">').prop("disabled"));h.support.xhrFileUpload=!(!B.ProgressEvent||!B.FileReader);h.support.xhrFormDataFileUpload=!!B.FormData;h.support.blobSlice=B.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);
h.widget("blueimp.fileupload",{options:{dropZone:h(document),pasteZone:h(document),fileInput:u,replaceFileInput:!0,paramName:u,singleFileUploads:!0,limitMultiFileUploads:u,limitMultiFileUploadSize:u,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:u,forceIframeTransport:!1,redirect:u,redirectParamName:u,postMessage:u,multipart:!0,maxChunkSize:u,uploadedBytes:u,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},
i18n:function(d,a){d=this.messages[d]||d.toString();a&&h.each(a,function(a,c){d=d.replace("{"+a+"}",c)});return d},formData:function(d){return d.serializeArray()},add:function(d,a){if(d.isDefaultPrevented())return!1;(a.autoUpload||a.autoUpload!==!1&&h(this).fileupload("option","autoUpload"))&&a.process().done(function(){a.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:h.support.blobSlice&&function(){return(this.slice||
this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(d,a,g){var c=d-this.timestamp;if(!this.bitrate||!g||c>g)this.bitrate=(a-this.loaded)*(1E3/c)*8,this.loaded=a,this.timestamp=d;return this.bitrate}},_isXHRUpload:function(d){return!d.forceIframeTransport&&(!d.multipart&&h.support.xhrFileUpload||h.support.xhrFormDataFileUpload)},_getFormData:function(d){var a;if(h.type(d.formData)===
"function")return d.formData(d.form);if(h.isArray(d.formData))return d.formData;return h.type(d.formData)==="object"?(a=[],h.each(d.formData,function(g,c){a.push({name:g,value:c})}),a):[]},_getTotal:function(d){var a=0;h.each(d,function(g,c){a+=c.size||1});return a},_initProgressObject:function(d){var a={loaded:0,total:0,bitrate:0};d._progress?h.extend(d._progress,a):d._progress=a},_initResponseObject:function(d){var a;if(d._response)for(a in d._response)d._response.hasOwnProperty(a)&&delete d._response[a];
else d._response={}},_onProgress:function(d,a){if(d.lengthComputable){var g=Date.now?Date.now():(new Date).getTime(),c;if(!a._time||!a.progressInterval||!(g-a._time<a.progressInterval&&d.loaded!==d.total))a._time=g,c=Math.floor(d.loaded/d.total*(a.chunkSize||a._progress.total))+(a.uploadedBytes||0),this._progress.loaded+=c-a._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(g,this._progress.loaded,a.bitrateInterval),a._progress.loaded=a.loaded=c,a._progress.bitrate=a.bitrate=a._bitrateTimer.getBitrate(g,
c,a.bitrateInterval),this._trigger("progress",h.Event("progress",{delegatedEvent:d}),a),this._trigger("progressall",h.Event("progressall",{delegatedEvent:d}),this._progress)}},_initProgressListener:function(d){var a=this,g=d.xhr?d.xhr():h.ajaxSettings.xhr();if(g.upload)h(g.upload).bind("progress",function(c){var b=c.originalEvent;c.lengthComputable=b.lengthComputable;c.loaded=b.loaded;c.total=b.total;a._onProgress(c,d)}),d.xhr=function(){return g}},_isInstanceOf:function(d,a){return Object.prototype.toString.call(a)===
"[object "+d+"]"},_initXHRData:function(d){var a=this,g,c=d.files[0],b=d.multipart||!h.support.xhrFileUpload,e=h.type(d.paramName)==="array"?d.paramName[0]:d.paramName;d.headers=h.extend({},d.headers);if(d.contentRange)d.headers["Content-Range"]=d.contentRange;if(!b||d.blob||!this._isInstanceOf("File",c))d.headers["Content-Disposition"]='attachment; filename="'+encodeURI(c.name)+'"';if(b){if(h.support.xhrFormDataFileUpload)d.postMessage?(g=this._getFormData(d),d.blob?g.push({name:e,value:d.blob}):
h.each(d.files,function(b,a){g.push({name:h.type(d.paramName)==="array"&&d.paramName[b]||e,value:a})})):(a._isInstanceOf("FormData",d.formData)?g=d.formData:(g=new FormData,h.each(this._getFormData(d),function(b,e){g.append(e.name,e.value)})),d.blob?g.append(e,d.blob,c.name):h.each(d.files,function(b,c){if(a._isInstanceOf("File",c)||a._isInstanceOf("Blob",c))g.append(h.type(d.paramName)==="array"&&d.paramName[b]||e,c,c.uploadName||c.name)})),d.data=g}else d.contentType=c.type||"application/octet-stream",
d.data=d.blob||c;d.blob=null},_initIframeSettings:function(d){var a=h("<a></a>").prop("href",d.url).prop("host");d.dataType="iframe "+(d.dataType||"");d.formData=this._getFormData(d);d.redirect&&a&&a!==location.host&&d.formData.push({name:d.redirectParamName||"redirect",value:d.redirect})},_initDataSettings:function(d){if(this._isXHRUpload(d)){if(this._chunkedUpload(d,!0)||(d.data||this._initXHRData(d),this._initProgressListener(d)),d.postMessage)d.dataType="postmessage "+(d.dataType||"")}else this._initIframeSettings(d)},
_getParamName:function(d){var a=h(d.fileInput),g=d.paramName;g?h.isArray(g)||(g=[g]):(g=[],a.each(function(){for(var a=h(this),b=a.prop("name")||"files[]",a=(a.prop("files")||[1]).length;a;)g.push(b),a-=1}),g.length||(g=[a.prop("name")||"files[]"]));return g},_initFormSettings:function(d){if(!d.form||!d.form.length)if(d.form=h(d.fileInput.prop("form")),!d.form.length)d.form=h(this.options.fileInput.prop("form"));d.paramName=this._getParamName(d);if(!d.url)d.url=d.form.prop("action")||location.href;
d.type=(d.type||h.type(d.form.prop("method"))==="string"&&d.form.prop("method")||"").toUpperCase();if(d.type!=="POST"&&d.type!=="PUT"&&d.type!=="PATCH")d.type="POST";if(!d.formAcceptCharset)d.formAcceptCharset=d.form.attr("accept-charset")},_getAJAXSettings:function(d){d=h.extend({},this.options,d);this._initFormSettings(d);this._initDataSettings(d);return d},_getDeferredState:function(d){return d.state?d.state():d.isResolved()?"resolved":d.isRejected()?"rejected":"pending"},_enhancePromise:function(d){d.success=
d.done;d.error=d.fail;d.complete=d.always;return d},_getXHRPromise:function(d,a,g){var c=h.Deferred(),b=c.promise(),a=a||this.options.context||b;d===!0?c.resolveWith(a,g):d===!1&&c.rejectWith(a,g);b.abort=c.promise;return this._enhancePromise(b)},_addConvenienceMethods:function(d,a){var g=this,c=function(b){return h.Deferred().resolveWith(g,b).promise()};a.process=function(b,e){if(b||e)a._processQueue=this._processQueue=(this._processQueue||c([this])).pipe(function(){return a.errorThrown?h.Deferred().rejectWith(g,
[a]).promise():c(arguments)}).pipe(b,e);return this._processQueue||c([this])};a.submit=function(){if(this.state()!=="pending")a.jqXHR=this.jqXHR=g._trigger("submit",h.Event("submit",{delegatedEvent:d}),this)!==!1&&g._onSend(d,this);return this.jqXHR||g._getXHRPromise()};a.abort=function(){if(this.jqXHR)return this.jqXHR.abort();this.errorThrown="abort";g._trigger("fail",null,this);return g._getXHRPromise(!1)};a.state=function(){if(this.jqXHR)return g._getDeferredState(this.jqXHR);if(this._processQueue)return g._getDeferredState(this._processQueue)};
a.processing=function(){return!this.jqXHR&&this._processQueue&&g._getDeferredState(this._processQueue)==="pending"};a.progress=function(){return this._progress};a.response=function(){return this._response}},_getUploadedBytes:function(d){var b;var a;return(b=(a=(d=d.getResponseHeader("Range"))&&d.split("-"),d=a)&&d.length>1&&parseInt(d[1],10),d=b)&&d+1},_chunkedUpload:function(d,a){d.uploadedBytes=d.uploadedBytes||0;var g=this,c=d.files[0],b=c.size,e=d.uploadedBytes,f=d.maxChunkSize||b,k=this._blobSlice,
m=h.Deferred(),o=m.promise(),i,n;if(!this._isXHRUpload(d)||!k||!(e||f<b)||d.data)return!1;if(a)return!0;if(e>=b)return c.error=d.i18n("uploadedBytes"),this._getXHRPromise(!1,d.context,[null,"error",c.error]);n=function(){var a=h.extend({},d),o=a._progress.loaded;a.blob=k.call(c,e,e+f,c.type);a.chunkSize=a.blob.size;a.contentRange="bytes "+e+"-"+(e+a.chunkSize-1)+"/"+b;g._initXHRData(a);g._initProgressListener(a);i=(g._trigger("chunksend",null,a)!==!1&&h.ajax(a)||g._getXHRPromise(!1,a.context)).done(function(f,
c,k){e=g._getUploadedBytes(k)||e+a.chunkSize;o+a.chunkSize-a._progress.loaded&&g._onProgress(h.Event("progress",{lengthComputable:!0,loaded:e-a.uploadedBytes,total:e-a.uploadedBytes}),a);d.uploadedBytes=a.uploadedBytes=e;a.result=f;a.textStatus=c;a.jqXHR=k;g._trigger("chunkdone",null,a);g._trigger("chunkalways",null,a);e<b?n():m.resolveWith(a.context,[f,c,k])}).fail(function(b,f,e){a.jqXHR=b;a.textStatus=f;a.errorThrown=e;g._trigger("chunkfail",null,a);g._trigger("chunkalways",null,a);m.rejectWith(a.context,
[b,f,e])})};this._enhancePromise(o);o.abort=function(){return i.abort()};n();return o},_beforeSend:function(d,a){if(this._active===0)this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0;this._initResponseObject(a);this._initProgressObject(a);a._progress.loaded=a.loaded=a.uploadedBytes||0;a._progress.total=a.total=this._getTotal(a.files)||1;a._progress.bitrate=a.bitrate=0;this._active+=1;this._progress.loaded+=a.loaded;
this._progress.total+=a.total},_onDone:function(d,a,g,c){var b=c._progress.total,e=c._response;c._progress.loaded<b&&this._onProgress(h.Event("progress",{lengthComputable:!0,loaded:b,total:b}),c);e.result=c.result=d;e.textStatus=c.textStatus=a;e.jqXHR=c.jqXHR=g;this._trigger("done",null,c)},_onFail:function(d,a,g,c){var b=c._response;c.recalculateProgress&&(this._progress.loaded-=c._progress.loaded,this._progress.total-=c._progress.total);b.jqXHR=c.jqXHR=d;b.textStatus=c.textStatus=a;b.errorThrown=
c.errorThrown=g;this._trigger("fail",null,c)},_onAlways:function(d,a,g,c){this._trigger("always",null,c)},_onSend:function(d,a){a.submit||this._addConvenienceMethods(d,a);var g=this,c,b,e,f,k=g._getAJAXSettings(a),m=function(){g._sending+=1;k._bitrateTimer=new g._BitrateTimer;return c=c||((b||g._trigger("send",h.Event("send",{delegatedEvent:d}),k)===!1)&&g._getXHRPromise(!1,k.context,b)||g._chunkedUpload(k)||h.ajax(k)).done(function(b,f,a){g._onDone(b,f,a,k)}).fail(function(b,f,a){g._onFail(b,f,a,
k)}).always(function(b,f,a){g._onAlways(b,f,a,k);g._sending-=1;g._active-=1;if(k.limitConcurrentUploads&&k.limitConcurrentUploads>g._sending)for(b=g._slots.shift();b;){if(g._getDeferredState(b)==="pending"){b.resolve();break}b=g._slots.shift()}g._active===0&&g._trigger("stop")})};this._beforeSend(d,k);return this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(e=h.Deferred(),this._slots.push(e),
f=e.pipe(m)):f=this._sequence=this._sequence.pipe(m,m),f.abort=function(){b=[u,"abort","abort"];return!c?(e&&e.rejectWith(k.context,b),m()):c.abort()},this._enhancePromise(f)):m()},_onAdd:function(d,a){var g=this,c=!0,b=h.extend({},this.options,a),e=a.files,f=e.length,k=b.limitMultiFileUploads,m=b.limitMultiFileUploadSize,o=b.limitMultiFileUploadSizeOverhead,i=0,n=this._getParamName(b),p,y,w=0;if(m&&(!f||e[0].size===u))m=u;if(!b.singleFileUploads&&!k&&!m||!this._isXHRUpload(b))y=[e],p=[n];else if(!b.singleFileUploads&&
!m&&k){y=[];p=[];for(b=0;b<f;b+=k)y.push(e.slice(b,b+k)),i=n.slice(b,b+k),i.length||(i=n),p.push(i)}else if(!b.singleFileUploads&&m){y=[];p=[];for(b=0;b<f;b+=1)if(i+=e[b].size+o,b+1===f||i+e[b+1].size+o>m||k&&b+1-w>=k)y.push(e.slice(w,b+1)),i=n.slice(w,b+1),i.length||(i=n),p.push(i),w=b+1,i=0}else p=n;a.originalFiles=e;h.each(y||e,function(b,f){var e=h.extend({},a);e.files=y?f:[f];e.paramName=p[b];g._initResponseObject(e);g._initProgressObject(e);g._addConvenienceMethods(d,e);return c=g._trigger("add",
h.Event("add",{delegatedEvent:d}),e)});return c},_replaceFileInput:function(d){var a=d.clone(!0);h("<form></form>").append(a)[0].reset();d.after(a).detach();h.cleanData(d.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(g,c){return c===d[0]?a[0]:c});if(d[0]===this.element[0])this.element=a},_handleFileTreeEntry:function(d,a){var g=this,c=h.Deferred(),b=function(b){if(b&&!b.entry)b.entry=d;c.resolve([b])},e,a=a||"";d.isFile?d._file?(d._file.relativePath=a,c.resolve(d._file)):
d.file(function(b){b.relativePath=a;c.resolve(b)},b):d.isDirectory?(e=d.createReader(),e.readEntries(function(f){g._handleFileTreeEntries(f,a+d.name+"/").done(function(b){c.resolve(b)}).fail(b)},b)):c.resolve([]);return c.promise()},_handleFileTreeEntries:function(d,a){var g=this;return h.when.apply(h,h.map(d,function(c){return g._handleFileTreeEntry(c,a)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(d){var d=d||{},a=d.items;return a&&a.length&&
(a[0].webkitGetAsEntry||a[0].getAsEntry)?this._handleFileTreeEntries(h.map(a,function(a){var c;if(a.webkitGetAsEntry){if(c=a.webkitGetAsEntry())c._file=a.getAsFile();return c}return a.getAsEntry()})):h.Deferred().resolve(h.makeArray(d.files)).promise()},_getSingleFileInputFiles:function(d){var d=h(d),a=d.prop("webkitEntries")||d.prop("entries");if(a&&a.length)return this._handleFileTreeEntries(a);a=h.makeArray(d.prop("files"));if(a.length)a[0].name===u&&a[0].fileName&&h.each(a,function(a,c){c.name=
c.fileName;c.size=c.fileSize});else{d=d.prop("value");if(!d)return h.Deferred().resolve([]).promise();a=[{name:d.replace(/^.*\\/,"")}]}return h.Deferred().resolve(a).promise()},_getFileInputFiles:function(d){return!(d instanceof h)||d.length===1?this._getSingleFileInputFiles(d):h.when.apply(h,h.map(d,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(d){var a=this,g={fileInput:h(d.target),form:h(d.target.form)};this._getFileInputFiles(g.fileInput).always(function(c){g.files=
c;a.options.replaceFileInput&&a._replaceFileInput(g.fileInput);a._trigger("change",h.Event("change",{delegatedEvent:d}),g)!==!1&&a._onAdd(d,g)})},_onPaste:function(d){var a=d.originalEvent&&d.originalEvent.clipboardData&&d.originalEvent.clipboardData.items,g={files:[]};a&&a.length&&(h.each(a,function(a,b){var e=b.getAsFile&&b.getAsFile();e&&g.files.push(e)}),this._trigger("paste",h.Event("paste",{delegatedEvent:d}),g)!==!1&&this._onAdd(d,g))},_onDrop:function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;
var a=this,g=d.dataTransfer,c={};g&&g.files&&g.files.length&&(d.preventDefault(),this._getDroppedFiles(g).always(function(b){c.files=b;a._trigger("drop",h.Event("drop",{delegatedEvent:d}),c)!==!1&&a._onAdd(d,c)}))},_onDragOver:function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;var a=d.dataTransfer;if(a&&h.inArray("Files",a.types)!==-1&&this._trigger("dragover",h.Event("dragover",{delegatedEvent:d}))!==!1)d.preventDefault(),a.dropEffect="copy"},_initEventHandlers:function(){this._isXHRUpload(this.options)&&
(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));h.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(d,a){var g=h.inArray(d,this._specialOptions)!==-1;g&&this._destroyEventHandlers();this._super(d,a);
g&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var d=this.options;if(d.fileInput===u)d.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]');else if(!(d.fileInput instanceof h))d.fileInput=h(d.fileInput);if(!(d.dropZone instanceof h))d.dropZone=h(d.dropZone);if(!(d.pasteZone instanceof h))d.pasteZone=h(d.pasteZone)},_getRegExp:function(d){var d=d.split("/"),a=d.pop();d.shift();return RegExp(d.join("/"),a)},_isRegExpOption:function(d,
a){return d!=="url"&&h.type(a)==="string"&&/^\/.*\/[igm]{0,3}$/.test(a)},_initDataAttributes:function(){var d=this,a=this.options,g=h(this.element[0].cloneNode(!1));h.each(g.data(),function(c,b){var e="data-"+c.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();g.attr(e)&&(d._isRegExpOption(c,b)&&(b=d._getRegExp(b)),a[c]=b)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);
this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(d){var a=this;if(d&&!this.options.disabled)d.fileInput&&!d.files?this._getFileInputFiles(d.fileInput).always(function(g){d.files=g;a._onAdd(null,d)}):(d.files=h.makeArray(d.files),this._onAdd(null,d))},send:function(d){if(d&&!this.options.disabled){if(d.fileInput&&!d.files){var a=this,g=h.Deferred(),c=g.promise(),b,e;c.abort=function(){e=!0;if(b)return b.abort();g.reject(null,
"abort","abort");return c};this._getFileInputFiles(d.fileInput).always(function(f){if(!e)f.length?(d.files=f,b=a._onSend(null,d).then(function(b,f,a){g.resolve(b,f,a)},function(b,f,a){g.reject(b,f,a)})):g.reject()});return this._enhancePromise(c)}d.files=h.makeArray(d.files);if(d.files.length)return this._onSend(null,d)}return this._getXHRPromise(!1,d&&d.context)}})})})})})(function(){var s=window.AmazonUIPageJS||window.P,B=s._namespace||s.attributeErrors;return B?B("ProductCustomizationFileUploadAssets"):
s}(),window);
(function(s,B,u){s.execute(function(){s.when("A").register("fabric-js",function(l){var j=j||{};if(!l.capabilities.canvas)return{};var h=h||{version:"1.4.13"};if(typeof j!=="undefined")j.fabric=h;typeof document!=="undefined"&&typeof B!=="undefined"?(h.document=document,h.window=B):(h.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),h.window=h.document.createWindow?h.document.createWindow():h.document.parentWindow);h.isTouchSupported="ontouchstart"in h.document.documentElement;
h.isLikelyNode=typeof Buffer!=="undefined"&&typeof B==="undefined";h.SHARED_ATTRIBUTES="display,transform,fill,fill-opacity,fill-rule,opacity,stroke,stroke-dasharray,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width".split(",");h.DPI=96;h.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";(function(){function d(b,a){if(this.__eventListeners[b])a?h.util.removeFromArray(this.__eventListeners[b],a):this.__eventListeners[b].length=0}function a(b,a){if(!this.__eventListeners)this.__eventListeners=
{};if(arguments.length===1)for(var f in b)this.on(f,b[f]);else this.__eventListeners[b]||(this.__eventListeners[b]=[]),this.__eventListeners[b].push(a);return this}function g(b,a){if(this.__eventListeners){if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]==="object")for(var f in b)d.call(this,f,b[f]);else d.call(this,b,a);return this}}function c(b,a){if(this.__eventListeners){var f=this.__eventListeners[b];if(f){for(var c=0,g=f.length;c<g;c++)f[c].call(this,
a||{});return this}}}h.Observable={observe:a,stopObserving:g,fire:c,on:a,off:g,trigger:c}})();h.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var d=0,a=arguments.length;d<a;d++)this._onObjectAdded(arguments[d]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(d,a,g){var c=this.getObjects();g?c[a]=d:c.splice(a,0,d);this._onObjectAdded(d);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var d=this.getObjects(),a,g=
0,c=arguments.length;g<c;g++)a=d.indexOf(arguments[g]),a!==-1&&(d.splice(a,1),this._onObjectRemoved(arguments[g]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(d,a){for(var g=this.getObjects(),c=g.length;c--;)d.call(a,g[c],c,g);return this},getObjects:function(d){return typeof d==="undefined"?this._objects:this._objects.filter(function(a){return a.type===d})},item:function(d){return this.getObjects()[d]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},
contains:function(d){return this.getObjects().indexOf(d)>-1},complexity:function(){return this.getObjects().reduce(function(d,a){d+=a.complexity?a.complexity():0;return d},0)}};(function(d){var a=Math.sqrt,g=Math.atan2,c=Math.PI/180;h.util={removeFromArray:function(b,a){var f=b.indexOf(a);f!==-1&&b.splice(f,1);return b},getRandomInt:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},degreesToRadians:function(b){return b*c},radiansToDegrees:function(b){return b/c},rotatePoint:function(b,a,f){var c=
Math.sin(f),f=Math.cos(f);b.subtractEquals(a);return(new h.Point(b.x*f-b.y*c,b.x*c+b.y*f)).addEquals(a)},transformPoint:function(b,a,f){return f?new h.Point(a[0]*b.x+a[1]*b.y,a[2]*b.x+a[3]*b.y):new h.Point(a[0]*b.x+a[1]*b.y+a[4],a[2]*b.x+a[3]*b.y+a[5])},invertTransform:function(b){var a=b.slice(),a=1/(b[0]*b[3]-b[1]*b[2]),a=[a*b[3],-a*b[1],-a*b[2],a*b[0],0,0],b=h.util.transformPoint({x:b[4],y:b[5]},a);a[4]=-b.x;a[5]=-b.y;return a},toFixed:function(b,a){return parseFloat(Number(b).toFixed(a))},parseUnit:function(b,
a){var f=/\D{0,2}$/.exec(b),c=parseFloat(b);if(!a)a=h.Text.DEFAULT_SVG_FONT_SIZE;switch(f[0]){case "mm":return c*h.DPI/25.4;case "cm":return c*h.DPI/2.54;case "in":return c*h.DPI;case "pt":return c*h.DPI/72;case "pc":return c*h.DPI/72*12;case "em":return c*a;default:return c}},falseFunction:function(){return!1},getKlass:function(b,a){b=h.util.string.camelize(b.charAt(0).toUpperCase()+b.slice(1));return h.util.resolveNamespace(a)[b]},resolveNamespace:function(b){if(!b)return h;for(var b=b.split("."),
a=b.length,f=d||h.window,c=0;c<a;++c)f=f[b[c]];return f},loadImage:function(b,a,f,c){if(b){var g=h.util.createImage();g.onload=function(){var e;a&&a.call(f,g);e=g.onload=g.onerror=null,g=e};g.onerror=function(){var e;h.log("Error loading "+g.src);a&&a.call(f,null,!0);e=g.onload=g.onerror=null,g=e};if(b.indexOf("data")!==0&&typeof c!=="undefined")g.crossOrigin=c;g.src=b}else a&&a.call(f,b)},enlivenObjects:function(b,a,f,c){function g(){++i===n&&a&&a(d)}var b=b||[],d=[],i=0,n=b.length;n?b.forEach(function(b,
a){if(!b||!b.type)g();else{var e=h.util.getKlass(b.type,f);e.async?e.fromObject(b,function(f,e){e||(d[a]=f,c&&c(b,d[a]));g()}):(d[a]=e.fromObject(b),c&&c(b,d[a]),g())}}):a&&a(d)},groupSVGElements:function(b,a,f){b=new h.PathGroup(b,a);typeof f!=="undefined"&&b.setSourcePath(f);return b},populateWithProperties:function(b,a,f){if(f&&Object.prototype.toString.call(f)==="[object Array]")for(var c=0,g=f.length;c<g;c++)f[c]in b&&(a[f[c]]=b[f[c]])},drawDashedLine:function(b,e,f,c,d,h){c-=e;var i=d-f,d=a(c*
c+i*i),c=g(i,c),i=h.length,n=0,p=!0;b.save();b.translate(e,f);b.moveTo(0,0);b.rotate(c);for(e=0;d>e;)e+=h[n++%i],e>d&&(e=d),b[p?"lineTo":"moveTo"](e,0),p=!p;b.restore()},createCanvasElement:function(b){b||(b=h.document.createElement("canvas"));!b.getContext&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(b);return b},createImage:function(){return h.isLikelyNode?new (require("canvas").Image):h.document.createElement("img")},createAccessors:function(b){for(var b=b.prototype,
a=b.stateProperties.length;a--;){var f=b.stateProperties[a],c=f.charAt(0).toUpperCase()+f.slice(1),g="set"+c,c="get"+c;b[c]||(b[c]=new Function('return this.get("'+f+'")'));b[g]||(b[g]=new Function("value",'return this.set("'+f+'", value)'))}},clipContext:function(b,a){a.save();a.beginPath();b.clipTo(a);a.clip()},multiplyTransformMatrices:function(b,a){for(var f=[[b[0],b[2],b[4]],[b[1],b[3],b[5]],[0,0,1]],c=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],g=[],d=0;d<3;d++){g[d]=[];for(var i=0;i<3;i++){for(var h=
0,p=0;p<3;p++)h+=f[d][p]*c[p][i];g[d][i]=h}}return[g[0][0],g[1][0],g[0][1],g[1][1],g[0][2],g[1][2]]},getFunctionBody:function(b){return(String(b).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(b,a,f,c){c>0&&(a>c?a-=c:a=0,f>c?f-=c:f=0);for(var g=!0,b=b.getImageData(a,f,c*2||1,c*2||1),a=3,f=b.data.length;a<f;a+=4)if(g=b.data[a]<=0,g===!1)break;return g}}})(typeof j!=="undefined"?j:this);(function(){function d(f,e,c,d,h,y,w){var C=k.call(arguments);if(b[C])return b[C];var j=Math.PI,
D=w*j/180,l=Math.sin(D),D=Math.cos(D),A=0,v=0,c=Math.abs(c),d=Math.abs(d),E=-D*f*0.5-l*e*0.5,r=-D*e*0.5+l*f*0.5,q=c*c,t=d*d,F=r*r,x=E*E,G=q*t-q*F-t*x,H=0;G<0?(q=Math.sqrt(1-G/(q*t)),c*=q,d*=q):H=(h===y?-1:1)*Math.sqrt(G/(q*F+t*x));F=H*c*r/d;x=-H*d*E/c;H=D*F-l*x+f*0.5;q=l*F+D*x+e*0.5;t=g(1,0,(E-F)/c,(r-x)/d);r=g((E-F)/c,(r-x)/d,(-E-F)/c,(-r-x)/d);y===0&&r>0?r-=2*j:y===1&&r<0&&(r+=2*j);j=Math.ceil(Math.abs(r/j*2));E=[];r/=j;F=8/3*Math.sin(r/4)*Math.sin(r/4)/Math.sin(r/2);x=t+r;for(G=0;G<j;G++)E[G]=
a(t,x,D,l,c,d,H,q,F,A,v),A=E[G][4],v=E[G][5],t=x,x+=r;return b[C]=E}function a(b,f,a,c,g,d,h,C,j,D,l){var A=k.call(arguments);if(e[A])return e[A];var v=Math.cos(b),E=Math.sin(b),r=Math.cos(f),q=Math.sin(f),t=a*g*r-c*d*q+h,F=c*g*r+a*d*q+C;e[A]=[D+j*(-a*g*E-c*d*v),l+j*(-c*g*E+a*d*v),t+j*(a*g*q+c*d*r),F+j*(c*g*q-a*d*r),t,F];return e[A]}function g(b,f,a,e){b=Math.atan2(f,b);a=Math.atan2(e,a);return a>=b?a-b:2*Math.PI-(b-a)}function c(b,a,e,c,g,d,h,C){var j=k.call(arguments);if(f[j])return f[j];var D=
Math.sqrt,l=Math.min,A=Math.max,v=Math.abs,E=[],r=[[],[]],q,t,F,x,G;t=6*b-12*e+6*g;q=-3*b+9*e-9*g+3*h;F=3*e-3*b;for(var H=0;H<2;++H)H>0&&(t=6*a-12*c+6*d,q=-3*a+9*c-9*d+3*C,F=3*c-3*a),v(q)<1.0E-12?v(t)<1.0E-12||(x=-F/t,0<x&&x<1&&E.push(x)):(x=t*t-4*F*q,x<0||(G=D(x),x=(-t+G)/(2*q),0<x&&x<1&&E.push(x),x=(-t-G)/(2*q),0<x&&x<1&&E.push(x)));for(v=D=E.length;D--;)x=E[D],t=1-x,q=t*t*t*b+3*t*t*x*e+3*t*x*x*g+x*x*x*h,r[0][D]=q,q=t*t*t*a+3*t*t*x*c+3*t*x*x*d+x*x*x*C,r[1][D]=q;r[0][v]=b;r[1][v]=a;r[0][v+1]=h;r[1][v+
1]=C;l=[{x:l.apply(null,r[0]),y:l.apply(null,r[1])},{x:A.apply(null,r[0]),y:A.apply(null,r[1])}];return f[j]=l}var b={},e={},f={},k=Array.prototype.join;h.util.drawArc=function(b,f,a,e){for(var c=[[],[],[],[]],e=d(e[5]-f,e[6]-a,e[0],e[1],e[3],e[4],e[2]),g=0,k=e.length;g<k;g++)c[g][0]=e[g][0]+f,c[g][1]=e[g][1]+a,c[g][2]=e[g][2]+f,c[g][3]=e[g][3]+a,c[g][4]=e[g][4]+f,c[g][5]=e[g][5]+a,b.bezierCurveTo.apply(b,c[g])};h.util.getBoundsOfArc=function(b,f,a,e,g,k,h,C,j){for(var D=0,l=0,A=[],v=[],a=d(C-b,j-
f,a,e,k,h,g),e=0,g=a.length;e<g;e++)A=c(D,l,a[e][0],a[e][1],a[e][2],a[e][3],a[e][4],a[e][5]),A[0].x+=b,A[0].y+=f,A[1].x+=b,A[1].y+=f,v.push(A[0]),v.push(A[1]),D=a[e][4],l=a[e][5];return v};h.util.getBoundsOfCurve=c})();(function(){function d(a,c,b){if(a&&a.length!==0){var e=a.length-1,f=c?a[e][c]:a[e];if(c)for(;e--;)b(a[e][c],f)&&(f=a[e][c]);else for(;e--;)b(a[e],f)&&(f=a[e]);return f}}var a=Array.prototype.slice;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){if(this===void 0||this===
null)throw new TypeError;var c=Object(this),b=c.length>>>0;if(b===0)return-1;var e=0;arguments.length>0&&(e=Number(arguments[1]),e!==e?e=0:e!==0&&e!==Number.POSITIVE_INFINITY&&e!==Number.NEGATIVE_INFINITY&&(e=(e>0||-1)*Math.floor(Math.abs(e))));if(e>=b)return-1;for(e=e>=0?e:Math.max(b-Math.abs(e),0);e<b;e++)if(e in c&&c[e]===a)return e;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,c){for(var b=0,e=this.length>>>0;b<e;b++)b in this&&a.call(c,this[b],b,this)};if(!Array.prototype.map)Array.prototype.map=
function(a,c){for(var b=[],e=0,f=this.length>>>0;e<f;e++)e in this&&(b[e]=a.call(c,this[e],e,this));return b};if(!Array.prototype.every)Array.prototype.every=function(a,c){for(var b=0,e=this.length>>>0;b<e;b++)if(b in this&&!a.call(c,this[b],b,this))return!1;return!0};if(!Array.prototype.some)Array.prototype.some=function(a,c){for(var b=0,e=this.length>>>0;b<e;b++)if(b in this&&a.call(c,this[b],b,this))return!0;return!1};if(!Array.prototype.filter)Array.prototype.filter=function(a,c){for(var b=[],
e,f=0,k=this.length>>>0;f<k;f++)f in this&&(e=this[f],a.call(c,e,f,this)&&b.push(e));return b};if(!Array.prototype.reduce)Array.prototype.reduce=function(a){var c=this.length>>>0,b=0,e;if(arguments.length>1)e=arguments[1];else{do{if(b in this){e=this[b++];break}if(++b>=c)throw new TypeError;}while(1)}for(;b<c;b++)b in this&&(e=a.call(null,e,this[b],b,this));return e};h.util.array={invoke:function(g,c){for(var b=a.call(arguments,2),e=[],f=0,k=g.length;f<k;f++)e[f]=b.length?g[f][c].apply(g[f],b):g[f][c].call(g[f]);
return e},min:function(a,c){return d(a,c,function(b,a){return b<a})},max:function(a,c){return d(a,c,function(b,a){return b>=a})}}})();(function(){function d(a,g){for(var c in g)a[c]=g[c];return a}h.util.object={extend:d,clone:function(a){return d({},a)}}})();(function(){if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")};h.util.string={camelize:function(d){return d.replace(/-+(.)?/g,function(a,g){return g?g.toUpperCase():""})},
capitalize:function(d,a){return d.charAt(0).toUpperCase()+(a?d.slice(1):d.slice(1).toLowerCase())},escapeXml:function(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var d=Array.prototype.slice,a=Function.prototype.apply,g=function(){};if(!Function.prototype.bind)Function.prototype.bind=function(c){var b=this,e=d.call(arguments,1),f;f=e.length?function(){return a.call(b,this instanceof g?this:c,e.concat(d.call(arguments)))}:
function(){return a.call(b,this instanceof g?this:c,arguments)};g.prototype=this.prototype;f.prototype=new g;return f}})();(function(){function d(){}function a(b){var a=this.constructor.superclass.prototype[b];return arguments.length>1?a.apply(this,g.call(arguments,1)):a.call(this)}var g=Array.prototype.slice,c=function(){},b=function(){for(var b in{toString:1})if(b==="toString")return!1;return!0}(),e=function(f,a,e){for(var c in a)if(f.prototype[c]=c in f.prototype&&typeof f.prototype[c]==="function"&&
(a[c]+"").indexOf("callSuper")>-1?function(b){return function(){var f=this.constructor.superclass;this.constructor.superclass=e;var c=a[b].apply(this,arguments);this.constructor.superclass=f;if(b!=="initialize")return c}}(c):a[c],b){if(a.toString!==Object.prototype.toString)f.prototype.toString=a.toString;if(a.valueOf!==Object.prototype.valueOf)f.prototype.valueOf=a.valueOf}};h.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var k=null,h=g.call(arguments,0);typeof h[0]===
"function"&&(k=h.shift());b.superclass=k;b.subclasses=[];if(k)d.prototype=k.prototype,b.prototype=new d,k.subclasses.push(b);for(var o=0,i=h.length;o<i;o++)e(b,h[o],k);if(!b.prototype.initialize)b.prototype.initialize=c;b.prototype.constructor=b;b.prototype.callSuper=a;return b}})();(function(){function d(b){var f=Array.prototype.slice.call(arguments,1),a,e,c=f.length;for(e=0;e<c;e++)if(a=typeof b[f[e]],!/^(?:function|object|unknown)$/.test(a))return!1;return!0}function a(f,a){return function(e){a.call(b(f),
e||h.window.event)}}function g(b,f){return function(a){if(i[b]&&i[b][f])for(var e=i[b][f],c=0,g=e.length;c<g;c++)e[c].call(this,a||h.window.event)}}function c(b,f,a){var e=b.type==="touchend"?"changedTouches":"touches";return b[e]&&b[e][0]?b[e][0][f]-(b[e][0][f]-b[e][0][a])||b[a]:b[a]}var b,e,f=function(){var b=0;return function(f){return f.__uniqueID||(f.__uniqueID="uniqueID__"+b++)}}();(function(){var f={};b=function(b){return f[b]};e=function(b,a){f[b]=a}})();var k=d(h.document.documentElement,
"addEventListener","removeEventListener")&&d(h.window,"addEventListener","removeEventListener"),m=d(h.document.documentElement,"attachEvent","detachEvent")&&d(h.window,"attachEvent","detachEvent"),o={},i={};k?(k=function(b,f,a){b.addEventListener(f,a,!1)},m=function(b,f,a){b.removeEventListener(f,a,!1)}):m?(k=function(b,c,g){var k=f(b);e(k,b);o[k]||(o[k]={});o[k][c]||(o[k][c]=[]);g={handler:g,wrappedHandler:a(k,g)};o[k][c].push(g);b.attachEvent("on"+c,g.wrappedHandler)},m=function(b,a,e){var c=f(b),
g;if(o[c]&&o[c][a])for(var k=0,d=o[c][a].length;k<d;k++)if((g=o[c][a][k])&&g.handler===e)b.detachEvent("on"+a,g.wrappedHandler),o[c][a][k]=null}):(k=function(b,a,e){var c=f(b);i[c]||(i[c]={});if(!i[c][a]){i[c][a]=[];var k=b["on"+a];k&&i[c][a].push(k);b["on"+a]=g(c,a)}i[c][a].push(e)},m=function(b,a,e){b=f(b);if(i[b]&&i[b][a])for(var a=i[b][a],b=0,c=a.length;b<c;b++)a[b]===e&&a.splice(b,1)});h.util.addListener=k;h.util.removeListener=m;var n=function(b){return typeof b.clientX!=="unknown"?b.clientX:
0},p=function(b){return typeof b.clientY!=="unknown"?b.clientY:0};h.isTouchSupported&&(n=function(b){return c(b,"pageX","clientX")},p=function(b){return c(b,"pageY","clientY")});h.util.getPointer=function(b,f){b||(b=h.window.event);var a=h.util.getScrollLeftTop(b.target||(typeof b.srcElement!=="unknown"?b.srcElement:null),f);return{x:n(b)+a.left,y:p(b)+a.top}};h.util.object.extend(h.util,h.Observable)})();(function(){var d=h.document.createElement("div"),a=typeof d.style.filter==="string",g=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,
c=function(b){return b};typeof d.style.opacity==="string"?c=function(b,a){b.style.opacity=a;return b}:a&&(c=function(b,a){var f=b.style;if(b.currentStyle&&!b.currentStyle.hasLayout)f.zoom=1;g.test(f.filter)?f.filter=f.filter.replace(g,a>=0.9999?"":"alpha(opacity="+a*100+")"):f.filter+=" alpha(opacity="+a*100+")";return b});h.util.setStyle=function(b,a){var f=b.style;if(!f)return b;if(typeof a==="string")return b.style.cssText+=";"+a,a.indexOf("opacity")>-1?c(b,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):
b;for(var g in a)g==="opacity"?c(b,a[g]):f[g==="float"||g==="cssFloat"?typeof f.styleFloat==="undefined"?"cssFloat":"styleFloat":g]=a[g];return b}})();(function(){function d(b,a){var e=h.document.createElement(b),c;for(c in a)c==="class"?e.className=a[c]:c==="for"?e.htmlFor=a[c]:e.setAttribute(c,a[c]);return e}var a=Array.prototype.slice,g,c=function(b){return a.call(b,0)};try{g=c(h.document.childNodes)instanceof Array}catch(b){}g||(c=function(b){for(var a=Array(b.length),e=b.length;e--;)a[e]=b[e];
return a});var e;e=h.document.defaultView&&h.document.defaultView.getComputedStyle?function(b,a){var e=h.document.defaultView.getComputedStyle(b,null);return e?e[a]:u}:function(b,a){var e=b.style[a];!e&&b.currentStyle&&(e=b.currentStyle[a]);return e};(function(){var b=h.document.documentElement.style,a="userSelect"in b?"userSelect":"MozUserSelect"in b?"MozUserSelect":"WebkitUserSelect"in b?"WebkitUserSelect":"KhtmlUserSelect"in b?"KhtmlUserSelect":"";h.util.makeElementUnselectable=function(b){if(typeof b.onselectstart!==
"undefined")b.onselectstart=h.util.falseFunction;if(a)b.style[a]="none";else if(typeof b.unselectable==="string")b.unselectable="on";return b};h.util.makeElementSelectable=function(b){if(typeof b.onselectstart!=="undefined")b.onselectstart=null;if(a)b.style[a]="";else if(typeof b.unselectable==="string")b.unselectable="";return b}})();(function(){h.util.getScript=function(b,a){var e=h.document.getElementsByTagName("head")[0],c=h.document.createElement("script"),g=!0;c.onload=c.onreadystatechange=
function(b){var f;if(g&&!(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"))g=!1,a(b||h.window.event),f=c.onload=c.onreadystatechange=null,c=f};c.src=b;e.appendChild(c)}})();h.util.getById=function(b){return typeof b==="string"?h.document.getElementById(b):b};h.util.toArray=c;h.util.makeElement=d;h.util.addClass=function(b,a){b&&(" "+b.className+" ").indexOf(" "+a+" ")===-1&&(b.className+=(b.className?" ":"")+a)};h.util.wrapElement=function(b,a,e){typeof a===
"string"&&(a=d(a,e));b.parentNode&&b.parentNode.replaceChild(a,b);a.appendChild(b);return a};h.util.getScrollLeftTop=function(b,a){var e,c,g=0,d=0,p=h.document.documentElement,j=h.document.body||{scrollLeft:0,scrollTop:0};for(c=b;b&&b.parentNode&&!e;)b=b.parentNode,b.nodeType===1&&h.util.getElementStyle(b,"position")==="fixed"&&(e=b),b.nodeType===1&&c!==a&&h.util.getElementStyle(b,"position")==="absolute"?d=g=0:b===h.document?(g=j.scrollLeft||p.scrollLeft||0,d=j.scrollTop||p.scrollTop||0):(g+=b.scrollLeft||
0,d+=b.scrollTop||0);return{left:g,top:d}};h.util.getElementOffset=function(b){var a;a=b&&b.ownerDocument;var c={left:0,top:0},g={left:0,top:0},d={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!a)return{left:0,top:0};for(var n in d)g[d[n]]+=parseInt(e(b,n),10)||0;a=a.documentElement;typeof b.getBoundingClientRect!=="undefined"&&(c=b.getBoundingClientRect());b=h.util.getScrollLeftTop(b,null);return{left:c.left+b.left-(a.clientLeft||0)+g.left,top:c.top+b.top-(a.clientTop||
0)+g.top}};h.util.getElementStyle=e})();(function(){function d(){}var a=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=a.length;c--;)try{if(a[c]())return a[c]}catch(b){}}();h.util.request=function(g,c){c||(c={});var b=c.method?c.method.toUpperCase():"GET",e=c.onComplete||function(){},f=a(),k;f.onreadystatechange=
function(){if(f.readyState===4)e(f),f.onreadystatechange=d};b==="GET"&&(k=null,typeof c.parameters==="string"&&(g=g+(/\?/.test(g)?"&":"?")+c.parameters));f.open(b,g,!0);(b==="POST"||b==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.send(k);return f}})();h.log=function(){};h.warn=function(){};typeof console!=="undefined"&&["log","warn"].forEach(function(d){typeof console[d]!=="undefined"&&console[d].apply&&(h[d]=function(){return console[d].apply(console,arguments)})});
(function(){function d(){return a.apply(h.window,arguments)}var a=h.window.requestAnimationFrame||h.window.webkitRequestAnimationFrame||h.window.mozRequestAnimationFrame||h.window.oRequestAnimationFrame||h.window.msRequestAnimationFrame||function(a){h.window.setTimeout(a,1E3/60)};h.util.animate=function(a){d(function(c){a||(a={});var b=c||+new Date,e=a.duration||500,f=b+e,k,h=a.onChange||function(){},o=a.abort||function(){return!1},i=a.easing||function(b,a,f,e){return-f*Math.cos(b/e*(Math.PI/2))+
f+a},n="startValue"in a?a.startValue:0,c="endValue"in a?a.endValue:100,p=a.byValue||c-n;a.onStart&&a.onStart();(function w(c){k=c||+new Date;c=k>f?e:k-b;o()?a.onComplete&&a.onComplete():(h(i(c,n,p,e)),k>f?a.onComplete&&a.onComplete():d(w))})(b)})};h.util.requestAnimFrame=d})();(function(){function d(b,a,f,c){b<Math.abs(a)?(b=a,c=f/4):c=f/(2*Math.PI)*Math.asin(a/b);return{a:b,c:a,p:f,s:c}}function a(b,a,f){return b.a*Math.pow(2,10*(a-=1))*Math.sin((a*f-b.s)*2*Math.PI/b.p)}function g(b,a,f,g){return f-
c(g-b,0,f,g)+a}function c(b,a,f,c){return(b/=c)<1/2.75?f*7.5625*b*b+a:b<2/2.75?f*(7.5625*(b-=1.5/2.75)*b+0.75)+a:b<2.5/2.75?f*(7.5625*(b-=2.25/2.75)*b+0.9375)+a:f*(7.5625*(b-=2.625/2.75)*b+0.984375)+a}h.util.ease={easeInQuad:function(b,a,f,c){return f*(b/=c)*b+a},easeOutQuad:function(b,a,f,c){return-f*(b/=c)*(b-2)+a},easeInOutQuad:function(b,a,f,c){b/=c/2;return b<1?f/2*b*b+a:-f/2*(--b*(b-2)-1)+a},easeInCubic:function(b,a,f,c){return f*(b/=c)*b*b+a},easeOutCubic:function(b,a,f,c){return f*((b=b/c-
1)*b*b+1)+a},easeInOutCubic:function(b,a,f,c){b/=c/2;return b<1?f/2*b*b*b+a:f/2*((b-=2)*b*b+2)+a},easeInQuart:function(b,a,f,c){return f*(b/=c)*b*b*b+a},easeOutQuart:function(b,a,f,c){return-f*((b=b/c-1)*b*b*b-1)+a},easeInOutQuart:function(b,a,f,c){b/=c/2;return b<1?f/2*b*b*b*b+a:-f/2*((b-=2)*b*b*b-2)+a},easeInQuint:function(b,a,f,c){return f*(b/=c)*b*b*b*b+a},easeOutQuint:function(b,a,f,c){return f*((b=b/c-1)*b*b*b*b+1)+a},easeInOutQuint:function(b,a,f,c){b/=c/2;return b<1?f/2*b*b*b*b*b+a:f/2*((b-=
2)*b*b*b*b+2)+a},easeInSine:function(b,a,f,c){return-f*Math.cos(b/c*(Math.PI/2))+f+a},easeOutSine:function(b,a,f,c){return f*Math.sin(b/c*(Math.PI/2))+a},easeInOutSine:function(b,a,f,c){return-f/2*(Math.cos(Math.PI*b/c)-1)+a},easeInExpo:function(b,a,f,c){return b===0?a:f*Math.pow(2,10*(b/c-1))+a},easeOutExpo:function(b,a,f,c){return b===c?a+f:f*(-Math.pow(2,-10*b/c)+1)+a},easeInOutExpo:function(b,a,f,c){if(b===0)return a;if(b===c)return a+f;b/=c/2;return b<1?f/2*Math.pow(2,10*(b-1))+a:f/2*(-Math.pow(2,
-10*--b)+2)+a},easeInCirc:function(b,a,f,c){return-f*(Math.sqrt(1-(b/=c)*b)-1)+a},easeOutCirc:function(b,a,f,c){return f*Math.sqrt(1-(b=b/c-1)*b)+a},easeInOutCirc:function(b,a,f,c){b/=c/2;return b<1?-f/2*(Math.sqrt(1-b*b)-1)+a:f/2*(Math.sqrt(1-(b-=2)*b)+1)+a},easeInElastic:function(b,c,f,g){var h=0;if(b===0)return c;b/=g;if(b===1)return c+f;h||(h=g*0.3);f=d(f,f,h,1.70158);return-a(f,b,g)+c},easeOutElastic:function(b,a,f,c){var g=0;if(b===0)return a;b/=c;if(b===1)return a+f;g||(g=c*0.3);f=d(f,f,g,
1.70158);return f.a*Math.pow(2,-10*b)*Math.sin((b*c-f.s)*2*Math.PI/f.p)+f.c+a},easeInOutElastic:function(b,c,f,g){var h=0;if(b===0)return c;b/=g/2;if(b===2)return c+f;h||(h=g*0.3*1.5);f=d(f,f,h,1.70158);return b<1?-0.5*a(f,b,g)+c:f.a*Math.pow(2,-10*(b-=1))*Math.sin((b*g-f.s)*2*Math.PI/f.p)*0.5+f.c+c},easeInBack:function(b,a,f,c,g){g===u&&(g=1.70158);return f*(b/=c)*b*((g+1)*b-g)+a},easeOutBack:function(b,a,f,c,g){g===u&&(g=1.70158);return f*((b=b/c-1)*b*((g+1)*b+g)+1)+a},easeInOutBack:function(b,
a,f,c,g){g===u&&(g=1.70158);b/=c/2;return b<1?f/2*b*b*(((g*=1.525)+1)*b-g)+a:f/2*((b-=2)*b*(((g*=1.525)+1)*b+g)+2)+a},easeInBounce:g,easeOutBounce:c,easeInOutBounce:function(b,a,f,d){return b<d/2?g(b*2,0,f,d)*0.5+a:c(b*2-d,0,f,d)*0.5+f*0.5+a}}})();(function(d){function a(b){return b in z?z[b]:b}function g(b,a,f,c){var e=Object.prototype.toString.call(a)==="[object Array]",g;(b==="fill"||b==="stroke")&&a==="none"?a="":b==="strokeDashArray"?a=a.replace(/,/g," ").split(/\s+/).map(function(b){return parseFloat(b)}):
b==="transformMatrix"?a=f&&f.transformMatrix?D(f.transformMatrix,n.parseTransformAttribute(a)):n.parseTransformAttribute(a):b==="visible"?(a=a==="none"||a==="hidden"?!1:!0,f&&f.visible===!1&&(a=!1)):b==="originX"?a=a==="start"?"left":a==="end"?"right":"center":g=e?a.map(l):l(a,c);return!e&&isNaN(g)?a:g}function c(b){for(var a in A)if(b[a]&&typeof b[A[a]]!=="undefined"&&b[a].indexOf("url(")!==0){var f=new n.Color(b[a]);b[a]=f.setAlpha(C(f.getAlpha()*b[A[a]],2)).toRgba()}return b}function b(b,f){var c,
e;b.replace(/;$/,"").split(";").forEach(function(b){b=b.split(":");c=a(b[0].trim().toLowerCase());e=g(c,b[1].trim());f[c]=e})}function e(b,a){var c={},e;for(e in n.cssRules[a]){var g=b,d=e.split(" "),k=void 0,h=!0;if((k=f(g,d.pop()))&&d.length){for(var h=d,i=void 0,m=!0;g.parentNode&&g.parentNode.nodeType===1&&h.length;)m&&(i=h.pop()),g=g.parentNode,m=f(g,i);h=h.length===0}if(k&&h&&d.length===0)for(var o in n.cssRules[a][e])c[o]=n.cssRules[a][e][o]}return c}function f(b,a){var f=b.nodeName,c=b.getAttribute("class"),
e=b.getAttribute("id"),a=a.replace(RegExp("^"+f,"i"),"");e&&a.length&&(a=a.replace(RegExp("#"+e+"(?![a-zA-Z\\-]+)","i"),""));if(c&&a.length){c=c.split(" ");for(e=c.length;e--;)f=RegExp("\\."+c[e]+"(?![a-zA-Z\\-]+)","i"),a=a.replace(f,"")}return a.length===0}function k(b){for(var a=b.getElementsByTagName("use");a.length;){for(var f=a[0],c=f.getAttribute("xlink:href").substr(1),e=f.getAttribute("x")||0,g=f.getAttribute("y")||0,c=b.getElementById(c).cloneNode(!0),e=(c.getAttribute("transform")||"")+
" translate("+e+", "+g+")",g=0,d=f.attributes,k=d.length;g<k;g++){var h=d.item(g);h.nodeName==="x"||h.nodeName==="y"||h.nodeName==="xlink:href"||(h.nodeName==="transform"?e=h.nodeValue+" "+e:c.setAttribute(h.nodeName,h.nodeValue))}c.setAttribute("transform",e);c.setAttribute("instantiated_by_use","1");c.removeAttribute("id");f.parentNode.replaceChild(c,f)}}function h(b,a,f){var c=RegExp("^\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*$"),e=b.getAttribute("viewBox"),
g=1,d=1,k=0,i=0;if(e&&(e=e.match(c)))if(k=-parseFloat(e[1]),i=-parseFloat(e[2]),c=parseFloat(e[3]),e=parseFloat(e[4]),a&&a!==c&&(g=a/c),f&&f!==e&&(d=f/e),d=g=g>d?d:g,g!==1||d!==1||k!==0||i!==0){a="matrix("+g+" 0 0 "+d+" "+k*g+" "+i*d+")";if(b.tagName==="svg"){for(f=b.ownerDocument.createElement("g");b.firstChild!=null;)f.appendChild(b.firstChild);b.appendChild(f)}else f=b,a+=f.getAttribute("transform");f.setAttribute("transform",a)}}function o(b){var a=b.objects,b=b.options,a=a.map(function(b){return n[j(b.type)].fromObject(b)});
return{objects:a,options:b}}function i(b,a,f){a[f]&&a[f].toSVG&&b.push('<pattern x="0" y="0" id="',f,'Pattern" ','width="',a[f].source.width,'" height="',a[f].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',a[f].source.width,'" height="',a[f].source.height,'" xlink:href="',a[f].source.src,'"></image></pattern>')}var n=d.fabric||(d.fabric={}),p=n.util.object.extend,j=n.util.string.capitalize,w=n.util.object.clone,C=n.util.toFixed,l=n.util.parseUnit,D=n.util.multiplyTransformMatrices,
z={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",
"text-anchor":"originX"},A={stroke:"strokeOpacity",fill:"fillOpacity"};n.cssRules={};n.gradientDefs={};n.parseTransformAttribute=function(){function b(a,f){var c=f[0];a[0]=Math.cos(c);a[1]=Math.sin(c);a[2]=-Math.sin(c);a[3]=Math.cos(c)}function a(b,f){var c=f.length===2?f[1]:f[0];b[0]=f[0];b[3]=c}function f(b,a){b[4]=a[0];a.length===2&&(b[5]=a[1])}var c=[1,0,0,1,0,0],e=n.reNum,g="(?:"+("(?:(matrix)\\s*\\(\\s*("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+
e+")(?:\\s+,?\\s*|,\\s*)("+e+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+e+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+e+")\\s*\\))")+")",d=RegExp("^\\s*(?:"+("(?:"+g+"(?:(?:\\s+,?\\s*|,\\s*)"+g+")*)")+"?)\\s*$"),k=RegExp(g,"g");return function(e){var h=
c.concat(),i=[];if(!e||e&&!d.test(e))return h;e.replace(k,function(e){var d=RegExp(g).exec(e).filter(function(b){return b!==""&&b!=null}),e=d[1],d=d.slice(2).map(parseFloat);switch(e){case "translate":f(h,d);break;case "rotate":d[0]=n.util.degreesToRadians(d[0]);b(h,d);break;case "scale":a(h,d);break;case "skewX":h[2]=Math.tan(n.util.degreesToRadians(d[0]));break;case "skewY":h[1]=Math.tan(n.util.degreesToRadians(d[0]));break;case "matrix":h=d}i.push(h.concat());h=c.concat()});for(e=i[0];i.length>
1;)i.shift(),e=n.util.multiplyTransformMatrices(e,i[0]);return e}}();n.parseSVGDocument=function(){var b=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,a=/^(symbol|image|marker|pattern|view)$/;return function(f,c,e){if(f){k(f);var g=new Date,d=n.Object.__uid++,i=l(f.getAttribute("width")||"100%"),o=l(f.getAttribute("height")||"100%");h(f,i,o);var p=n.util.toArray(f.getElementsByTagName("*"));if(p.length===0&&n.isLikelyNode){for(var p=f.selectNodes('//*[name(.)!="svg"]'),j=[],y=0,
C=p.length;y<C;y++)j[y]=p[y];p=j}p=p.filter(function(f){a.test(f.tagName)&&h(f,0,0);var c;if(c=b.test(f.tagName)){a:{for(c=/^(?:pattern|defs|symbol)$/;f&&(f=f.parentNode);)if(c.test(f.nodeName)&&!f.getAttribute("instantiated_by_use")){f=!0;break a}f=!1}c=!f}return c});if(!p||p&&!p.length)c&&c([],{});else{var D={width:i,height:o,widthAttr:i,heightAttr:o,svgUid:d};n.gradientDefs[d]=n.getGradientDefs(f);n.cssRules[d]=n.getCSSRules(f);n.parseElements(p,function(b){n.documentParsingTime=new Date-g;c&&
c(b,D)},w(D),e)}}}}();var v={has:function(b,a){a(!1)},get:function(){},set:function(){}};p(n,{parseFontDeclaration:function(b,a){var f=b.match("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+n.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+n.reNum+"))?\\s+(.*)");if(f){var c=f[1],e=f[3],g=f[4],d=f[5],f=f[6];if(c)a.fontStyle=c;if(e)a.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e);if(g)a.fontSize=l(g);if(f)a.fontFamily=f;if(d)a.lineHeight=
d==="normal"?1:d}},getGradientDefs:function(b){var a=b.getElementsByTagName("linearGradient"),f=b.getElementsByTagName("radialGradient"),c,e=0,g,d=[],b={},k={};d.length=a.length+f.length;for(c=a.length;c--;)d[e++]=a[c];for(c=f.length;c--;)d[e++]=f[c];for(;e--;)a=d[e],f=a.getAttribute("xlink:href"),g=a.getAttribute("id"),f&&(k[g]=f.substr(1)),b[g]=a;for(g in k){e=b[k[g]].cloneNode(!0);for(a=b[g];e.firstChild;)a.appendChild(e.firstChild)}return b},parseAttributes:function(b,f,d){if(b){var k,h={},i;
typeof d==="undefined"&&(d=b.getAttribute("svgUid"));b.parentNode&&/^symbol|[g|a]$/i.test(b.parentNode.nodeName)&&(h=n.parseAttributes(b.parentNode,f,d));i=h&&h.fontSize||b.getAttribute("font-size")||n.Text.DEFAULT_SVG_FONT_SIZE;f=f.reduce(function(f,c){if(k=b.getAttribute(c))c=a(c),k=g(c,k,h,i),f[c]=k;return f},{});f=p(f,p(e(b,d),n.parseStyleAttribute(b)));f.font&&n.parseFontDeclaration(f.font,f);return c(p(h,f))}},parseElements:function(b,a,f,c){(new n.ElementsParser(b,a,f,c)).parse()},parseStyleAttribute:function(f){var c=
{},f=f.getAttribute("style");if(!f)return c;if(typeof f==="string")b(f,c);else{var e,d,k;for(k in f)typeof f[k]!=="undefined"&&(e=a(k.toLowerCase()),d=g(e,f[k]),c[e]=d)}return c},parsePointsAttribute:function(b){if(!b)return null;var b=b.replace(/,/g," ").trim(),b=b.split(/\s+/),a=[],f,c;f=0;for(c=b.length;f<c;f+=2)a.push({x:parseFloat(b[f]),y:parseFloat(b[f+1])});return a},getCSSRules:function(b){for(var b=b.getElementsByTagName("style"),f={},c,e=0,d=b.length;e<d;e++)c=b[e].textContent,c=c.replace(/\/\*[\s\S]*?\*\//g,
""),c.trim()!==""&&(c=c.match(/[^{]*\{[\s\S]*?\}/g),c=c.map(function(b){return b.trim()}),c.forEach(function(b){for(var b=b.match(/([\s\S]*?)\s*\{([^}]*)\}/),c={},e=b[2].trim().replace(/;$/,"").split(/\s*;\s*/),d=0,k=e.length;d<k;d++){var h=e[d].split(/\s*:\s*/),i=a(h[0]),h=g(i,h[1],h[0]);c[i]=h}b=b[1];b.split(",").forEach(function(b){b=b.replace(/^svg/i,"").trim();b!==""&&(f[b]=n.util.object.clone(c))})}));return f},loadSVGFromURL:function(b,a,f){function c(e){var g=e.responseXML;if(g&&!g.documentElement&&
n.window.ActiveXObject&&e.responseText)g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(e.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""));g&&g.documentElement&&n.parseSVGDocument(g.documentElement,function(f,c){v.set(b,{objects:n.util.array.invoke(f,"toObject"),options:c});a(f,c)},f)}b=b.replace(/^\n\s*/,"").trim();v.has(b,function(f){f?v.get(b,function(b){b=o(b);a(b.objects,b.options)}):new n.util.request(b,{method:"get",onComplete:c})})},loadSVGFromString:function(b,
a,f){var b=b.trim(),c;if(typeof DOMParser!=="undefined"){var e=new DOMParser;e&&e.parseFromString&&(c=e.parseFromString(b,"text/xml"))}else if(n.window.ActiveXObject)c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""));n.parseSVGDocument(c.documentElement,function(b,f){a(b,f)},f)},createSVGFontFacesMarkup:function(b){for(var a="",f=0,c=b.length;f<c;f++)b[f].type==="text"&&b[f].path&&(a+=["@font-face {font-family: ",b[f].fontFamily,"; src: url('",
b[f].path,"')}"].join(""));a&&(a=['<style type="text/css"><![CDATA[',a,"]]\></style>"].join(""));return a},createSVGRefElementsMarkup:function(b){var a=[];i(a,b,"backgroundColor");i(a,b,"overlayColor");return a.join("")}})})(typeof j!=="undefined"?j:this);h.ElementsParser=function(d,a,g,c){this.elements=d;this.callback=a;this.options=g;this.reviver=c;this.svgUid=g&&g.svgUid||0};h.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;
this.createObjects()};h.ElementsParser.prototype.createObjects=function(){for(var d=0,a=this.elements.length;d<a;d++)this.elements[d].setAttribute("svgUid",this.svgUid),function(a,c){setTimeout(function(){a.createObject(a.elements[c],c)},0)}(this,d)};h.ElementsParser.prototype.createObject=function(d,a){var g=h[h.util.string.capitalize(d.tagName)];if(g&&g.fromElement)try{this._createObject(g,d,a)}catch(c){h.log(c)}else this.checkIfDone()};h.ElementsParser.prototype._createObject=function(d,a,g){d.async?
d.fromElement(a,this.createCallback(g,a),this.options):(d=d.fromElement(a,this.options),this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(a,d),this.instances[g]=d,this.checkIfDone())};h.ElementsParser.prototype.createCallback=function(d,a){var g=this;return function(c){g.resolveGradient(c,"fill");g.resolveGradient(c,"stroke");g.reviver&&g.reviver(a,c);g.instances[d]=c;g.checkIfDone()}};h.ElementsParser.prototype.resolveGradient=function(d,a){var g=d.get(a);
/^url\(/.test(g)&&(g=g.slice(5,g.length-1),h.gradientDefs[this.svgUid][g]&&d.set(a,h.Gradient.fromElement(h.gradientDefs[this.svgUid][g],d)))};h.ElementsParser.prototype.checkIfDone=function(){if(--this.numElements===0)this.instances=this.instances.filter(function(d){return d!=null}),this.callback(this.instances)};(function(d){function a(a,c){this.x=a;this.y=c}d=d.fabric||(d.fabric={});d.Point?d.warn("fabric.Point is already defined"):(d.Point=a,a.prototype={constructor:a,add:function(g){return new a(this.x+
g.x,this.y+g.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(g){return new a(this.x+g,this.y+g)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(g){return new a(this.x-g.x,this.y-g.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},scalarSubtract:function(g){return new a(this.x-g,this.y-g)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(g){return new a(this.x*g,this.y*g)},multiplyEquals:function(a){this.x*=
a;this.y*=a;return this},divide:function(g){return new a(this.x/g,this.y/g)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(g,c){return new a(this.x+(g.x-this.x)*c,this.y+(g.y-this.y)*c)},distanceFrom:function(a){var c=this.x-a.x,a=this.y-
a.y;return Math.sqrt(c*c+a*a)},midPointFrom:function(g){return new a(this.x+(g.x-this.x)/2,this.y+(g.y-this.y)/2)},min:function(g){return new a(Math.min(this.x,g.x),Math.min(this.y,g.y))},max:function(g){return new a(Math.max(this.x,g.x),Math.max(this.y,g.y))},toString:function(){return this.x+","+this.y},setXY:function(a,c){this.x=a;this.y=c},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var c=this.x,b=this.y;this.x=a.x;this.y=a.y;a.x=c;a.y=b}})})(typeof j!=="undefined"?j:this);
(function(d){function a(a){this.status=a;this.points=[]}var g=d.fabric||(d.fabric={});g.Intersection?g.warn("fabric.Intersection is already defined"):(g.Intersection=a,g.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},g.Intersection.intersectLineLine=function(c,b,e,f){var d,h=(f.x-e.x)*(c.y-e.y)-(f.y-e.y)*(c.x-e.x);d=(b.x-c.x)*(c.y-e.y)-(b.y-c.y)*(c.x-e.x);e=(f.y-e.y)*(b.x-c.x)-(f.x-e.x)*(b.y-c.y);e!==0?(h/=e,d/=e,0<=
h&&h<=1&&0<=d&&d<=1?(d=new a("Intersection"),d.points.push(new g.Point(c.x+h*(b.x-c.x),c.y+h*(b.y-c.y)))):d=new a):d=h===0||d===0?new a("Coincident"):new a("Parallel");return d},g.Intersection.intersectLinePolygon=function(c,b,e){for(var f=new a,g=e.length,d=0;d<g;d++){var h=a.intersectLineLine(c,b,e[d],e[(d+1)%g]);f.appendPoints(h.points)}if(f.points.length>0)f.status="Intersection";return f},g.Intersection.intersectPolygonPolygon=function(c,b){for(var e=new a,f=c.length,g=0;g<f;g++){var d=a.intersectLinePolygon(c[g],
c[(g+1)%f],b);e.appendPoints(d.points)}if(e.points.length>0)e.status="Intersection";return e},g.Intersection.intersectPolygonRectangle=function(c,b,e){var f=b.min(e),d=b.max(e),e=new g.Point(d.x,f.y),h=new g.Point(f.x,d.y),b=a.intersectLinePolygon(f,e,c),e=a.intersectLinePolygon(e,d,c),d=a.intersectLinePolygon(d,h,c),c=a.intersectLinePolygon(h,f,c),f=new a;f.appendPoints(b.points);f.appendPoints(e.points);f.appendPoints(d.points);f.appendPoints(c.points);if(f.points.length>0)f.status="Intersection";
return f})})(typeof j!=="undefined"?j:this);(function(d){function a(b){b?this._tryParsingColor(b):this.setSource([0,0,0,1])}function g(b,a,f){f<0&&(f+=1);f>1&&(f-=1);return f<1/6?b+(a-b)*6*f:f<0.5?a:f<2/3?b+(a-b)*(2/3-f)*6:b}var c=d.fabric||(d.fabric={});c.Color?c.warn("fabric.Color is already defined."):(c.Color=a,c.Color.prototype={_tryParsingColor:function(b){var c;b in a.colorNameMap&&(b=a.colorNameMap[b]);b==="transparent"?this.setSource([255,255,255,0]):((c=a.sourceFromHex(b))||(c=a.sourceFromRgb(b)),
c||(c=a.sourceFromHsl(b)),c&&this.setSource(c))},_rgbToHsl:function(b,a,f){b/=255;a/=255;f/=255;var g,d,h,i=c.util.array.max([b,a,f]);d=c.util.array.min([b,a,f]);h=(i+d)/2;if(i===d)g=d=0;else{var n=i-d;d=h>0.5?n/(2-i-d):n/(i+d);switch(i){case b:g=(a-f)/n+(a<f?6:0);break;case a:g=(f-b)/n+2;break;case f:g=(b-a)/n+4}g/=6}return[Math.round(g*360),Math.round(d*100),Math.round(h*100)]},getSource:function(){return this._source},setSource:function(b){this._source=b},toRgb:function(){var b=this.getSource();
return"rgb("+b[0]+","+b[1]+","+b[2]+")"},toRgba:function(){var b=this.getSource();return"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"},toHsl:function(){var b=this.getSource(),b=this._rgbToHsl(b[0],b[1],b[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var b=this.getSource(),a=this._rgbToHsl(b[0],b[1],b[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+b[3]+")"},toHex:function(){var b=this.getSource(),a,f;a=b[0].toString(16);a=a.length===1?"0"+a:a;f=b[1].toString(16);f=f.length===1?"0"+
f:f;b=b[2].toString(16);b=b.length===1?"0"+b:b;return a.toUpperCase()+f.toUpperCase()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(b){var a=this.getSource();a[3]=b;this.setSource(a);return this},toGrayscale:function(){var b=this.getSource(),a=parseInt((b[0]*0.3+b[1]*0.59+b[2]*0.11).toFixed(0),10);this.setSource([a,a,a,b[3]]);return this},toBlackWhite:function(b){var a=this.getSource(),f=(a[0]*0.3+a[1]*0.59+a[2]*0.11).toFixed(0),a=a[3],f=Number(f)<Number(b||127)?
0:255;this.setSource([f,f,f,a]);return this},overlayWith:function(b){b instanceof a||(b=new a(b));for(var c=[],f=this.getAlpha(),g=this.getSource(),b=b.getSource(),d=0;d<3;d++)c.push(Math.round(g[d]*0.5+b[d]*0.5));c[3]=f;this.setSource(c);return this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,
c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(b){return a.fromSource(a.sourceFromRgb(b))},c.Color.sourceFromRgb=function(b){if(b=b.match(a.reRGBa)){var c=parseInt(b[1],10)/(/%$/.test(b[1])?
100:1)*(/%$/.test(b[1])?255:1),f=parseInt(b[2],10)/(/%$/.test(b[2])?100:1)*(/%$/.test(b[2])?255:1),g=parseInt(b[3],10)/(/%$/.test(b[3])?100:1)*(/%$/.test(b[3])?255:1);return[parseInt(c,10),parseInt(f,10),parseInt(g,10),b[4]?parseFloat(b[4]):1]}},c.Color.fromRgba=a.fromRgb,c.Color.fromHsl=function(b){return a.fromSource(a.sourceFromHsl(b))},c.Color.sourceFromHsl=function(b){if(b=b.match(a.reHSLa)){var c=(parseFloat(b[1])%360+360)%360/360,f=parseFloat(b[2])/(/%$/.test(b[2])?100:1),d=parseFloat(b[3])/
(/%$/.test(b[3])?100:1);if(f===0)d=f=c=d;else var h=d<=0.5?d*(f+1):d+f-d*f,o=d*2-h,d=g(o,h,c+1/3),f=g(o,h,c),c=g(o,h,c-1/3);return[Math.round(d*255),Math.round(f*255),Math.round(c*255),b[4]?parseFloat(b[4]):1]}},c.Color.fromHsla=a.fromHsl,c.Color.fromHex=function(b){return a.fromSource(a.sourceFromHex(b))},c.Color.sourceFromHex=function(b){if(b.match(a.reHex)){var c=b.slice(b.indexOf("#")+1),f=c.length===3,b=f?c.charAt(0)+c.charAt(0):c.substring(0,2),g=f?c.charAt(1)+c.charAt(1):c.substring(2,4),c=
f?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(b,16),parseInt(g,16),parseInt(c,16),1]}},c.Color.fromSource=function(b){var c=new a;c.setSource(b);return c})})(typeof j!=="undefined"?j:this);(function(){function d(a){var c=a.getAttribute("style"),b=a.getAttribute("offset"),e,f,b=parseFloat(b)/(/%$/.test(b)?100:1),b=b<0?0:b>1?1:b;if(c){c=c.split(/\s*;\s*/);c[c.length-1]===""&&c.pop();for(var d=c.length;d--;){var m=c[d].split(/\s*:\s*/),o=m[0].trim(),m=m[1].trim();o==="stop-color"?e=m:o===
"stop-opacity"&&(f=m)}}e||(e=a.getAttribute("stop-color")||"rgb(0,0,0)");f||(f=a.getAttribute("stop-opacity"));e=new h.Color(e);a=e.getAlpha();f=isNaN(parseFloat(f))?1:parseFloat(f);f*=a;return{offset:b,color:e.toRgb(),opacity:f}}function a(a,c,b){var e,f=0,d=1,h="",o;for(o in c){e=parseFloat(c[o],10);d=typeof c[o]==="string"&&/^\d+%$/.test(c[o])?0.01:1;if(o==="x1"||o==="x2"||o==="r2")d*=b==="objectBoundingBox"?a.width:1,f=b==="objectBoundingBox"?a.left||0:0;else if(o==="y1"||o==="y2")d*=b==="objectBoundingBox"?
a.height:1,f=b==="objectBoundingBox"?a.top||0:0;c[o]=e*d+f}a.type==="ellipse"&&c.r2!==null&&b==="objectBoundingBox"&&a.rx!==a.ry&&(a=a.ry/a.rx,h=" scale(1, "+a+")",c.y1&&(c.y1/=a),c.y2&&(c.y2/=a));return h}h.Gradient=h.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var c={};this.id=h.Object.__uid++;this.type=a.type||"linear";c={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0};if(this.type==="radial")c.r1=a.coords.r1||0,c.r2=a.coords.r2||0;this.coords=
c;this.colorStops=a.colorStops.slice();if(a.gradientTransform)this.gradientTransform=a.gradientTransform;this.offsetX=a.offsetX||this.offsetX;this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var c in a){var b=new h.Color(a[c]);this.colorStops.push({offset:c,color:b.toRgb(),opacity:b.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(a){var c=h.util.object.clone(this.coords),
b;this.colorStops.sort(function(b,a){return b.offset-a.offset});if(!(a.group&&a.group.type==="path-group"))for(var e in c)if(e==="x1"||e==="x2"||e==="r2")c[e]+=this.offsetX-a.width/2;else if(e==="y1"||e==="y2")c[e]+=this.offsetY-a.height/2;a='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(a+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');this.type==="linear"?b=["<linearGradient ",a,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'">\n']:
this.type==="radial"&&(b=["<radialGradient ",a,' cx="',c.x2,'" cy="',c.y2,'" r="',c.r2,'" fx="',c.x1,'" fy="',c.y1,'">\n']);for(c=0;c<this.colorStops.length;c++)b.push("<stop ",'offset="',this.colorStops[c].offset*100+"%",'" style="stop-color:',this.colorStops[c].color,this.colorStops[c].opacity!=null?";stop-opacity: "+this.colorStops[c].opacity:";",'"/>\n');b.push(this.type==="linear"?"</linearGradient>\n":"</radialGradient>\n");return b.join("")},toLive:function(a,c){var b,e=h.util.object.clone(this.coords);
if(this.type){if(c.group&&c.group.type==="path-group")for(var f in e)if(f==="x1"||f==="x2")e[f]+=-this.offsetX+c.width/2;else if(f==="y1"||f==="y2")e[f]+=-this.offsetY+c.height/2;this.type==="linear"?b=a.createLinearGradient(e.x1,e.y1,e.x2,e.y2):this.type==="radial"&&(b=a.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2));e=0;for(f=this.colorStops.length;e<f;e++){var d=this.colorStops[e].color,m=this.colorStops[e].opacity,o=this.colorStops[e].offset;typeof m!=="undefined"&&(d=(new h.Color(d)).setAlpha(m).toRgba());
b.addColorStop(parseFloat(o),d)}return b}}});h.util.object.extend(h.Gradient,{fromElement:function(g,c){var b=g.getElementsByTagName("stop"),e=g.nodeName==="linearGradient"?"linear":"radial",f=g.getAttribute("gradientUnits")||"objectBoundingBox",k=g.getAttribute("gradientTransform"),m=[],o={};e==="linear"?o={x1:g.getAttribute("x1")||0,y1:g.getAttribute("y1")||0,x2:g.getAttribute("x2")||"100%",y2:g.getAttribute("y2")||0}:e==="radial"&&(o={x1:g.getAttribute("fx")||g.getAttribute("cx")||"50%",y1:g.getAttribute("fy")||
g.getAttribute("cy")||"50%",r1:0,x2:g.getAttribute("cx")||"50%",y2:g.getAttribute("cy")||"50%",r2:g.getAttribute("r")||"50%"});for(var i=b.length;i--;)m.push(d(b[i]));b=a(c,o,f);e=new h.Gradient({type:e,coords:o,colorStops:m,offsetX:-c.left,offsetY:-c.top});if(k||b!=="")e.gradientTransform=h.parseTransformAttribute((k||"")+b);return e},forObject:function(g,c){c||(c={});a(g,c.coords,"userSpaceOnUse");return new h.Gradient(c)}})})();h.Pattern=h.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,
initialize:function(d){d||(d={});this.id=h.Object.__uid++;if(d.source)if(typeof d.source==="string")if(typeof h.util.getFunctionBody(d.source)!=="undefined")this.source=new Function(h.util.getFunctionBody(d.source));else{var a=this;this.source=h.util.createImage();h.util.loadImage(d.source,function(g){a.source=g})}else this.source=d.source;if(d.repeat)this.repeat=d.repeat;if(d.offsetX)this.offsetX=d.offsetX;if(d.offsetY)this.offsetY=d.offsetY},toObject:function(){var d;if(typeof this.source==="function")d=
String(this.source);else if(typeof this.source.src==="string")d=this.source.src;return{source:d,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(d){var a=typeof this.source==="function"?this.source():this.source,g=a.width/d.getWidth(),c=a.height/d.getHeight(),b=this.offsetX/d.getWidth(),d=this.offsetY/d.getHeight(),e="";if(this.repeat==="repeat-x"||this.repeat==="no-repeat")c=1;if(this.repeat==="repeat-y"||this.repeat==="no-repeat")g=1;a.src?e=a.src:a.toDataURL&&(e=a.toDataURL());
return'<pattern id="SVGID_'+this.id+'" x="'+b+'" y="'+d+'" width="'+g+'" height="'+c+'">\n<image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+e+'"></image>\n</pattern>\n'},toLive:function(d){var a=typeof this.source==="function"?this.source():this.source;if(!a)return"";if(typeof a.src!=="undefined"){if(!a.complete)return"";if(a.naturalWidth===0||a.naturalHeight===0)return""}return d.createPattern(a,this.repeat)}});(function(d){var a=d.fabric||(d.fabric={});a.Shadow?a.warn("fabric.Shadow is already defined."):
(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(g){typeof g==="string"&&(g=this._parseShadow(g));for(var c in g)this[c]=g[c];this.id=a.Object.__uid++},_parseShadow:function(g){var g=g.trim(),c=a.Shadow.reOffsetsAndBlur.exec(g)||[];return{color:(g.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(c[1],10)||0,offsetY:parseInt(c[2],10)||0,blur:parseInt(c[3],10)||0}},toString:function(){return[this.offsetX,
this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var c="SourceAlpha",b=40,e=40;if(a&&(a.fill===this.color||a.stroke===this.color))c="SourceGraphic";a.width&&a.height&&(b=Math.abs(this.offsetX/a.getWidth())*100+20,e=Math.abs(this.offsetY/a.getHeight())*100+20);return'<filter id="SVGID_'+this.id+'" y="-'+e+'%" height="'+(100+2*e)+'%" x="-'+b+'%" width="'+(100+2*b)+'%" >\n\t<feGaussianBlur in="'+c+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur>\n\t<feOffset dx="'+this.offsetX+
'" dy="'+this.offsetY+'"></feOffset>\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var g={},c=a.Shadow.prototype;if(this.color!==c.color)g.color=this.color;if(this.blur!==c.blur)g.blur=this.blur;if(this.offsetX!==c.offsetX)g.offsetX=this.offsetX;if(this.offsetY!==c.offsetY)g.offsetY=this.offsetY;
return g}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})(typeof j!=="undefined"?j:this);(function(){if(h.StaticCanvas)h.warn("fabric.StaticCanvas is already defined.");else{var d=h.util.object.extend,a=h.util.getElementOffset,g=h.util.removeFromArray,c=Error("Could not initialize `canvas` element");h.StaticCanvas=h.util.createClass({initialize:function(b,a){a||(a={});this._initStatic(b,a);h.StaticCanvas.activeInstance=this},
backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(b,a){this._objects=[];this._createLowerCanvas(b);this._initOptions(a);this._setImageSmoothing();a.overlayImage&&this.setOverlayImage(a.overlayImage,this.renderAll.bind(this));
a.backgroundImage&&this.setBackgroundImage(a.backgroundImage,this.renderAll.bind(this));a.backgroundColor&&this.setBackgroundColor(a.backgroundColor,this.renderAll.bind(this));a.overlayColor&&this.setOverlayColor(a.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=a(this.lowerCanvasEl);return this},setOverlayImage:function(b,a,f){return this.__setBgOverlayImage("overlayImage",b,a,f)},setBackgroundImage:function(b,a,f){return this.__setBgOverlayImage("backgroundImage",
b,a,f)},setOverlayColor:function(b,a){return this.__setBgOverlayColor("overlayColor",b,a)},setBackgroundColor:function(b,a){return this.__setBgOverlayColor("backgroundColor",b,a)},_setImageSmoothing:function(){var b=this.getContext();b.imageSmoothingEnabled=this.imageSmoothingEnabled;b.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;b.mozImageSmoothingEnabled=this.imageSmoothingEnabled;b.msImageSmoothingEnabled=this.imageSmoothingEnabled;b.oImageSmoothingEnabled=this.imageSmoothingEnabled},
__setBgOverlayImage:function(b,a,f,c){typeof a==="string"?h.util.loadImage(a,function(a){this[b]=new h.Image(a,c);f&&f()},this,c&&c.crossOrigin):(this[b]=a,f&&f());return this},__setBgOverlayColor:function(b,a,f){if(a&&a.source){var c=this;h.util.loadImage(a.source,function(g){c[b]=new h.Pattern({source:g,repeat:a.repeat,offsetX:a.offsetX,offsetY:a.offsetY});f&&f()})}else this[b]=a,f&&f();return this},_createCanvasElement:function(){var b=h.document.createElement("canvas");if(!b.style)b.style={};
if(!b)throw c;this._initCanvasElement(b);return b},_initCanvasElement:function(b){h.util.createCanvasElement(b);if(typeof b.getContext==="undefined")throw c;},_initOptions:function(b){for(var a in b)this[a]=b[a];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(this.lowerCanvasEl.style)this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=
this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(b){this.lowerCanvasEl=h.util.getById(b)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);h.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(b,a){return this.setDimensions({width:b},
a)},setHeight:function(b,a){return this.setDimensions({height:b},a)},setDimensions:function(b,a){var f,a=a||{},c;for(c in b)f=b[c],a.cssOnly||(this._setBackstoreDimension(c,b[c]),f+="px"),a.backstoreOnly||this._setCssDimension(c,f);a.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(b,a){this.lowerCanvasEl[b]=a;this.upperCanvasEl&&(this.upperCanvasEl[b]=a);this.cacheCanvasEl&&(this.cacheCanvasEl[b]=a);this[b]=a;return this},_setCssDimension:function(b,a){this.lowerCanvasEl.style[b]=
a;this.upperCanvasEl&&(this.upperCanvasEl.style[b]=a);this.wrapperEl&&(this.wrapperEl.style[b]=a);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(b){this.viewportTransform=b;this.renderAll();for(var b=0,a=this._objects.length;b<a;b++)this._objects[b].setCoords();return this},zoomToPoint:function(b,a){var f=b,b=h.util.transformPoint(b,h.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=a;this.viewportTransform[3]=
a;var c=h.util.transformPoint(b,this.viewportTransform);this.viewportTransform[4]+=f.x-c.x;this.viewportTransform[5]+=f.y-c.y;this.renderAll();f=0;for(c=this._objects.length;f<c;f++)this._objects[f].setCoords();return this},setZoom:function(b){this.zoomToPoint(new h.Point(0,0),b);return this},absolutePan:function(b){this.viewportTransform[4]=-b.x;this.viewportTransform[5]=-b.y;this.renderAll();for(var b=0,a=this._objects.length;b<a;b++)this._objects[b].setCoords();return this},relativePan:function(b){return this.absolutePan(new h.Point(-b.x-
this.viewportTransform[4],-b.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(b,a){if(a){b.save();var f=this.viewportTransform;b.transform(f[0],f[1],f[2],f[3],f[4],f[5]);this._shouldRenderObject(a)&&a.render(b);b.restore();this.controlsAboveOverlay||a._renderControls(b)}},_shouldRenderObject:function(b){return!b?!1:b!==this.getActiveGroup()||!this.preserveObjectStacking},_onObjectAdded:function(b){this.stateful&&
b.setupState();b.canvas=this;b.setCoords();this.fire("object:added",{target:b});b.fire("added")},_onObjectRemoved:function(b){this.getActiveObject()===b&&(this.fire("before:selection:cleared",{target:b}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:b});b.fire("removed")},clearContext:function(b){b.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&
this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(b){var a=this[b===!0&&this.interactive?"contextTop":"contextContainer"],f=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);b||this.clearContext(a);this.fire("before:render");this.clipTo&&h.util.clipContext(this,
a);this._renderBackground(a);this._renderObjects(a,f);this._renderActiveGroup(a,f);this.clipTo&&a.restore();this._renderOverlay(a);this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.fire("after:render");return this},_renderObjects:function(b,a){var f,c;if(!a||this.preserveObjectStacking)for(f=0,c=this._objects.length;f<c;++f)this._draw(b,this._objects[f]);else for(f=0,c=this._objects.length;f<c;++f)this._objects[f]&&!a.contains(this._objects[f])&&this._draw(b,this._objects[f])},
_renderActiveGroup:function(b,a){if(a){var f=[];this.forEachObject(function(b){a.contains(b)&&f.push(b)});a._set("objects",f);this._draw(b,a)}},_renderBackground:function(b){if(this.backgroundColor)b.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(b):this.backgroundColor,b.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height);this.backgroundImage&&this._draw(b,this.backgroundImage)},_renderOverlay:function(b){if(this.overlayColor)b.fillStyle=
this.overlayColor.toLive?this.overlayColor.toLive(b):this.overlayColor,b.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height);this.overlayImage&&this._draw(b,this.overlayImage)},renderTop:function(){var b=this.contextTop||this.contextContainer;this.clearContext(b);this.selection&&this._groupSelector&&this._drawSelection();var a=this.getActiveGroup();a&&a.render(b);this._renderOverlay(b);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(b){this._centerObject(b,new h.Point(this.getCenter().left,b.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(b){this._centerObject(b,new h.Point(b.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(b){var a=this.getCenter();this._centerObject(b,new h.Point(a.left,a.top));this.renderAll();return this},_centerObject:function(b,a){b.setPositionByOrigin(a,"center","center");return this},
toDatalessJSON:function(b){return this.toDatalessObject(b)},toObject:function(b){return this._toObjectMethod("toObject",b)},toDatalessObject:function(b){return this._toObjectMethod("toDatalessObject",b)},_toObjectMethod:function(b,a){var f=this.getActiveGroup();f&&this.discardActiveGroup();var c={objects:this._toObjects(b,a)};d(c,this.__serializeBgOverlay());h.util.populateWithProperties(this,c,a);if(f&&(this.setActiveGroup(new h.Group(f.getObjects(),{originX:"center",originY:"center"})),f.forEachObject(function(b){b.set("active",
!0)}),this._currentTransform))this._currentTransform.target=this.getActiveGroup();return c},_toObjects:function(b,a){return this.getObjects().map(function(f){return this._toObject(f,b,a)},this)},_toObject:function(b,a,f){var c;if(!this.includeDefaultValues)c=b.includeDefaultValues,b.includeDefaultValues=!1;a=b[a](f);if(!this.includeDefaultValues)b.includeDefaultValues=c;return a},__serializeBgOverlay:function(){var b={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():
this.backgroundColor};if(this.overlayColor)b.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor;if(this.backgroundImage)b.backgroundImage=this.backgroundImage.toObject();if(this.overlayImage)b.overlayImage=this.overlayImage.toObject();return b},svgViewportTransformation:!0,toSVG:function(b,a){b||(b={});var f=[];this._setSVGPreamble(f,b);this._setSVGHeader(f,b);this._setSVGBgOverlayColor(f,"backgroundColor");this._setSVGBgOverlayImage(f,"backgroundImage");this._setSVGObjects(f,
a);this._setSVGBgOverlayColor(f,"overlayColor");this._setSVGBgOverlayImage(f,"overlayImage");f.push("</svg>");return f.join("")},_setSVGPreamble:function(b,a){a.suppressPreamble||b.push('<?xml version="1.0" encoding="',a.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(b,a){var f,c,g;if(a.viewBox)f=a.viewBox.width,c=a.viewBox.height;else if(f=this.width,c=this.height,!this.svgViewportTransformation)g=
this.viewportTransform,f/=g[0],c/=g[3];b.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',f,'" ','height="',c,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,a.viewBox?'viewBox="'+a.viewBox.x+" "+a.viewBox.y+" "+a.viewBox.width+" "+a.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",h.version,"</desc>","<defs>",h.createSVGFontFacesMarkup(this.getObjects()),
h.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(b,a){var f=this.getActiveGroup();f&&this.discardActiveGroup();for(var c=0,g=this.getObjects(),d=g.length;c<d;c++)b.push(g[c].toSVG(a));f&&(this.setActiveGroup(new h.Group(f.getObjects())),f.forEachObject(function(b){b.set("active",!0)}))},_setSVGBgOverlayImage:function(b,a){this[a]&&this[a].toSVG&&b.push(this[a].toSVG())},_setSVGBgOverlayColor:function(b,a){this[a]&&this[a].source?b.push('<rect x="',this[a].offsetX,'" y="',this[a].offsetY,
'" ','width="',this[a].repeat==="repeat-y"||this[a].repeat==="no-repeat"?this[a].source.width:this.width,'" height="',this[a].repeat==="repeat-x"||this[a].repeat==="no-repeat"?this[a].source.height:this.height,'" fill="url(#'+a+'Pattern)"',"></rect>"):this[a]&&a==="overlayColor"&&b.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[a],'"',"></rect>")},sendToBack:function(b){g(this._objects,b);this._objects.unshift(b);return this.renderAll&&this.renderAll()},bringToFront:function(b){g(this._objects,
b);this._objects.push(b);return this.renderAll&&this.renderAll()},sendBackwards:function(b,a){var f=this._objects.indexOf(b);f!==0&&(f=this._findNewLowerIndex(b,f,a),g(this._objects,b),this._objects.splice(f,0,b),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(b,a,f){if(f){f=a;for(a-=1;a>=0;--a)if(b.intersectsWithObject(this._objects[a])||b.isContainedWithinObject(this._objects[a])||this._objects[a].isContainedWithinObject(b)){f=a;break}}else f=a-1;return f},bringForward:function(b,
a){var f=this._objects.indexOf(b);f!==this._objects.length-1&&(f=this._findNewUpperIndex(b,f,a),g(this._objects,b),this._objects.splice(f,0,b),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(b,a,f){if(f){f=a;for(a+=1;a<this._objects.length;++a)if(b.intersectsWithObject(this._objects[a])||b.isContainedWithinObject(this._objects[a])||this._objects[a].isContainedWithinObject(b)){f=a;break}}else f=a+1;return f},moveTo:function(b,a){g(this._objects,b);this._objects.splice(a,
0,b);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});d(h.StaticCanvas.prototype,h.Observable);d(h.StaticCanvas.prototype,h.Collection);d(h.StaticCanvas.prototype,h.DataURLExporter);d(h.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(b){var a=h.util.createCanvasElement();
if(!a||!a.getContext)return null;var f=a.getContext("2d");if(!f)return null;switch(b){case "getImageData":return typeof f.getImageData!=="undefined";case "setLineDash":return typeof f.setLineDash!=="undefined";case "toDataURL":return typeof a.toDataURL!=="undefined";case "toDataURLWithQuality":try{return a.toDataURL("image/jpeg",0),!0}catch(c){}return!1;default:return null}}});h.StaticCanvas.prototype.toJSON=h.StaticCanvas.prototype.toObject}})();h.BaseBrush=h.util.createClass({color:"rgb(0, 0, 0)",
width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(d){this.shadow=new h.Shadow(d);return this},_setBrushStyles:function(){var d=this.canvas.contextTop;d.strokeStyle=this.color;d.lineWidth=this.width;d.lineCap=this.strokeLineCap;d.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var d=this.canvas.contextTop;d.shadowColor=this.shadow.color;d.shadowBlur=this.shadow.blur;d.shadowOffsetX=this.shadow.offsetX;d.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var d=
this.canvas.contextTop;d.shadowColor="";d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0}});(function(){h.PencilBrush=h.util.createClass(h.BaseBrush,{initialize:function(d){this.canvas=d;this._points=[]},onMouseDown:function(d){this._prepareForDrawing(d);this._captureDrawingPath(d);this._render()},onMouseMove:function(d){this._captureDrawingPath(d);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(d){d=new h.Point(d.x,
d.y);this._reset();this._addPoint(d);this.canvas.contextTop.moveTo(d.x,d.y)},_addPoint:function(d){this._points.push(d)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(d){this._addPoint(new h.Point(d.x,d.y))},_render:function(){var d=this.canvas.contextTop,a=this.canvas.viewportTransform,g=this._points[0],c=this._points[1];d.save();d.transform(a[0],a[1],a[2],a[3],a[4],a[5]);d.beginPath();this._points.length===2&&g.x===c.x&&g.y===c.y&&
(g.x-=0.5,c.x+=0.5);d.moveTo(g.x,g.y);for(var a=1,b=this._points.length;a<b;a++)c=g.midPointFrom(c),d.quadraticCurveTo(g.x,g.y,c.x,c.y),g=this._points[a],c=this._points[a+1];d.lineTo(g.x,g.y);d.stroke();d.restore()},convertPointsToSVGPath:function(d){var a=[],g=new h.Point(d[0].x,d[0].y),c=new h.Point(d[1].x,d[1].y);a.push("M ",d[0].x," ",d[0].y," ");for(var b=1,e=d.length;b<e;b++){var f=g.midPointFrom(c);a.push("Q ",g.x," ",g.y," ",f.x," ",f.y," ");g=new h.Point(d[b].x,d[b].y);b+1<d.length&&(c=new h.Point(d[b+
1].x,d[b+1].y))}a.push("L ",g.x," ",g.y," ");return a},createPath:function(d){d=new h.Path(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,originX:"center",originY:"center"});if(this.shadow)this.shadow.affectStroke=!0,d.setShadow(this.shadow);return d},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var d=this.convertPointsToSVGPath(this._points).join("");d==="M 0 0 Q 0 0 0 0 L 0 0"?this.canvas.renderAll():
(d=this.createPath(d),this.canvas.add(d),d.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:d}))}})})();h.CircleBrush=h.util.createClass(h.BaseBrush,{width:10,initialize:function(d){this.canvas=d;this.points=[]},drawDot:function(d){var d=this.addPoint(d),a=this.canvas.contextTop,g=this.canvas.viewportTransform;a.save();a.transform(g[0],g[1],g[2],g[3],g[4],g[5]);a.fillStyle=d.fill;a.beginPath();a.arc(d.x,
d.y,d.radius,0,Math.PI*2,!1);a.closePath();a.fill();a.restore()},onMouseDown:function(d){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(d)},onMouseMove:function(d){this.drawDot(d)},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],g=0,c=this.points.length;g<c;g++){var b=this.points[g],b=new h.Circle({radius:b.radius,left:b.x,top:b.y,originX:"center",originY:"center",fill:b.fill});this.shadow&&
b.setShadow(this.shadow);a.push(b)}a=new h.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},addPoint:function(d){var d=new h.Point(d.x,d.y),a=h.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,g=(new h.Color(this.color)).setAlpha(h.util.getRandomInt(0,100)/100).toRgba();d.radius=a;d.fill=
g;this.points.push(d);return d}});h.SprayBrush=h.util.createClass(h.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d;this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(d);this.render()},onMouseMove:function(d){this.addSprayChunk(d);this.render()},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var a=[],g=0,c=this.sprayChunks.length;g<c;g++)for(var b=this.sprayChunks[g],e=0,f=b.length;e<f;e++){var k=new h.Rect({width:b[e].width,height:b[e].width,left:b[e].x+1,top:b[e].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&k.setShadow(this.shadow);a.push(k)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));a=new h.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},_getOptimizedRects:function(d){for(var a={},g,c=0,b=d.length;c<b;c++)g=d[c].left+""+d[c].top,a[g]||(a[g]=d[c]);d=[];for(g in a)d.push(a[g]);return d},render:function(){var d=this.canvas.contextTop;d.fillStyle=this.color;var a=this.canvas.viewportTransform;d.save();d.transform(a[0],a[1],a[2],a[3],a[4],a[5]);for(var a=0,g=this.sprayChunkPoints.length;a<g;a++){var c=this.sprayChunkPoints[a];if(typeof c.opacity!=="undefined")d.globalAlpha=
c.opacity;d.fillRect(c.x,c.y,c.width,c.width)}d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];for(var a,g,c,b=this.width/2,e=0;e<this.density;e++){a=h.util.getRandomInt(d.x-b,d.x+b);g=h.util.getRandomInt(d.y-b,d.y+b);c=this.dotWidthVariance?h.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;a=new h.Point(a,g);a.width=c;if(this.randomOpacity)a.opacity=h.util.getRandomInt(0,100)/100;this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}});
h.PatternBrush=h.util.createClass(h.PencilBrush,{getPatternSrc:function(){var d=h.document.createElement("canvas"),a=d.getContext("2d");d.width=d.height=25;a.fillStyle=this.color;a.beginPath();a.arc(10,10,10,0,Math.PI*2,!1);a.closePath();a.fill();return d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(d){d=this.callSuper("createPath",d);d.stroke=new h.Pattern({source:this.source||this.getPatternSrcFunction()});return d}});(function(){var d=h.util.getPointer,a=h.util.degreesToRadians,g=h.util.radiansToDegrees,c=Math.atan2,b=Math.abs;h.Canvas=h.util.createClass(h.StaticCanvas,{initialize:function(b,a){a||(a={});this._initStatic(b,a);this._initInteractive();this._createCacheCanvas();h.Canvas.activeInstance=this},uniScaleTransform:!1,
centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();
this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=h.PencilBrush&&new h.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(b){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,left:a.original.left,top:a.original.top});if(this._shouldCenterTransform(b,a.target))if(a.action==="rotate")this._setOriginToCenter(a.target);else{if(a.originX!=="center")a.mouseXSign=a.originX==="right"?-1:1;if(a.originY!=="center")a.mouseYSign=
a.originY==="bottom"?-1:1;a.originX="center";a.originY="center"}else a.originX=a.original.originX,a.originY=a.original.originY},containsPoint:function(b,a){var c=this.getPointer(b,!0),e=this._normalizePointer(a,c);return a.containsPoint(e)||a._findTargetCorner(c)},_normalizePointer:function(b,a){var c=this.getActiveGroup(),e=a.x,g=a.y;c&&b.type!=="group"&&c.contains(b)&&(c=new h.Point(c.left,c.top),c=h.util.transformPoint(c,this.viewportTransform,!0),e-=c.x,g-=c.y);return{x:e,y:g}},isTargetTransparent:function(b,
a,c){var e=b.hasBorders,g=b.transparentCorners;b.hasBorders=b.transparentCorners=!1;this._draw(this.contextCache,b);b.hasBorders=e;b.transparentCorners=g;b=h.util.isTransparent(this.contextCache,a,c,this.targetFindTolerance);this.clearContext(this.contextCache);return b},_shouldClearSelection:function(b,a){var c=this.getActiveGroup(),e=this.getActiveObject();return!a||a&&c&&!c.contains(a)&&c!==a&&!b.shiftKey||a&&!a.evented||a&&!a.selectable&&e&&e!==a},_shouldCenterTransform:function(b,a){if(a){var c=
this._currentTransform,e;c.action==="scale"||c.action==="scaleX"||c.action==="scaleY"?e=this.centeredScaling||a.centeredScaling:c.action==="rotate"&&(e=this.centeredRotation||a.centeredRotation);return e?!b.altKey:b.altKey}},_getOriginFromCorner:function(b,a){var c={x:b.originX,y:b.originY};if(a==="ml"||a==="tl"||a==="bl")c.x="right";else if(a==="mr"||a==="tr"||a==="br")c.x="left";if(a==="tl"||a==="mt"||a==="tr")c.y="bottom";else if(a==="bl"||a==="mb"||a==="br")c.y="top";return c},_getActionFromCorner:function(b,
a){var c="drag";a&&(c=a==="ml"||a==="mr"?"scaleX":a==="mt"||a==="mb"?"scaleY":a==="mtr"?"rotate":"scale");return c},_setupCurrentTransform:function(b,c){if(c){var e=this.getPointer(b),g=c._findTargetCorner(this.getPointer(b,!0)),d=this._getActionFromCorner(c,g),g=this._getOriginFromCorner(c,g);this._currentTransform={target:c,action:d,scaleX:c.scaleX,scaleY:c.scaleY,offsetX:e.x-c.left,offsetY:e.y-c.top,originX:g.x,originY:g.y,ex:e.x,ey:e.y,left:c.left,top:c.top,theta:a(c.angle),width:c.width*c.scaleX,
mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,originX:g.x,originY:g.y};this._resetCurrentTransform(b)}},_translateObject:function(b,a){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",b-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",a-this._currentTransform.offsetY)},_scaleObject:function(b,a,c){var e=this._currentTransform,g=e.target,d=g.get("lockScalingX"),p=g.get("lockScalingY"),j=g.get("lockScalingFlip");
if(!d||!p){var w=g.translateToOriginPoint(g.getCenterPoint(),e.originX,e.originY),b=g.toLocalPoint(new h.Point(b,a),e.originX,e.originY);this._setLocalMouse(b,e);this._setObjectScale(b,e,d,p,c,j);g.setPositionByOrigin(w,e.originX,e.originY)}},_setObjectScale:function(b,a,c,e,g,d){var h=a.target,j=!1,w=!1,C=h.stroke?h.strokeWidth:0;a.newScaleX=b.x/(h.width+C/2);a.newScaleY=b.y/(h.height+C/2);d&&a.newScaleX<=0&&a.newScaleX<h.scaleX&&(j=!0);d&&a.newScaleY<=0&&a.newScaleY<h.scaleY&&(w=!0);g==="equally"&&
!c&&!e?j||w||this._scaleObjectEqually(b,h,a):g?g==="x"&&!h.get("lockUniScaling")?j||c||h.set("scaleX",a.newScaleX):g==="y"&&!h.get("lockUniScaling")&&(w||e||h.set("scaleY",a.newScaleY)):(j||c||h.set("scaleX",a.newScaleX),w||e||h.set("scaleY",a.newScaleY));j||w||this._flipObject(a,g)},_scaleObjectEqually:function(b,a,c){var b=b.y+b.x,e=a.stroke?a.strokeWidth:0,e=(a.height+e/2)*c.original.scaleY+(a.width+e/2)*c.original.scaleX;c.newScaleX=c.original.scaleX*b/e;c.newScaleY=c.original.scaleY*b/e;a.set("scaleX",
c.newScaleX);a.set("scaleY",c.newScaleY)},_flipObject:function(b,a){if(b.newScaleX<0&&a!=="y")if(b.originX==="left")b.originX="right";else if(b.originX==="right")b.originX="left";if(b.newScaleY<0&&a!=="x")if(b.originY==="top")b.originY="bottom";else if(b.originY==="bottom")b.originY="top"},_setLocalMouse:function(a,c){var e=c.target;if(c.originX==="right")a.x*=-1;else if(c.originX==="center"&&(a.x*=c.mouseXSign*2,a.x<0))c.mouseXSign=-c.mouseXSign;if(c.originY==="bottom")a.y*=-1;else if(c.originY===
"center"&&(a.y*=c.mouseYSign*2,a.y<0))c.mouseYSign=-c.mouseYSign;b(a.x)>e.padding?a.x<0?a.x+=e.padding:a.x-=e.padding:a.x=0;b(a.y)>e.padding?a.y<0?a.y+=e.padding:a.y-=e.padding:a.y=0},_rotateObject:function(b,a){var e=this._currentTransform;if(!e.target.get("lockRotation")){var d=c(e.ey-e.top,e.ex-e.left),h=c(a-e.top,b-e.left),d=g(h-d+e.theta);d<0&&(d=360+d);e.target.angle=d%360}},setCursor:function(b){this.upperCanvasEl.style.cursor=b},_resetObjectTransform:function(b){b.scaleX=1;b.scaleY=1;b.setAngle(0)},
_drawSelection:function(){var a=this.contextTop,c=this._groupSelector,e=c.left,g=c.top,d=b(e),n=b(g);a.fillStyle=this.selectionColor;a.fillRect(c.ex-(e>0?0:-e),c.ey-(g>0?0:-g),d,n);a.lineWidth=this.selectionLineWidth;a.strokeStyle=this.selectionBorderColor;this.selectionDashArray.length>1?(e=c.ex+0.5-(e>0?0:d),c=c.ey+0.5-(g>0?0:n),a.beginPath(),h.util.drawDashedLine(a,e,c,e+d,c,this.selectionDashArray),h.util.drawDashedLine(a,e,c+n-1,e+d,c+n-1,this.selectionDashArray),h.util.drawDashedLine(a,e,c,
e,c+n,this.selectionDashArray),h.util.drawDashedLine(a,e+d-1,c,e+d-1,c+n,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(c.ex+0.5-(e>0?0:d),c.ey+0.5-(g>0?0:n),d,n)},_isLastRenderedObject:function(b){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(b,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(b,
!0))},findTarget:function(b,a){if(!this.skipTargetFind){if(this._isLastRenderedObject(b))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!a&&this.containsPoint(b,c))return c;c=this._searchPossibleTargets(b);this._fireOverOutEvents(c);return c}},_fireOverOutEvents:function(b){if(b){if(this._hoveredTarget!==b)this.fire("mouse:over",{target:b}),b.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),
this._hoveredTarget=b}else if(this._hoveredTarget)this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null},_checkTarget:function(b,a,c){if(a&&a.visible&&a.evented&&this.containsPoint(b,a))if((this.perPixelTargetFind||a.perPixelTargetFind)&&!a.isEditing){if(!this.isTargetTransparent(a,c.x,c.y))return!0}else return!0},_searchPossibleTargets:function(b){for(var a,c=this.getPointer(b,!0),e=this._objects.length;e--;)if(this._checkTarget(b,this._objects[e],
c)){this.relatedTarget=this._objects[e];a=this._objects[e];break}return a},getPointer:function(b,a,c){var e,g;if(!c)c=this.upperCanvasEl;var b=d(b,c),n=c.getBoundingClientRect(),p=n.width||0,j=n.height||0;if(!p||!j)"top"in n&&"bottom"in n&&(j=Math.abs(n.top-n.bottom)),"right"in n&&"left"in n&&(p=Math.abs(n.right-n.left));this.calcOffset();b.x-=this._offset.left;b.y-=this._offset.top;a||(b=h.util.transformPoint(b,h.util.invertTransform(this.viewportTransform)));p===0||j===0?(e=1,g=1):(e=c.width/p,
g=c.height/j);return{x:b.x*e,y:b.y*g}},_createUpperCanvas:function(){var b=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();h.util.addClass(this.upperCanvasEl,"upper-canvas "+b);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();
this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=h.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});h.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});h.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(b){var a=this.getWidth()||b.width,
c=this.getHeight()||b.height;h.util.setStyle(b,{position:"absolute",width:a+"px",height:c+"px",left:0,top:0});b.width=a;b.height=c;h.util.makeElementUnselectable(b)},_copyCanvasStyle:function(b,a){a.style.cssText=b.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(b){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=b;b.set("active",!0)},setActiveObject:function(b,a){this._setActiveObject(b);
this.renderAll();this.fire("object:selected",{target:b,e:a});b.fire("selected",{e:a});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(b){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:b});return this},_setActiveGroup:function(b){(this._activeGroup=b)&&b.set("active",!0)},setActiveGroup:function(b,a){this._setActiveGroup(b);
b&&(this.fire("object:selected",{target:b,e:a}),b.fire("selected",{e:a}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var b=this.getActiveGroup();b&&b.destroy();this.setActiveGroup(null)},discardActiveGroup:function(b){this._discardActiveGroup();this.fire("selection:cleared",{e:b});return this},deactivateAll:function(){for(var b=this.getObjects(),a=0,c=b.length;a<c;a++)b[a].set("active",!1);this._discardActiveGroup();this._discardActiveObject();
return this},deactivateAllWithDispatch:function(b){var a=this.getActiveGroup()||this.getActiveObject();a&&this.fire("before:selection:cleared",{target:a,e:b});this.deactivateAll();a&&this.fire("selection:cleared",{e:b});return this},drawControls:function(b){var a=this.getActiveGroup();a?this._drawGroupControls(b,a):this._drawObjectsControls(b)},_drawGroupControls:function(b,a){a._renderControls(b)},_drawObjectsControls:function(b){for(var a=0,c=this._objects.length;a<c;++a)if(this._objects[a]&&this._objects[a].active)this._objects[a]._renderControls(b),
this.lastRenderedObjectWithControlsAboveOverlay=this._objects[a]}});for(var e in h.StaticCanvas)e!=="prototype"&&(h.Canvas[e]=h.StaticCanvas[e]);if(h.isTouchSupported)h.Canvas.prototype._setCursorFromEvent=function(){};h.Element=h.Canvas})();(function(){var d={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},a=h.util.addListener,g=h.util.removeListener;h.util.object.extend(h.Canvas.prototype,{cursorMap:"n-resize,ne-resize,e-resize,se-resize,s-resize,sw-resize,w-resize,nw-resize".split(","),_initEventListeners:function(){this._bindEvents();
a(h.window,"resize",this._onResize);a(this.upperCanvasEl,"mousedown",this._onMouseDown);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"mousewheel",this._onMouseWheel);a(this.upperCanvasEl,"touchstart",this._onMouseDown);a(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),
Event.add(this.upperCanvasEl,"shake",this._onShake),Event.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=
this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){g(h.window,"resize",this._onResize);g(this.upperCanvasEl,"mousedown",this._onMouseDown);g(this.upperCanvasEl,"mousemove",this._onMouseMove);g(this.upperCanvasEl,"mousewheel",this._onMouseWheel);g(this.upperCanvasEl,"touchstart",this._onMouseDown);g(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",
this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake),Event.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,
b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onMouseDown:function(c){this.__onMouseDown(c);a(h.document,"touchend",this._onMouseUp);a(h.document,"touchmove",this._onMouseMove);g(this.upperCanvasEl,"mousemove",this._onMouseMove);g(this.upperCanvasEl,"touchmove",this._onMouseMove);c.type==="touchstart"?g(this.upperCanvasEl,"mousedown",this._onMouseDown):
(a(h.document,"mouseup",this._onMouseUp),a(h.document,"mousemove",this._onMouseMove))},_onMouseUp:function(c){this.__onMouseUp(c);g(h.document,"mouseup",this._onMouseUp);g(h.document,"touchend",this._onMouseUp);g(h.document,"mousemove",this._onMouseMove);g(h.document,"touchmove",this._onMouseMove);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"touchmove",this._onMouseMove);if(c.type==="touchend"){var b=this;setTimeout(function(){a(b.upperCanvasEl,"mousedown",b._onMouseDown)},
400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var e=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==e)||!a&&e||!a&&!e&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);
else{this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var e=this._shouldRender(b,this.getPointer(a));this._maybeGroupObjects(a);if(b)b.isMoving=!1;e&&this.renderAll();this._handleCursorAndEvent(a,b)}},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var e=this;setTimeout(function(){e._setCursorFromEvent(a,b)},50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=
this._currentTransform.target;if(a._scaling)a._scaling=!1;a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},
_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&h.util.clipContext(this,this.contextTop);var b=h.util.invertTransform(this.viewportTransform);this.freeDrawingBrush.onMouseDown(h.util.transformPoint(this.getPointer(a,!0),b));this.fire("mouse:down",{e:a});b=this.findTarget(a);typeof b!=="undefined"&&b.fire("mousedown",{e:a,target:b})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=h.util.invertTransform(this.viewportTransform);
this.freeDrawingBrush.onMouseMove(h.util.transformPoint(this.getPointer(a,!0),b))}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:a});b=this.findTarget(a);typeof b!=="undefined"&&b.fire("mousemove",{e:a,target:b})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a});var b=this.findTarget(a);typeof b!=="undefined"&&b.fire("mouseup",{e:a,target:b})},__onMouseDown:function(a){if(("which"in
a?a.which===1:a.button===1)||h.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var b=this.findTarget(a),e=this.getPointer(a,!0);this._previousPointer=e;var f=this._shouldRender(b,e),g=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,e):g&&(this._handleGrouping(a,b),b=this.getActiveGroup());b&&b.selectable&&!g&&(this._beforeTransform(a,b),this._setupCurrentTransform(a,b));f&&this.renderAll();this.fire("mouse:down",
{target:b,e:a});b&&b.fire("mousedown",{e:a})}},_beforeTransform:function(a,b){this.stateful&&b.saveState();if(b._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,e){this.deactivateAllWithDispatch(a);if(b&&b.selectable)this.setActiveObject(b,a);else if(this.selection)this._groupSelector={ex:e.x,ey:e.y,top:0,left:0}},_setOriginToCenter:function(a){this._previousOriginX=
this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=
null},__onMouseMove:function(a){var b,e;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(!(typeof a.touches!=="undefined"&&a.touches.length>1)){var f=this._groupSelector;f?(e=this.getPointer(a,!0),f.left=e.x-f.ex,f.top=e.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),!b||b&&!b.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,b));this.fire("mouse:move",{target:b,e:a});b&&b.fire("mousemove",{e:a})}},_transformObject:function(a){var b=
this.getPointer(a),e=this._currentTransform;e.reset=!1;e.target.isMoving=!0;this._beforeScaleTransform(a,e);this._performTransformAction(a,e,b);this.renderAll()},_performTransformAction:function(a,b,e){var f=e.x,e=e.y,g=b.target,d=b.action;d==="rotate"?(this._rotateObject(f,e),this._fire("rotating",g,a)):d==="scale"?(this._onScale(a,b,f,e),this._fire("scaling",g,a)):d==="scaleX"?(this._scaleObject(f,e,"x"),this._fire("scaling",g,a)):d==="scaleY"?(this._scaleObject(f,e,"y"),this._fire("scaling",g,
a)):(this._translateObject(f,e),this._fire("moving",g,a),this.setCursor(this.moveCursor))},_fire:function(a,b,e){this.fire("object:"+a,{target:b,e:e});b.fire(a,{e:e})},_beforeScaleTransform:function(a,b){if(b.action==="scale"||b.action==="scaleX"||b.action==="scaleY"){var e=this._shouldCenterTransform(a,b.target);if(e&&(b.originX!=="center"||b.originY!=="center")||!e&&b.originX==="center"&&b.originY==="center")this._resetCurrentTransform(a),b.reset=!0}},_onScale:function(a,b,e,f){(a.shiftKey||this.uniScaleTransform)&&
!b.target.get("lockUniScaling")?(b.currentAction="scale",this._scaleObject(e,f)):(!b.reset&&b.currentAction==="scale"&&this._resetCurrentTransform(a,b.target),b.currentAction="scaleEqually",this._scaleObject(e,f,"equally"))},_setCursorFromEvent:function(a,b){if(!b||!b.selectable)return this.setCursor(this.defaultCursor),!1;else{var e=this.getActiveGroup();(e=b._findTargetCorner&&(!e||!e.contains(b))&&b._findTargetCorner(this.getPointer(a,!0)))?this._setCornerCursor(e,b):this.setCursor(b.hoverCursor||
this.hoverCursor)}return!0},_setCornerCursor:function(a,b){if(a in d)this.setCursor(this._getRotatedCornerCursor(a,b));else if(a==="mtr"&&b.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(a,b){var e=Math.round(b.getAngle()%360/45);e<0&&(e+=8);e+=d[a];e%=8;return this.cursorMap[e]}})})();(function(){var d=Math.min,a=Math.max;h.util.object.extend(h.Canvas.prototype,{_shouldGroup:function(a,c){var b=this.getActiveObject();
return a.shiftKey&&(this.getActiveGroup()||b&&b!==c)&&this.selection},_handleGrouping:function(a,c){if(c===this.getActiveGroup()&&(c=this.findTarget(a,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,a):this._createActiveGroup(c,a);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(a,c){var b=this.getActiveGroup();if(b.contains(a)){if(b.removeWithUpdate(a),this._resetObjectTransform(b),a.set("active",!1),b.size()===1){this.discardActiveGroup(c);
this.setActiveObject(b.item(0));return}}else b.addWithUpdate(a),this._resetObjectTransform(b);this.fire("selection:created",{target:b,e:c});b.set("active",!0)},_createActiveGroup:function(a,c){if(this._activeObject&&a!==this._activeObject){var b=this._createGroup(a);b.addWithUpdate();this.setActiveGroup(b);this._activeObject=null;this.fire("selection:created",{target:b,e:c})}a.set("active",!0)},_createGroup:function(a){var c=this.getObjects(),a=c.indexOf(this._activeObject)<c.indexOf(a)?[this._activeObject,
a]:[a,this._activeObject];return new h.Group(a,{canvas:this})},_groupSelectedObjects:function(a){var c=this._collectObjects();c.length===1?this.setActiveObject(c[0],a):c.length>1&&(c=new h.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,a),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){var g=[],c;c=this._groupSelector.ex;for(var b=this._groupSelector.ey,e=c+this._groupSelector.left,f=b+this._groupSelector.top,k=new h.Point(d(c,
e),d(b,f)),m=new h.Point(a(c,e),a(b,f)),b=c===e&&b===f,e=this._objects.length;e--;)if((c=this._objects[e])&&c.selectable&&c.visible&&(c.intersectsWithRect(k,m)||c.isContainedWithinRect(k,m)||c.containsPoint(k)||c.containsPoint(m)))if(c.set("active",!0),g.push(c),b)break;return g},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);if(a=this.getActiveGroup())a.setObjectsCoords().setCoords(),a.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=
this._groupSelector=null}})})();h.util.object.extend(h.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var a=d.format||"png",g=d.quality||1,c=d.multiplier||1,d={left:d.left,top:d.top,width:d.width,height:d.height};return c!==1?this.__toDataURLWithMultiplier(a,g,d,c):this.__toDataURL(a,g,d)},__toDataURL:function(d,a,g){this.renderAll(!0);var c=this.upperCanvasEl||this.lowerCanvasEl,g=this.__getCroppedCanvas(c,g);d==="jpg"&&(d="jpeg");d=h.StaticCanvas.supports("toDataURLWithQuality")?(g||c).toDataURL("image/"+
d,a):(g||c).toDataURL("image/"+d);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},__getCroppedCanvas:function(d,a){var g,c;if("left"in a||"top"in a||"width"in a||"height"in a)g=h.util.createCanvasElement(),c=g.getContext("2d"),g.width=a.width||this.width,g.height=a.height||this.height,c.drawImage(d,-a.left||0,-a.top||0);return g},__toDataURLWithMultiplier:function(d,a,g,c){var b=this.getWidth(),e=this.getHeight(),f=b*c,h=e*c,m=this.getActiveObject(),o=this.getActiveGroup(),
i=this.contextTop||this.contextContainer;c>1&&this.setWidth(f).setHeight(h);i.scale(c,c);g.left&&(g.left*=c);g.top&&(g.top*=c);if(g.width)g.width*=c;else if(c<1)g.width=f;if(g.height)g.height*=c;else if(c<1)g.height=h;o?this._tempRemoveBordersControlsFromGroup(o):m&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);d=this.__toDataURL(d,a,g);this.width=b;this.height=e;i.scale(1/c,1/c);this.setWidth(b).setHeight(e);o?this._restoreBordersControlsOnGroup(o):m&&this.setActiveObject&&this.setActiveObject(m);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},toDataURLWithMultiplier:function(d,a,g){return this.toDataURL({format:d,multiplier:a,quality:g})},_tempRemoveBordersControlsFromGroup:function(d){d.origHasControls=d.hasControls;d.origBorderColor=d.borderColor;d.hasControls=!0;d.borderColor="rgba(0,0,0,0)";d.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(d){d.hideControls=d.origHideControls;
d.borderColor=d.origBorderColor;d.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});h.util.object.extend(h.StaticCanvas.prototype,{loadFromDatalessJSON:function(d,a,g){return this.loadFromJSON(d,a,g)},loadFromJSON:function(d,a,g){if(d){var c=typeof d==="string"?JSON.parse(d):d;this.clear();var b=this;this._enlivenObjects(c.objects,function(){b._setBgOverlay(c,a)},g);return this}},_setBgOverlay:function(d,a){var g=this,c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,
overlayImage:!1};if(!d.backgroundImage&&!d.overlayImage&&!d.background&&!d.overlay)a&&a();else{var b=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&(g.renderAll(),a&&a())};this.__setBgOverlay("backgroundImage",d.backgroundImage,c,b);this.__setBgOverlay("overlayImage",d.overlayImage,c,b);this.__setBgOverlay("backgroundColor",d.background,c,b);this.__setBgOverlay("overlayColor",d.overlay,c,b);b()}},__setBgOverlay:function(d,a,g,c){var b=this;if(a)if(d==="backgroundImage"||
d==="overlayImage")h.Image.fromObject(a,function(a){b[d]=a;g[d]=!0;c&&c()});else this["set"+h.util.string.capitalize(d,!0)](a,function(){g[d]=!0;c&&c()});else g[d]=!0},_enlivenObjects:function(d,a,g){var c=this;if(!d||d.length===0)a&&a();else{var b=this.renderOnAddRemove;this.renderOnAddRemove=!1;h.util.enlivenObjects(d,function(e){e.forEach(function(a,b){c.insertAt(a,b,!0)});c.renderOnAddRemove=b;a&&a()},null,g)}},_toDataURL:function(d,a){this.clone(function(g){a(g.toDataURL(d))})},_toDataURLWithMultiplier:function(d,
a,g){this.clone(function(c){g(c.toDataURLWithMultiplier(d,a))})},clone:function(d,a){var g=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(a){a.loadFromJSON(g,function(){d&&d(a)})})},cloneWithoutData:function(d){var a=h.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var g=new h.Canvas(a);g.clipTo=this.clipTo;this.backgroundImage?(g.setBackgroundImage(this.backgroundImage.src,function(){g.renderAll();d&&d(g)}),g.backgroundImageOpacity=this.backgroundImageOpacity,
g.backgroundImageStretch=this.backgroundImageStretch):d&&d(g)}});(function(d){var a=d.fabric||(d.fabric={}),d=a.util.object.extend,g=a.util.toFixed,c=a.util.string.capitalize,b=a.util.degreesToRadians,e=a.StaticCanvas.supports("setLineDash");if(!a.Object)a.Object=a.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",
cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,
includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(b){b.fill&&
b.fill.colorStops&&!(b.fill instanceof a.Gradient)&&this.set("fill",new a.Gradient(b.fill))},_initPattern:function(b){b.fill&&b.fill.source&&!(b.fill instanceof a.Pattern)&&this.set("fill",new a.Pattern(b.fill));b.stroke&&b.stroke.source&&!(b.stroke instanceof a.Pattern)&&this.set("stroke",new a.Pattern(b.stroke))},_initClipping:function(b){if(b.clipTo&&typeof b.clipTo==="string"&&(b=a.util.getFunctionBody(b.clipTo),typeof b!=="undefined"))this.clipTo=new Function("ctx",b)},setOptions:function(a){for(var b in a)this.set(b,
a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(a,c){this.group&&this.group.transform(a,c);var e=c?this._getLeftTopCoords():this.getCenterPoint();a.translate(e.x,e.y);a.rotate(b(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(b){var c=a.Object.NUM_FRACTION_DIGITS,c={type:this.type,originX:this.originX,originY:this.originY,left:g(this.left,c),top:g(this.top,c),width:g(this.width,c),height:g(this.height,
c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:g(this.strokeWidth,c),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:g(this.strokeMiterLimit,c),scaleX:g(this.scaleX,c),scaleY:g(this.scaleY,c),angle:g(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:g(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?
this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};this.includeDefaultValues||(c=this._removeDefaultValues(c));a.util.populateWithProperties(this,c,b);return c},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(b){var c=a.util.getKlass(b.type).prototype;c.stateProperties.forEach(function(a){b[a]===c[a]&&delete b[a]});
return b},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){typeof a==="object"?this._setObject(a):typeof b==="function"&&a!=="clipTo"?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(b,c){(b==="scaleX"||b==="scaleY")&&(c=this._constrainScale(c));b==="scaleX"&&c<0?(this.flipX=!this.flipX,c*=-1):b==="scaleY"&&c<0?(this.flipY=!this.flipY,c*=-1):b==="width"||b==="height"?
this.minScaleLimit=g(Math.min(0.1,1/Math.max(this.width,this.height)),2):b==="shadow"&&c&&!(c instanceof a.Shadow)&&(c=new a.Shadow(c));this[b]=c;return this},toggle:function(a){var b=this.get(a);typeof b==="boolean"&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(b,c){!(this.width===0&&this.height===0)&&this.visible&&
(b.save(),this._setupCompositeOperation(b),c||this.transform(b),this._setStrokeStyles(b),this._setFillStyles(b),this.group&&this.group.type==="path-group"&&b.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._setOpacity(b),this._setShadow(b),this.clipTo&&a.util.clipContext(this,b),this._render(b,c),this.clipTo&&b.restore(),this._removeShadow(b),this._restoreCompositeOperation(b),b.restore())},_setOpacity:function(a){this.group&&
this.group._setOpacity(a);a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){if(this.stroke)a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke},_setFillStyles:function(a){if(this.fill)a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill},_renderControls:function(c,e){var g=this.getViewportTransform();c.save();if(this.active&&!e){var d;this.group&&
(d=a.util.transformPoint(this.group.getCenterPoint(),g),c.translate(d.x,d.y),c.rotate(b(this.group.angle)));d=a.util.transformPoint(this.getCenterPoint(),g,null!=this.group);this.group&&(d.x*=this.group.scaleX,d.y*=this.group.scaleY);c.translate(d.x,d.y);c.rotate(b(this.angle));this.drawBorders(c);this.drawControls(c)}c.restore()},_setShadow:function(a){if(this.shadow){var b=this.canvas&&this.canvas._currentMultiplier||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*b*(this.scaleX+
this.scaleY)/2;a.shadowOffsetX=this.shadow.offsetX*b*this.scaleX;a.shadowOffsetY=this.shadow.offsetY*b*this.scaleY}},_removeShadow:function(a){if(this.shadow)a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_renderFill:function(a){this.fill&&(a.save(),this.fill.gradientTransform&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),this.fillRule==="evenodd"?a.fill("evenodd"):a.fill(),
a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&this.strokeWidth!==0&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?
this._stroke(a):a.stroke()),this._removeShadow(a),a.restore())},clone:function(b,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),b):new a.Object(this.toObject(c))},cloneAsImage:function(b){var c=this.toDataURL();a.util.loadImage(c,function(c){b&&b(new a.Image(c))});return this},toDataURL:function(b){b||(b={});var c=a.util.createCanvasElement(),e=this.getBoundingRect();c.width=e.width;c.height=e.height;a.util.wrapElement(c,"div");e=new a.Canvas(c);if(b.format==="jpg")b.format=
"jpeg";if(b.format==="jpeg")e.backgroundColor="#fff";var g={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new a.Point(c.width/2,c.height/2),"center","center");c=this.canvas;e.add(this);b=e.toDataURL(b);this.set(g).setCoords();this.canvas=c;e.dispose();return b},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(b,c){c||(c={});var e={colorStops:[]};
e.type=c.type||(c.r1||c.r2?"radial":"linear");e.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2)e.coords.r1=c.r1,e.coords.r2=c.r2;for(var g in c.colorStops){var d=new a.Color(c.colorStops[g]);e.colorStops.push({offset:g,color:d.toRgb(),opacity:d.getAlpha()})}return this.set(b,a.Gradient.forObject(this,e))},setPatternFill:function(b){return this.set("fill",new a.Pattern(b))},setShadow:function(b){return this.set("shadow",b?new a.Shadow(b):null)},setColor:function(a){this.set("fill",a);return this},
setAngle:function(a){var b=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;b&&this._setOriginToCenter();this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,b){var b=b||this.canvas.getPointer(a),c=this.translateToOriginPoint(this.getCenterPoint(),
"left","top");return{x:b.x-c.x,y:b.y-c.y}},_setupCompositeOperation:function(a){if(this.globalCompositeOperation)this._prevGlobalCompositeOperation=a.globalCompositeOperation,a.globalCompositeOperation=this.globalCompositeOperation},_restoreCompositeOperation:function(a){if(this.globalCompositeOperation&&this._prevGlobalCompositeOperation)a.globalCompositeOperation=this._prevGlobalCompositeOperation}}),a.util.createAccessors(a.Object),a.Object.prototype.rotate=a.Object.prototype.setAngle,d(a.Object.prototype,
a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.__uid=0})(typeof j!=="undefined"?j:this);(function(){var d=h.util.degreesToRadians;h.util.object.extend(h.Object.prototype,{translateToCenterPoint:function(a,g,c){var b=a.x,e=a.y,f=this.stroke?this.strokeWidth:0;g==="left"?b=a.x+(this.getWidth()+f*this.scaleX)/2:g==="right"&&(b=a.x-(this.getWidth()+f*this.scaleX)/2);c==="top"?e=a.y+(this.getHeight()+f*this.scaleY)/2:c==="bottom"&&(e=a.y-(this.getHeight()+f*this.scaleY)/2);return h.util.rotatePoint(new h.Point(b,
e),a,d(this.angle))},translateToOriginPoint:function(a,g,c){var b=a.x,e=a.y,f=this.stroke?this.strokeWidth:0;g==="left"?b=a.x-(this.getWidth()+f*this.scaleX)/2:g==="right"&&(b=a.x+(this.getWidth()+f*this.scaleX)/2);c==="top"?e=a.y-(this.getHeight()+f*this.scaleY)/2:c==="bottom"&&(e=a.y+(this.getHeight()+f*this.scaleY)/2);return h.util.rotatePoint(new h.Point(b,e),a,d(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new h.Point(this.left,this.top),this.originX,this.originY)},
getPointByOrigin:function(a,g){return this.translateToOriginPoint(this.getCenterPoint(),a,g)},toLocalPoint:function(a,g,c){var b=this.getCenterPoint(),e=this.stroke?this.strokeWidth:0;g&&c?(g=g==="left"?b.x-(this.getWidth()+e*this.scaleX)/2:g==="right"?b.x+(this.getWidth()+e*this.scaleX)/2:b.x,c=c==="top"?b.y-(this.getHeight()+e*this.scaleY)/2:c==="bottom"?b.y+(this.getHeight()+e*this.scaleY)/2:b.y):(g=this.left,c=this.top);return h.util.rotatePoint(new h.Point(a.x,a.y),b,-d(this.angle)).subtractEquals(new h.Point(g,
c))},setPositionByOrigin:function(a,g,c){a=this.translateToOriginPoint(this.translateToCenterPoint(a,g,c),this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(a){var g=d(this.angle),c=this.getWidth()/2,b=Math.cos(g)*c;c*=Math.sin(g);var e=this.getWidth(),f=Math.cos(g)*e,g=Math.sin(g)*e;this.originX==="center"&&a==="left"||this.originX==="right"&&a==="center"?(this.left-=b,this.top-=c):this.originX==="left"&&a==="center"||this.originX==="center"&&a==="right"?
(this.left+=b,this.top+=c):this.originX==="left"&&a==="right"?(this.left+=f,this.top+=g):this.originX==="right"&&a==="left"&&(this.left-=f,this.top-=g);this.setCoords();this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);
this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var d=h.util.degreesToRadians;h.util.object.extend(h.Object.prototype,{oCoords:null,intersectsWithRect:function(a,g){var c=this.oCoords,b=new h.Point(c.tl.x,c.tl.y),e=new h.Point(c.tr.x,c.tr.y),f=new h.Point(c.bl.x,c.bl.y),c=new h.Point(c.br.x,
c.br.y);return h.Intersection.intersectPolygonRectangle([b,e,c,f],a,g).status==="Intersection"},intersectsWithObject:function(a){function g(a){return{tl:new h.Point(a.tl.x,a.tl.y),tr:new h.Point(a.tr.x,a.tr.y),bl:new h.Point(a.bl.x,a.bl.y),br:new h.Point(a.br.x,a.br.y)}}var c=g(this.oCoords),a=g(a.oCoords);return h.Intersection.intersectPolygonPolygon([c.tl,c.tr,c.br,c.bl],[a.tl,a.tr,a.br,a.bl]).status==="Intersection"},isContainedWithinObject:function(a){var g=a.getBoundingRect(),a=new h.Point(g.left,
g.top),g=new h.Point(g.left+g.width,g.top+g.height);return this.isContainedWithinRect(a,g)},isContainedWithinRect:function(a,g){var c=this.getBoundingRect();return c.left>=a.x&&c.left+c.width<=g.x&&c.top>=a.y&&c.top+c.height<=g.y},containsPoint:function(a){var g=this._getImageLines(this.oCoords),a=this._findCrossPoints(a,g);return a!==0&&a%2===1},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,
g){var c,b,e,f=0,d;for(d in g)if(e=g[d],!(e.o.y<a.y&&e.d.y<a.y)&&!(e.o.y>=a.y&&e.d.y>=a.y)&&(e.o.x===e.d.x&&e.o.x>=a.x?c=e.o.x:(c=(e.d.y-e.o.y)/(e.d.x-e.o.x),b=a.y-0*a.x,e=e.o.y-c*e.o.x,c=-(b-e)/(0-c)),c>=a.x&&(f+=1),f===2))break;return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],
g=h.util.array.min(a),a=h.util.array.max(a),a=Math.abs(g-a),c=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],b=h.util.array.min(c),c=h.util.array.max(c),c=Math.abs(b-c);return{left:g,top:b,width:a,height:c}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){a=this._constrainScale(a);if(a<0)this.flipX=
!this.flipX,this.flipY=!this.flipY,a*=-1;this.scaleY=this.scaleX=a;this.setCoords();return this},scaleToWidth:function(a){var g=this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/g)},scaleToHeight:function(a){var g=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/g)},setCoords:function(){var a=this.strokeWidth,g=d(this.angle),c=this.getViewportTransform(),b=function(a){return h.util.transformPoint(a,c)},e=this.width,f=this.height,k=this.strokeLineCap===
"round"||this.strokeLineCap==="square",m=this.type==="line"&&this.width===0,o=this.type==="line"&&this.height===0,i=m||o;m?e=a:o&&(f=a);(k&&o||!i)&&(e+=e>0?a:-a);(k&&m||!i)&&(f+=f>0?a:-a);this.currentWidth=e*this.scaleX;this.currentHeight=f*this.scaleY;if(this.currentWidth<0)this.currentWidth=Math.abs(this.currentWidth);f=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));a=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0);e=
Math.cos(a+g)*f;f*=Math.sin(a+g);var o=Math.sin(g),i=Math.cos(g),k=this.getCenterPoint(),n=new h.Point(this.currentWidth,this.currentHeight),p=new h.Point(k.x-e,k.y-f),j=new h.Point(p.x+n.x*i,p.y+n.x*o),w=new h.Point(p.x-n.y*o,p.y+n.y*i),C=new h.Point(p.x+n.x/2*i,p.y+n.x/2*o),e=b(p),f=b(j),k=b(new h.Point(j.x-n.y*o,j.y+n.y*i)),m=b(w),p=b(new h.Point(p.x-n.y/2*o,p.y+n.y/2*i)),l=b(C),j=b(new h.Point(j.x-n.y/2*o,j.y+n.y/2*i)),o=b(new h.Point(w.x+n.x/2*i,w.y+n.x/2*o)),b=b(new h.Point(C.x,C.y)),i=Math.cos(a+
g)*this.padding*Math.sqrt(2),g=Math.sin(a+g)*this.padding*Math.sqrt(2),e=e.add(new h.Point(-i,-g)),f=f.add(new h.Point(g,-i)),k=k.add(new h.Point(i,g)),m=m.add(new h.Point(-g,i)),p=p.add(new h.Point((-i-g)/2,(-g+i)/2)),l=l.add(new h.Point((g-i)/2,-(g+i)/2)),j=j.add(new h.Point((g+i)/2,(g-i)/2)),o=o.add(new h.Point((i-g)/2,(i+g)/2)),b=b.add(new h.Point((g-i)/2,-(g+i)/2));this.oCoords={tl:e,tr:f,br:k,bl:m,ml:p,mt:l,mr:j,mb:o,mtr:b};this._setCornerCoords&&this._setCornerCoords();return this}})})();h.util.object.extend(h.Object.prototype,
{sendToBack:function(){this.group?h.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?h.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(d){this.group?h.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas.sendBackwards(this,d);return this},bringForward:function(d){this.group?h.StaticCanvas.prototype.bringForward.call(this.group,
this,d):this.canvas.bringForward(this,d);return this},moveTo:function(d){this.group?h.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas.moveTo(this,d);return this}});h.util.object.extend(h.Object.prototype,{getSvgStyles:function(){var d=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",a=this.fillRule,g=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",c=this.strokeWidth?this.strokeWidth:"0",b=this.strokeDashArray?this.strokeDashArray.join(" "):
"";return["stroke: ",g,"; stroke-width: ",c,"; stroke-dasharray: ",b,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",d,"; fill-rule: ",a,"; opacity: ",typeof this.opacity!=="undefined"?this.opacity:"1",";",this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},
getSvgTransform:function(){if(this.group&&this.group.type==="path-group")return"";var d=h.util.toFixed,a=this.getAngle(),g=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],c=h.util.transformPoint(this.getCenterPoint(),g),b=h.Object.NUM_FRACTION_DIGITS,c=this.type==="path-group"?"":"translate("+d(c.x,b)+" "+d(c.y,b)+")",a=a!==0?" rotate("+d(a,b)+")":"",d=this.scaleX===1&&this.scaleY===1&&g[0]===1&&g[3]===1?"":" scale("+d(this.scaleX*g[0],b)+" "+d(this.scaleY*
g[3],b)+")",b=this.type==="path-group"?this.width*g[0]:0,g=this.type==="path-group"?this.height*g[3]:0;return[c,a,d,this.flipX?" matrix(-1 0 0 1 "+b+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+g+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_createBaseSVGMarkup:function(){var d=[];this.fill&&this.fill.toLive&&d.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&d.push(this.stroke.toSVG(this,!1));this.shadow&&
d.push(this.shadow.toSVG(this));return d}});h.util.object.extend(h.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(d){return this.get(d)!==this.originalState[d]},this)},saveState:function(d){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);d&&d.stateProperties&&d.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var d=h.util.degreesToRadians;h.util.object.extend(h.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var g=a.x,a=a.y,c,b;for(b in this.oCoords)if(this.isControlVisible(b)&&(b!=="mtr"||this.hasRotatingPoint))if(!this.get("lockUniScaling")||!(b==="mt"||b==="mr"||b==="mb"||b==="ml"))if(c=this._getImageLines(this.oCoords[b].corner),c=this._findCrossPoints({x:g,y:a},c),c!==0&&c%2===1)return this.__corner=b;return!1},_setCornerCoords:function(){var a=
this.oCoords,g=d(this.angle),c=d(45-this.angle),b=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,e=b*Math.cos(c),c=b*Math.sin(c),b=Math.sin(g),g=Math.cos(g);a.tl.corner={tl:{x:a.tl.x-c,y:a.tl.y-e},tr:{x:a.tl.x+e,y:a.tl.y-c},bl:{x:a.tl.x-e,y:a.tl.y+c},br:{x:a.tl.x+c,y:a.tl.y+e}};a.tr.corner={tl:{x:a.tr.x-c,y:a.tr.y-e},tr:{x:a.tr.x+e,y:a.tr.y-c},br:{x:a.tr.x+c,y:a.tr.y+e},bl:{x:a.tr.x-e,y:a.tr.y+c}};a.bl.corner={tl:{x:a.bl.x-c,y:a.bl.y-e},bl:{x:a.bl.x-e,y:a.bl.y+c},br:{x:a.bl.x+c,y:a.bl.y+e},tr:{x:a.bl.x+
e,y:a.bl.y-c}};a.br.corner={tr:{x:a.br.x+e,y:a.br.y-c},bl:{x:a.br.x-e,y:a.br.y+c},br:{x:a.br.x+c,y:a.br.y+e},tl:{x:a.br.x-c,y:a.br.y-e}};a.ml.corner={tl:{x:a.ml.x-c,y:a.ml.y-e},tr:{x:a.ml.x+e,y:a.ml.y-c},bl:{x:a.ml.x-e,y:a.ml.y+c},br:{x:a.ml.x+c,y:a.ml.y+e}};a.mt.corner={tl:{x:a.mt.x-c,y:a.mt.y-e},tr:{x:a.mt.x+e,y:a.mt.y-c},bl:{x:a.mt.x-e,y:a.mt.y+c},br:{x:a.mt.x+c,y:a.mt.y+e}};a.mr.corner={tl:{x:a.mr.x-c,y:a.mr.y-e},tr:{x:a.mr.x+e,y:a.mr.y-c},bl:{x:a.mr.x-e,y:a.mr.y+c},br:{x:a.mr.x+c,y:a.mr.y+e}};
a.mb.corner={tl:{x:a.mb.x-c,y:a.mb.y-e},tr:{x:a.mb.x+e,y:a.mb.y-c},bl:{x:a.mb.x-e,y:a.mb.y+c},br:{x:a.mb.x+c,y:a.mb.y+e}};a.mtr.corner={tl:{x:a.mtr.x-c+b*this.rotatingPointOffset,y:a.mtr.y-e-g*this.rotatingPointOffset},tr:{x:a.mtr.x+e+b*this.rotatingPointOffset,y:a.mtr.y-c-g*this.rotatingPointOffset},bl:{x:a.mtr.x-e+b*this.rotatingPointOffset,y:a.mtr.y+c-g*this.rotatingPointOffset},br:{x:a.mtr.x+c+b*this.rotatingPointOffset,y:a.mtr.y+e-g*this.rotatingPointOffset}}},drawBorders:function(a){if(!this.hasBorders)return this;
var g=this.padding,c=g*2,b=this.getViewportTransform();a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var e=1/this._constrainScale(this.scaleX),f=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;var d=this.getWidth(),m=this.getHeight(),o=this.strokeWidth,i=this.strokeLineCap==="round"||this.strokeLineCap==="square",n=this.type==="line"&&this.width===0,p=this.type==="line"&&this.height===0,j=n||p;n?d=o/e:p&&(m=o/f);(i&&p||
!j)&&(d+=o/e);(i&&n||!j)&&(m+=o/f);e=h.util.transformPoint(new h.Point(d,m),b,!0);b=e.x;e=e.y;this.group&&(b*=this.group.scaleX,e*=this.group.scaleY);a.strokeRect(~~(-(b/2)-g)-0.5,~~(-(e/2)-g)-0.5,~~(b+c)+1,~~(e+c)+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(g=(-e-g*2)/2,a.beginPath(),a.moveTo(0,g),a.lineTo(0,g-this.rotatingPointOffset),a.closePath(),a.stroke());a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;
var g=this.cornerSize,c=g/2,b=this.getViewportTransform(),e=this.strokeWidth,f=this.width,d=this.height,m=this.strokeLineCap==="round"||this.strokeLineCap==="square",o=this.type==="line"&&this.width===0,i=this.type==="line"&&this.height===0,n=o||i;o?f=e:i&&(d=e);(m&&i||!n)&&(f+=e);(m&&o||!n)&&(d+=e);f*=this.scaleX;d*=this.scaleY;e=h.util.transformPoint(new h.Point(f,d),b,!0);b=e.x;e=e.y;f=-(b/2);d=-(e/2);m=this.padding;g=c-g;o=this.transparentCorners?"strokeRect":"fillRect";a.save();a.lineWidth=1;
a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",a,o,f-c-m,d-c-m);this._drawControl("tr",a,o,f+b-c+m,d-c-m);this._drawControl("bl",a,o,f-c-m,d+e+g+m);this._drawControl("br",a,o,f+b+g+m,d+e+g+m);this.get("lockUniScaling")||(this._drawControl("mt",a,o,f+b/2-c,d-c-m),this._drawControl("mb",a,o,f+b/2-c,d+e+g+m),this._drawControl("mr",a,o,f+b+g+m,d+e/2-c),this._drawControl("ml",a,o,f-c-m,d+e/2-c));this.hasRotatingPoint&&this._drawControl("mtr",
a,o,f+b/2-c,d-this.rotatingPointOffset-this.cornerSize/2-m);a.restore();return this},_drawControl:function(a,g,c,b,e){var f=this.cornerSize;this.isControlVisible(a)&&(typeof G_vmlCanvasManager!=="undefined"||this.transparentCorners||g.clearRect(b,e,f,f),g[c](b,e,f,f))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,g){this._getControlsVisibility()[a]=g;return this},setControlsVisibility:function(a){a||(a={});for(var g in a)this.setControlVisible(g,
a[g]);return this},_getControlsVisibility:function(){if(!this._controlsVisibility)this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0};return this._controlsVisibility}})})();h.util.object.extend(h.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(d,a){var a=a||{},g=function(){},c=a.onComplete||g,b=a.onChange||g,e=this;h.util.animate({startValue:d.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){d.set("left",a);e.renderAll();
b()},onComplete:function(){d.setCoords();c()}});return this},fxCenterObjectV:function(d,a){var a=a||{},g=function(){},c=a.onComplete||g,b=a.onChange||g,e=this;h.util.animate({startValue:d.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(a){d.set("top",a);e.renderAll();b()},onComplete:function(){d.setCoords();c()}});return this},fxRemove:function(d,a){var a=a||{},g=function(){},c=a.onComplete||g,b=a.onChange||g,e=this;h.util.animate({startValue:d.get("opacity"),
endValue:0,duration:this.FX_DURATION,onStart:function(){d.set("active",!1)},onChange:function(a){d.set("opacity",a);e.renderAll();b()},onComplete:function(){e.remove(d);c()}});return this}});h.util.object.extend(h.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var d=[],a,g;for(a in arguments[0])d.push(a);for(var c=0,b=d.length;c<b;c++)a=d[c],g=c!==b-1,this._animate(a,arguments[0][a],arguments[1],g)}else this._animate.apply(this,arguments);return this},_animate:function(d,
a,g,c){var b=this,e,a=a.toString(),g=g?h.util.object.clone(g):{};~d.indexOf(".")&&(e=d.split("."));var f=e?this.get(e[0])[e[1]]:this.get(d);if(!("from"in g))g.from=f;a=~a.indexOf("=")?f+parseFloat(a.replace("=","")):parseFloat(a);h.util.animate({startValue:g.from,endValue:a,byValue:g.by,easing:g.easing,duration:g.duration,abort:g.abort&&function(){return g.abort.call(b)},onChange:function(a){e?b[e[0]][e[1]]=a:b.set(d,a);c||g.onChange&&g.onChange()},onComplete:function(){c||(b.setCoords(),g.onComplete&&
g.onComplete())}})}});(function(d){function a(a,b){var c=a.origin,e=a.axis1,g=a.axis2,d=a.dimension,h=b.nearest,j=b.center,w=b.farthest;return function(){switch(this.get(c)){case h:return Math.min(this.get(e),this.get(g));case j:return Math.min(this.get(e),this.get(g))+0.5*this.get(d);case w:return Math.max(this.get(e),this.get(g))}}}var g=d.fabric||(d.fabric={}),c=g.util.object.extend,b={x1:1,x2:1,y1:1,y2:1},e=g.StaticCanvas.supports("setLineDash");g.Line?g.warn("fabric.Line is already defined"):
(g.Line=g.util.createClass(g.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,c){this.callSuper("_set",
a,c);typeof b[a]!=="undefined"&&this._setWidthHeight();return this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){a.beginPath();if(b){var c=this.getCenterPoint();a.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&
e)c=this.calcLinePoints(),a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2);a.lineWidth=this.strokeWidth;c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=c},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath();g.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray);a.closePath()},toObject:function(a){return c(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=
this.y2?-1:1;return{x1:a*this.width*0.5,x2:a*this.width*-0.5,y1:b*this.height*0.5,y2:b*this.height*-0.5}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&this.group.type==="path-group"||(c=this.calcLinePoints());b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),
g.Line.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),g.Line.fromElement=function(a,b){var e=g.parseAttributes(a,g.Line.ATTRIBUTE_NAMES);return new g.Line([e.x1||0,e.y1||0,e.x2||0,e.y2||0],c(e,b))},g.Line.fromObject=function(a){return new g.Line([a.x1,a.y1,a.x2,a.y2],a)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=Math.PI,c=a.util.object.extend;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",
radius:0,startAngle:0,endAngle:g*2,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,c){this.callSuper("_set",a,c);a==="radius"&&this.setRadius(c);return this},toObject:function(a){return c(this.callSuper("toObject",a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var c=this._createBaseSVGMarkup(),f=0,
d=0,h=(this.endAngle-this.startAngle)%(2*g);if(h===0)this.group&&this.group.type==="path-group"&&(f=this.left+this.radius,d=this.top+this.radius),c.push("<circle ",'cx="'+f+'" cy="'+d+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var f=Math.cos(this.startAngle)*this.radius,d=Math.sin(this.startAngle)*this.radius,o=Math.cos(this.endAngle)*this.radius,i=Math.sin(this.endAngle)*this.radius;c.push('<path d="M '+
f+" "+d," A "+this.radius+" "+this.radius," 0 ",+(h>g?1:0)+" 1"," "+o+" "+i,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(c.join("")):c.join("")},_render:function(a,c){a.beginPath();a.arc(c?this.left+this.radius:0,c?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*
this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",a*2).set("height",a*2)},complexity:function(){return 1}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),a.Circle.fromElement=function(b,e){e||(e={});var f=a.parseAttributes(b,a.Circle.ATTRIBUTE_NAMES);if(!("radius"in f&&f.radius>0))throw Error("value of `r` attribute is required and can not be negative");f.left=f.left||0;f.top=f.top||0;f=new a.Circle(c(f,e));f.left-=f.radius;f.top-=f.radius;return f},
a.Circle.fromObject=function(b){return new a.Circle(b)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var c=this.width/2,b=this.height/2;a.beginPath();a.moveTo(-c,b);a.lineTo(0,-b);a.lineTo(c,b);a.closePath();this._renderFill(a);
this._renderStroke(a)},_renderDashedStroke:function(g){var c=this.width/2,b=this.height/2;g.beginPath();a.util.drawDashedLine(g,-c,b,0,-b,this.strokeDashArray);a.util.drawDashedLine(g,0,-b,c,b,this.strokeDashArray);a.util.drawDashedLine(g,c,b,-c,b,this.strokeDashArray);g.closePath()},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=this.width/2,e=this.height/2,b=[-b+" "+e,"0 "+-e,b+" "+e].join(",");c.push("<polygon ",'points="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),
'"/>');return a?a(c.join("")):c.join("")},complexity:function(){return 1}}),a.Triangle.fromObject=function(g){return new a.Triangle(g)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=Math.PI*2,c=a.util.object.extend;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,c){this.callSuper("_set",
a,c);switch(a){case "rx":this.rx=c;this.set("width",c*2);break;case "ry":this.ry=c,this.set("height",c*2)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return c(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var c=this._createBaseSVGMarkup(),f=0,g=0;this.group&&this.group.type==="path-group"&&(f=this.left+this.rx,g=this.top+this.ry);c.push("<ellipse ",'cx="',
f,'" cy="',g,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a,c){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(c?this.left+this.rx:0,c?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,g,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),
a.Ellipse.fromElement=function(b,e){e||(e={});var f=a.parseAttributes(b,a.Ellipse.ATTRIBUTE_NAMES);f.left=f.left||0;f.top=f.top||0;f=new a.Ellipse(c(f,e));f.top-=f.ry;f.left-=f.rx;return f},a.Ellipse.fromObject=function(b){return new a.Ellipse(b)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Rect?console.warn("fabric.Rect is already defined"):(d=a.Object.prototype.stateProperties.concat(),d.push("rx","ry","x","y"),a.Rect=a.util.createClass(a.Object,
{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry)this.ry=this.rx;else if(this.ry&&!this.rx)this.rx=this.ry},_render:function(a,b){if(this.width===1&&this.height===1)a.fillRect(0,0,1,1);else{var e=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/2):0,g=this.width,d=this.height,h=b?this.left:-this.width/2,i=b?this.top:-this.height/2,n=
e!==0||f!==0;a.beginPath();a.moveTo(h+e,i);a.lineTo(h+g-e,i);n&&a.bezierCurveTo(h+g-0.4477152502*e,i,h+g,i+0.4477152502*f,h+g,i+f);a.lineTo(h+g,i+d-f);n&&a.bezierCurveTo(h+g,i+d-0.4477152502*f,h+g-0.4477152502*e,i+d,h+g-e,i+d);a.lineTo(h+e,i+d);n&&a.bezierCurveTo(h+0.4477152502*e,i+d,h,i+d-0.4477152502*f,h,i+d-f);a.lineTo(h,i+f);n&&a.bezierCurveTo(h,i+0.4477152502*f,h+0.4477152502*e,i,h+e,i);a.closePath();this._renderFill(a);this._renderStroke(a)}},_renderDashedStroke:function(c){var b=-this.width/
2,e=-this.height/2,f=this.width,g=this.height;c.beginPath();a.util.drawDashedLine(c,b,e,b+f,e,this.strokeDashArray);a.util.drawDashedLine(c,b+f,e,b+f,e+g,this.strokeDashArray);a.util.drawDashedLine(c,b+f,e+g,b,e+g,this.strokeDashArray);a.util.drawDashedLine(c,b,e+g,b,e,this.strokeDashArray);c.closePath()},toObject:function(a){a=g(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),
e=this.left,f=this.top;this.group&&this.group.type==="path-group"||(e=-this.width/2,f=-this.height/2);b.push("<rect ",'x="',e,'" y="',f,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=
function(c,b){if(!c)return null;var b=b||{},e=a.parseAttributes(c,a.Rect.ATTRIBUTE_NAMES);e.left=e.left||0;e.top=e.top||0;return new a.Rect(g(b?a.util.object.clone(b):{},e))},a.Rect.fromObject=function(c){return new a.Rect(c)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(g,c){return a.Polygon.prototype.initialize.call(this,
g,c)},_calcDimensions:function(){return a.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return a.Polygon.prototype._applyPointOffset.call(this)},toObject:function(g){return a.Polygon.prototype.toObject.call(this,g)},toSVG:function(g){return a.Polygon.prototype.toSVG.call(this,g)},_render:function(g){a.Polygon.prototype.commonRender.call(this,g);this._renderFill(g);this._renderStroke(g)},_renderDashedStroke:function(g){var c,b;g.beginPath();for(var e=0,f=this.points.length;e<
f;e++)c=this.points[e],b=this.points[e+1]||c,a.util.drawDashedLine(g,c.x,c.y,b.x,b.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElement=function(g,c){if(!g)return null;c||(c={});var b=a.parsePointsAttribute(g.getAttribute("points")),e=a.parseAttributes(g,a.Polyline.ATTRIBUTE_NAMES);return b===null?null:new a.Polyline(b,a.util.object.extend(e,c))},a.Polyline.fromObject=function(g){return new a.Polyline(g.points,
g,!0)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,e=a.util.toFixed;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a;this.callSuper("initialize",b);this._calcDimensions();if(!("top"in b))this.top=this.minY;if(!("left"in b))this.left=this.minX},_calcDimensions:function(){var a=
this.points,e=c(a,"x"),g=c(a,"y"),d=b(a,"x"),a=b(a,"y");this.width=d-e||1;this.height=a-g||1;this.minX=e;this.minY=g},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return g(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),g=0,d=this.points.length;g<d;g++)b.push(e(this.points[g].x,2),",",e(this.points[g].y,2)," ");c.push("<",this.type,
" ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a);this._renderFill(a);if(this.stroke||this.strokeDashArray)a.closePath(),this._renderStroke(a)},commonRender:function(a){var b;a.beginPath();if(this._applyPointOffset)this.group&&this.group.type==="path-group"||this._applyPointOffset(),this._applyPointOffset=null;a.moveTo(this.points[0].x,
this.points[0].y);for(var c=0,e=this.points.length;c<e;c++)b=this.points[c],a.lineTo(b.x,b.y)},_renderDashedStroke:function(b){a.Polyline.prototype._renderDashedStroke.call(this,b);b.closePath()},complexity:function(){return this.points.length}}),a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=function(b,c){if(!b)return null;c||(c={});var e=a.parsePointsAttribute(b.getAttribute("points")),d=a.parseAttributes(b,a.Polygon.ATTRIBUTE_NAMES);return e===null?null:new a.Polygon(e,
g(d,c))},a.Polygon.fromObject=function(b){return new a.Polygon(b.points,b,!0)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.array.min,c=a.util.array.max,b=a.util.object.extend,e=Object.prototype.toString,f=a.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},m={m:"l",M:"L"};a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");
var c=e.call(a)==="[object Array]";if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)){if(!c)this.path=this._parsePath();c=this._parseDimensions();this.minX=c.left;this.minY=c.top;this.width=c.width;this.height=c.height;c.left+=this.originX==="center"?this.width/2:this.originX==="right"?this.width:0;c.top+=this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0;this.top=this.top||c.top;this.left=this.left||c.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/
2,y:this.minY+this.height/2};b.sourcePath&&this.setSourcePath(b.sourcePath)}},_render:function(a){var b,c=null,e=0,g=0,d=0,h=0,k=0,m=0,j,l,v,E,r=-this.pathOffset.x,q=-this.pathOffset.y;this.group&&this.group.type==="path-group"&&(q=r=0);a.beginPath();for(var t=0,s=this.path.length;t<s;++t){b=this.path[t];switch(b[0]){case "l":d+=b[1];h+=b[2];a.lineTo(d+r,h+q);break;case "L":d=b[1];h=b[2];a.lineTo(d+r,h+q);break;case "h":d+=b[1];a.lineTo(d+r,h+q);break;case "H":d=b[1];a.lineTo(d+r,h+q);break;case "v":h+=
b[1];a.lineTo(d+r,h+q);break;case "V":h=b[1];a.lineTo(d+r,h+q);break;case "m":d+=b[1];h+=b[2];e=d;g=h;a.moveTo(d+r,h+q);break;case "M":d=b[1];h=b[2];e=d;g=h;a.moveTo(d+r,h+q);break;case "c":j=d+b[5];l=h+b[6];k=d+b[3];m=h+b[4];a.bezierCurveTo(d+b[1]+r,h+b[2]+q,k+r,m+q,j+r,l+q);d=j;h=l;break;case "C":d=b[5];h=b[6];k=b[3];m=b[4];a.bezierCurveTo(b[1]+r,b[2]+q,k+r,m+q,d+r,h+q);break;case "s":j=d+b[3];l=h+b[4];k=k?2*d-k:d;m=m?2*h-m:h;a.bezierCurveTo(k+r,m+q,d+b[1]+r,h+b[2]+q,j+r,l+q);k=d+b[1];m=h+b[2];
d=j;h=l;break;case "S":j=b[3];l=b[4];k=2*d-k;m=2*h-m;a.bezierCurveTo(k+r,m+q,b[1]+r,b[2]+q,j+r,l+q);d=j;h=l;k=b[1];m=b[2];break;case "q":j=d+b[3];l=h+b[4];k=d+b[1];m=h+b[2];a.quadraticCurveTo(k+r,m+q,j+r,l+q);d=j;h=l;break;case "Q":j=b[3];l=b[4];a.quadraticCurveTo(b[1]+r,b[2]+q,j+r,l+q);d=j;h=l;k=b[1];m=b[2];break;case "t":j=d+b[1];l=h+b[2];c[0].match(/[QqTt]/)===null?(k=d,m=h):c[0]==="t"?(k=2*d-v,m=2*h-E):c[0]==="q"&&(k=2*d-k,m=2*h-m);v=k;E=m;a.quadraticCurveTo(k+r,m+q,j+r,l+q);d=j;h=l;k=d+b[1];
m=h+b[2];break;case "T":j=b[1];l=b[2];k=2*d-k;m=2*h-m;a.quadraticCurveTo(k+r,m+q,j+r,l+q);d=j;h=l;break;case "a":f(a,d+r,h+q,[b[1],b[2],b[3],b[4],b[5],b[6]+d+r,b[7]+h+q]);d+=b[6];h+=b[7];break;case "A":f(a,d+r,h+q,[b[1],b[2],b[3],b[4],b[5],b[6]+r,b[7]+q]);d=b[6];h=b[7];break;case "z":case "Z":d=e,h=g,a.closePath()}c=b}this._renderFill(a);this._renderStroke(a)},render:function(b,c){this.visible&&(b.save(),this._setupCompositeOperation(b),c||this.transform(b),this._setStrokeStyles(b),this._setFillStyles(b),
this.group&&this.group.type==="path-group"&&b.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._setOpacity(b),this._setShadow(b),this.clipTo&&a.util.clipContext(this,b),this._render(b,c),this.clipTo&&b.restore(),this._removeShadow(b),this._restoreCompositeOperation(b),b.restore())},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=b(this.callSuper("toObject",
a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});if(this.sourcePath)a.sourcePath=this.sourcePath;if(this.transformMatrix)a.transformMatrix=this.transformMatrix;return a},toDatalessObject:function(a){a=this.toObject(a);if(this.sourcePath)a.path=this.sourcePath;delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),f="",e=0,g=this.path.length;e<g;e++)b.push(this.path[e].join(" "));b=b.join(" ");this.group&&this.group.type==="path-group"||
(f="translate("+-this.pathOffset.x+", "+-this.pathOffset.y+")");c.push("<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),f,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,f,e=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,g,d=0,j=this.path.length;d<j;d++){c=this.path[d];g=c.slice(1).trim();for(b.length=0;f=e.exec(g);)b.push(f[0]);
c=[c.charAt(0)];g=0;for(var l=b.length;g<l;g++)f=parseFloat(b[g]),isNaN(f)||c.push(f);f=c[0];g=h[f.toLowerCase()];l=m[f]||f;if(c.length-1>g)for(var z=1,A=c.length;z<A;z+=g)a.push([f].concat(c.slice(z,z+g))),f=l;else a.push(c)}return a},_parseDimensions:function(){for(var b=[],f=[],e,d=null,h=0,k=0,m=0,j=0,l=0,z=0,A,v,E,r,q,t=0,s=this.path.length;t<s;++t){e=this.path[t];switch(e[0]){case "l":m+=e[1];j+=e[2];q=[];break;case "L":m=e[1];j=e[2];q=[];break;case "h":m+=e[1];q=[];break;case "H":m=e[1];q=
[];break;case "v":j+=e[1];q=[];break;case "V":j=e[1];q=[];break;case "m":m+=e[1];j+=e[2];h=m;k=j;q=[];break;case "M":m=e[1];j=e[2];h=m;k=j;q=[];break;case "c":A=m+e[5];v=j+e[6];l=m+e[3];z=j+e[4];q=a.util.getBoundsOfCurve(m,j,m+e[1],j+e[2],l,z,A,v);m=A;j=v;break;case "C":m=e[5];j=e[6];l=e[3];z=e[4];q=a.util.getBoundsOfCurve(m,j,e[1],e[2],l,z,m,j);break;case "s":A=m+e[3];v=j+e[4];l=l?2*m-l:m;z=z?2*j-z:j;q=a.util.getBoundsOfCurve(m,j,l,z,m+e[1],j+e[2],A,v);l=m+e[1];z=j+e[2];m=A;j=v;break;case "S":A=
e[3];v=e[4];l=2*m-l;z=2*j-z;q=a.util.getBoundsOfCurve(m,j,l,z,e[1],e[2],A,v);m=A;j=v;l=e[1];z=e[2];break;case "q":A=m+e[3];v=j+e[4];l=m+e[1];z=j+e[2];q=a.util.getBoundsOfCurve(m,j,l,z,l,z,A,v);m=A;j=v;break;case "Q":l=e[1];z=e[2];q=a.util.getBoundsOfCurve(m,j,l,z,l,z,e[3],e[4]);m=e[3];j=e[4];break;case "t":A=m+e[1];v=j+e[2];d[0].match(/[QqTt]/)===null?(l=m,z=j):d[0]==="t"?(l=2*m-E,z=2*j-r):d[0]==="q"&&(l=2*m-l,z=2*j-z);E=l;r=z;q=a.util.getBoundsOfCurve(m,j,l,z,l,z,A,v);m=A;j=v;l=m+e[1];z=j+e[2];break;
case "T":A=e[1];v=e[2];l=2*m-l;z=2*j-z;q=a.util.getBoundsOfCurve(m,j,l,z,l,z,A,v);m=A;j=v;break;case "a":q=a.util.getBoundsOfArc(m,j,e[1],e[2],e[3],e[4],e[5],e[6]+m,e[7]+j);m+=e[6];j+=e[7];break;case "A":q=a.util.getBoundsOfArc(m,j,e[1],e[2],e[3],e[4],e[5],e[6],e[7]);m=e[6];j=e[7];break;case "z":case "Z":m=h,j=k}d=e;q.forEach(function(a){b.push(a.x);f.push(a.y)});b.push(m);f.push(j)}e=g(b);d=g(f);h=c(b);k=c(f);return{left:e,top:d,width:h-e,height:k-d}}}),a.Path.fromObject=function(b,c){typeof b.path===
"string"?a.loadSVGFromURL(b.path,function(f){var f=f[0],e=b.path;delete b.path;a.util.object.extend(f,b);f.setSourcePath(e);c(f)}):c(new a.Path(b.path,b))},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),a.Path.fromElement=function(c,f,e){c=a.parseAttributes(c,a.Path.ATTRIBUTE_NAMES);f&&f(new a.Path(c.d,b(c,e)))},a.Path.async=!0)})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend,c=a.util.array.invoke,b=a.Object.prototype.toObject;a.PathGroup?
a.warn("fabric.PathGroup is already defined"):(a.PathGroup=a.util.createClass(a.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(b);if(b.widthAttr)this.scaleX=b.widthAttr/b.width;if(b.heightAttr)this.scaleY=b.heightAttr/b.height;this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},render:function(b){if(this.visible){b.save();var c=this.transformMatrix;c&&b.transform(c[0],c[1],c[2],
c[3],c[4],c[5]);this.transform(b);this._setShadow(b);this.clipTo&&a.util.clipContext(this,b);for(var c=0,g=this.paths.length;c<g;++c)this.paths[c].render(b,!0);this.clipTo&&b.restore();this._removeShadow(b);b.restore()}},_set:function(a,b){if(a==="fill"&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){a=g(b.call(this,a),{paths:c(this.getObjects(),"toObject",a)});if(this.sourcePath)a.sourcePath=this.sourcePath;return a},
toDatalessObject:function(a){a=this.toObject(a);if(this.sourcePath)a.paths=this.sourcePath;return a},toSVG:function(a){for(var b=this.getObjects(),c="translate("+this.left+" "+this.top+")",c=["<g ",'style="',this.getSvgStyles(),'" ','transform="',c,this.getSvgTransform(),'" ',">\n"],g=0,d=b.length;g<d;g++)c.push(b[g].toSVG(a));c.push("</g>\n");return a?a(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=
(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),a.PathGroup.fromObject=function(b,c){typeof b.paths==="string"?a.loadSVGFromURL(b.paths,function(g){var d=b.paths;delete b.paths;g=a.util.groupSVGElements(g,b,d);c(g)}):a.util.enlivenObjects(b.paths,function(g){delete b.paths;
c(new a.PathGroup(g,b))})},a.PathGroup.async=!0)})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,e=a.util.array.invoke;if(!a.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(var c=this._objects.length;c--;)this._objects[c].group=
this;this.originalState={};this.callSuper("initialize");if(b.originX)this.originX=b.originX;if(b.originY)this.originY=b.originY;this._calcBounds();this._updateObjectsCoords();b&&g(this,b);this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop(),f=this.getCenterPoint();a.set({originalLeft:b,originalTop:c,left:b-f.x,top:c-f.y});a.setCoords();a.__origHasControls=a.hasControls;
a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();if(a)this._objects.push(a),a.group=this;this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();
this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var c=this._objects.length;for(this[a]=b;c--;)this._objects[c].set(a,b)}else this[a]=b},toObject:function(a){return g(this.callSuper("toObject",
a),{objects:e(this._objects,"toObject",a)})},render:function(b){if(this.visible){b.save();this.clipTo&&a.util.clipContext(this,b);for(var c=0,f=this._objects.length;c<f;c++)this._renderObject(this._objects[c],b);this.clipTo&&b.restore();b.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,f=this._objects.length;c<f;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){var c=a.hasRotatingPoint;if(a.visible)a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=
c},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_moveFlippedObject:function(a){var b=a.get("originX"),c=a.get("originY"),f=a.getCenterPoint();a.set({originX:"center",originY:"center",left:f.x,top:f.y});this._toggleFlipping(a);f=a.getPointByOrigin(b,c);a.set({originX:b,originY:c,left:f.x,top:f.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),
a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getCenterPoint(),c=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b.x+c.left,top:b.y+c.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=
this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==
this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_calcBounds:function(a){for(var b=[],c=[],f,e=0,g=this._objects.length;e<g;++e){f=this._objects[e];f.setCoords();for(var d in f.oCoords)b.push(f.oCoords[d].x),c.push(f.oCoords[d].y)}this.set(this._getBounds(b,c,a))},_getBounds:function(f,e,g){var d=a.util.invertTransform(this.getViewportTransform()),h=a.util.transformPoint(new a.Point(c(f),c(e)),d),f=a.util.transformPoint(new a.Point(b(f),b(e)),
d),f={width:f.x-h.x||0,height:f.y-h.y||0};if(!g)f.left=h.x||0,f.top=h.y||0,this.originX==="center"&&(f.left+=f.width/2),this.originX==="right"&&(f.left+=f.width),this.originY==="center"&&(f.top+=f.height/2),this.originY==="bottom"&&(f.top+=f.height);return f},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,f=this._objects.length;c<f;c++)b.push(this._objects[c].toSVG(a));b.push("</g>\n");return a?a(b.join("")):b.join("")},get:function(a){if(a in f)if(this[a])return this[a];
else{for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}else return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});a.Group.fromObject=function(b,c){a.util.enlivenObjects(b.objects,function(f){delete b.objects;c&&c(new a.Group(f,b))})};a.Group.async=!0}})(typeof j!=="undefined"?j:this);(function(d){var a=h.util.object.extend;if(!d.fabric)d.fabric={};d.fabric.Image?h.warn("fabric.Image is already defined."):(h.Image=h.util.createClass(h.Object,
{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(a,c){c||(c={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",c);this._initElement(a,c);this._initConfig(c);if(c.filters)this.filters=c.filters,this.applyFilters()},getElement:function(){return this._element},setElement:function(a,c,b){this._originalElement=this._element=a;this._initConfig(b);this.filters.length!==0?this.applyFilters(c):c&&c();return this},
setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(a){var c=-this.width/2,b=-this.height/2,e=this.width,f=this.height;a.save();this._setStrokeStyles(a);a.beginPath();h.util.drawDashedLine(a,
c,b,c+e,b,this.strokeDashArray);h.util.drawDashedLine(a,c+e,b,c+e,b+f,this.strokeDashArray);h.util.drawDashedLine(a,c+e,b+f,c,b+f,this.strokeDashArray);h.util.drawDashedLine(a,c,b+f,c,b,this.strokeDashArray);a.closePath();a.restore()},toObject:function(g){return a(this.callSuper("toObject",g),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(a){return a&&a.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},
toSVG:function(a){var c=[],b=-this.width/2,e=-this.height/2,f="none";if(this.group&&this.group.type==="path-group")b=this.left,e=this.top;this.alignX!=="none"&&this.alignY!=="none"&&(f="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);c.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',b,'" y="',e,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',f,'"',"></image>\n");
if(this.stroke||this.strokeDashArray)f=this.fill,this.fill=null,c.push("<rect ",'x="',b,'" y="',e,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f;c.push("</g>\n");return a?a(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(a,c,b){h.util.loadImage(a,function(a){return this.setElement(a,c,b)},this,b&&b.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+
this.getSrc()+'" }>'},clone:function(a,c){this.constructor.fromObject(this.toObject(c),a)},applyFilters:function(a,c,b,e){c=c||this.filters;if(b=b||this._originalElement){var f=b,d=h.util.createCanvasElement(),m=h.util.createImage(),o=this;d.width=f.width;d.height=f.height;d.getContext("2d").drawImage(f,0,0,f.width,f.height);if(c.length===0)return this._element=b,a&&a(),d;c.forEach(function(a){a&&a.applyTo(d,a.scaleX||o.scaleX,a.scaleY||o.scaleY);!e&&a.type==="Resize"&&(o.width*=a.scaleX,o.height*=
a.scaleY)});m.width=d.width;m.height=d.height;h.isLikelyNode?(m.src=d.toBuffer(u,h.Image.pngCompression),o._element=m,!e&&(o._filteredEl=m),a&&a()):(m.onload=function(){o._element=m;!e&&(o._filteredEl=m);a&&a();m.onload=d=f=null},m.src=d.toDataURL("image/png"));return d}},_render:function(a,c){var b,e,f=this._findMargins(),d;b=c?this.left:-this.width/2;e=c?this.top:-this.height/2;this.meetOrSlice==="slice"&&(a.beginPath(),a.rect(b,e,this.width,this.height),a.clip());this.isMoving===!1&&this.resizeFilters.length&&
this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,d=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!1)):d=this._element;d&&a.drawImage(d,b+f.marginX,e+f.marginY,f.width,f.height);this._renderStroke(a)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var a=this.width,c=this.height,b=0,e=0;if(this.alignX!=="none"||this.alignY!=="none")a=[this.width/this._element.width,
this.height/this._element.height],c=this.meetOrSlice==="meet"?Math.min.apply(null,a):Math.max.apply(null,a),a=this._element.width*c,c*=this._element.height,this.alignX==="Mid"&&(b=(this.width-a)/2),this.alignX==="Max"&&(b=this.width-a),this.alignY==="Mid"&&(e=(this.height-c)/2),this.alignY==="Max"&&(e=this.height-c);return{width:a,height:c,marginX:b,marginY:e}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(h.util.getById(a));
h.util.addClass(this.getElement(),h.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a);if(this._element&&this.crossOrigin)this._element.crossOrigin=this.crossOrigin},_initFilters:function(a,c){a.filters&&a.filters.length?h.util.enlivenObjects(a.filters,function(a){c&&c(a)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0;this.height="height"in a?a.height:this.getElement()?
this.getElement().height||0:0},complexity:function(){return 1}}),h.Image.CSS_CANVAS="canvas-img",h.Image.prototype.getSvgSrc=h.Image.prototype.getSrc,h.Image.fromObject=function(a,c){h.util.loadImage(a.src,function(b){h.Image.prototype._initFilters.call(a,a,function(e){a.filters=e||[];e=new h.Image(b,a);c&&c(e)})},null,a.crossOrigin)},h.Image.fromURL=function(a,c,b){h.util.loadImage(a,function(a){c(new h.Image(a,b))},null,b&&b.crossOrigin)},h.Image.ATTRIBUTE_NAMES=h.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),
h.Image.fromElement=function(d,c,b){var d=h.parseAttributes(d,h.Image.ATTRIBUTE_NAMES),e="xMidYMid",f="meet",k;d.preserveAspectRatio&&(k=d.preserveAspectRatio.split(" "));k&&k.length&&(f=k.pop(),f!=="meet"&&f!=="slice"?(e=f,f="meet"):k.length&&(e=k.pop()));k=e!=="none"?e.slice(1,4):"none";e=e!=="none"?e.slice(5,8):"none";d.alignX=k;d.alignY=e;d.meetOrSlice=f;h.Image.fromURL(d["xlink:href"],c,a(b?h.util.object.clone(b):{},d))},h.Image.async=!0,h.Image.pngCompression=1)})(typeof j!=="undefined"?j:this);
h.util.object.extend(h.Object.prototype,{_getAngleValueForStraighten:function(){var d=this.getAngle()%360;return d>0?Math.round((d-1)/90)*90:Math.round(d/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(d){var d=d||{},a=function(){},g=d.onComplete||a,c=d.onChange||a,b=this;h.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){b.setAngle(a);c()},onComplete:function(){b.setCoords();
g()},onStart:function(){b.set("active",!1)}});return this}});h.util.object.extend(h.StaticCanvas.prototype,{straightenObject:function(d){d.straighten();this.renderAll();return this},fxStraightenObject:function(d){d.fxStraighten({onChange:this.renderAll.bind(this)});return this}});h.Image.filters=h.Image.filters||{};h.Image.filters.BaseFilter=h.util.createClass({type:"BaseFilter",initialize:function(d){d&&this.setOptions(d)},setOptions:function(d){for(var a in d)this[a]=d[a]},toObject:function(){return{type:this.type}},
toJSON:function(){return this.toObject()}});(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Image.filters.Brightness=a.util.createClass(a.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||0},applyTo:function(a){for(var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),e=a.data,f=this.brightness,d=0,g=e.length;d<g;d+=4)e[d]+=f,e[d+1]+=f,e[d+2]+=f;b.putImageData(a,0,0)},toObject:function(){return g(this.callSuper("toObject"),
{brightness:this.brightness})}});a.Image.filters.Brightness.fromObject=function(c){return new a.Image.filters.Brightness(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Image.filters.Convolute=a.util.createClass(a.Image.filters.BaseFilter,{type:"Convolute",initialize:function(c){c=c||{};this.opaque=c.opaque;this.matrix=c.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=a.util.createCanvasElement().getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,
b)},applyTo:function(a){for(var b=this.matrix,e=a.getContext("2d"),f=e.getImageData(0,0,a.width,a.height),a=Math.round(Math.sqrt(b.length)),d=Math.floor(a/2),g=f.data,h=f.width,f=f.height,i=this._createImageData(h,f),j=i.data,p=this.opaque?1:0,l=0;l<f;l++)for(var w=0;w<h;w++){for(var C=l,s=w,D=(l*h+w)*4,z=0,A=0,v=0,E=0,r=0;r<a;r++)for(var q=0;q<a;q++){var t=C+r-d,u=s+q-d;t<0||t>f||u<0||u>h||(t=(t*h+u)*4,u=b[r*a+q],z+=g[t]*u,A+=g[t+1]*u,v+=g[t+2]*u,E+=g[t+3]*u)}j[D]=z;j[D+1]=A;j[D+2]=v;j[D+3]=E+p*
(255-E)}e.putImageData(i,0,0)},toObject:function(){return g(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});a.Image.filters.Convolute.fromObject=function(c){return new a.Image.filters.Convolute(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Image.filters.GradientTransparency=a.util.createClass(a.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){for(var b=
a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),e=a.data,f=this.threshold,d=e.length,g=0,h=e.length;g<h;g+=4)e[g+3]=f+255*(d-g)/d;b.putImageData(a,0,0)},toObject:function(){return g(this.callSuper("toObject"),{threshold:this.threshold})}});a.Image.filters.GradientTransparency.fromObject=function(c){return new a.Image.filters.GradientTransparency(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Grayscale=a.util.createClass(a.Image.filters.BaseFilter,
{type:"Grayscale",applyTo:function(a){for(var c=a.getContext("2d"),a=c.getImageData(0,0,a.width,a.height),b=a.data,e=a.width*a.height*4,f=0,d;f<e;)d=(b[f]+b[f+1]+b[f+2])/3,b[f]=d,b[f+1]=d,b[f+2]=d,f+=4;c.putImageData(a,0,0)}});a.Image.filters.Grayscale.fromObject=function(){return new a.Image.filters.Grayscale}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Invert=a.util.createClass(a.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var c=a.getContext("2d"),
a=c.getImageData(0,0,a.width,a.height),b=a.data,e=b.length,f;for(f=0;f<e;f+=4)b[f]=255-b[f],b[f+1]=255-b[f+1],b[f+2]=255-b[f+2];c.putImageData(a,0,0)}});a.Image.filters.Invert.fromObject=function(){return new a.Image.filters.Invert}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Image.filters.Mask=a.util.createClass(a.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=[0,1,2,3].indexOf(a.channel)>
-1?a.channel:0},applyTo:function(c){if(this.mask){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),e=c.data,f=this.mask.getElement(),d=a.util.createCanvasElement(),g=this.channel,h=c.width*c.height*4;d.width=f.width;d.height=f.height;d.getContext("2d").drawImage(f,0,0,f.width,f.height);d=d.getContext("2d").getImageData(0,0,f.width,f.height).data;for(f=0;f<h;f+=4)e[f+3]=d[f+g];b.putImageData(c,0,0)}},toObject:function(){return g(this.callSuper("toObject"),{mask:this.mask.toObject(),
channel:this.channel})}});a.Image.filters.Mask.fromObject=function(c,b){a.util.loadImage(c.mask.src,function(e){c.mask=new a.Image(e,c.mask);b&&b(new a.Image.filters.Mask(c))})};a.Image.filters.Mask.async=!0})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Image.filters.Noise=a.util.createClass(a.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(a){for(var b=a.getContext("2d"),a=b.getImageData(0,
0,a.width,a.height),e=a.data,f=this.noise,d,g=0,h=e.length;g<h;g+=4)d=(0.5-Math.random())*f,e[g]+=d,e[g+1]+=d,e[g+2]+=d;b.putImageData(a,0,0)},toObject:function(){return g(this.callSuper("toObject"),{noise:this.noise})}});a.Image.filters.Noise.fromObject=function(c){return new a.Image.filters.Noise(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Image.filters.Pixelate=a.util.createClass(a.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=
a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),e=a.data,f=a.height,d=a.width,g,h,i,j,p,l,w;for(h=0;h<f;h+=this.blocksize)for(i=0;i<d;i+=this.blocksize){g=h*4*d+i*4;j=e[g];p=e[g+1];l=e[g+2];w=e[g+3];for(var C=h,s=h+this.blocksize;C<s;C++)for(var D=i,z=i+this.blocksize;D<z;D++)g=C*4*d+D*4,e[g]=j,e[g+1]=p,e[g+2]=l,e[g+3]=w}b.putImageData(a,0,0)},toObject:function(){return g(this.callSuper("toObject"),{blocksize:this.blocksize})}});
a.Image.filters.Pixelate.fromObject=function(c){return new a.Image.filters.Pixelate(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Image.filters.RemoveWhite=a.util.createClass(a.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){for(var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),e=a.data,f=this.distance,d=255-this.threshold,
g=Math.abs,h,i,j,p=0,l=e.length;p<l;p+=4)h=e[p],i=e[p+1],j=e[p+2],h>d&&i>d&&j>d&&g(h-i)<f&&g(h-j)<f&&g(i-j)<f&&(e[p+3]=1);b.putImageData(a,0,0)},toObject:function(){return g(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});a.Image.filters.RemoveWhite.fromObject=function(c){return new a.Image.filters.RemoveWhite(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Sepia=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia",
applyTo:function(a){var c=a.getContext("2d"),a=c.getImageData(0,0,a.width,a.height),b=a.data,e=b.length,f,d;for(f=0;f<e;f+=4)d=0.3*b[f]+0.59*b[f+1]+0.11*b[f+2],b[f]=d+100,b[f+1]=d+50,b[f+2]=d+255;c.putImageData(a,0,0)}});a.Image.filters.Sepia.fromObject=function(){return new a.Image.filters.Sepia}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Sepia2=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var c=a.getContext("2d"),
a=c.getImageData(0,0,a.width,a.height),b=a.data,e=b.length,f,d,h,j;for(f=0;f<e;f+=4)d=b[f],h=b[f+1],j=b[f+2],b[f]=(d*0.393+h*0.769+j*0.189)/1.351,b[f+1]=(d*0.349+h*0.686+j*0.168)/1.203,b[f+2]=(d*0.272+h*0.534+j*0.131)/2.14;c.putImageData(a,0,0)}});a.Image.filters.Sepia2.fromObject=function(){return new a.Image.filters.Sepia2}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Image.filters.Tint=a.util.createClass(a.Image.filters.BaseFilter,{type:"Tint",
initialize:function(c){c=c||{};this.color=c.color||"#000000";this.opacity=typeof c.opacity!=="undefined"?c.opacity:(new a.Color(this.color)).getAlpha()},applyTo:function(c){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),e=c.data,f=e.length,d,g,h,i,j,p,l,w;d=(new a.Color(this.color)).getSource();g=d[0]*this.opacity;h=d[1]*this.opacity;i=d[2]*this.opacity;w=1-this.opacity;for(d=0;d<f;d+=4)j=e[d],p=e[d+1],l=e[d+2],e[d]=g+j*w,e[d+1]=h+p*w,e[d+2]=i+l*w;b.putImageData(c,0,0)},toObject:function(){return g(this.callSuper("toObject"),
{color:this.color,opacity:this.opacity})}});a.Image.filters.Tint.fromObject=function(c){return new a.Image.filters.Tint(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend;a.Image.filters.Multiply=a.util.createClass(a.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{};this.color=a.color||"#000000"},applyTo:function(c){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),e=c.data,f=e.length,d,g;g=(new a.Color(this.color)).getSource();
for(d=0;d<f;d+=4)e[d]*=g[0]/255,e[d+1]*=g[1]/255,e[d+2]*=g[2]/255;b.putImageData(c,0,0)},toObject:function(){return g(this.callSuper("toObject"),{color:this.color})}});a.Image.filters.Multiply.fromObject=function(c){return new a.Image.filters.Multiply(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric;a.Image.filters.Blend=a.util.createClass({type:"Blend",initialize:function(a){a=a||{};this.color=a.color||"#000";this.image=a.image||!1;this.mode=a.mode||"multiply";this.alpha=a.alpha||
1},applyTo:function(d){var c=d.getContext("2d"),d=c.getImageData(0,0,d.width,d.height),b=d.data,e,f,h,m,j,i,n,p=!1;this.image?(p=!0,n=a.util.createCanvasElement(),n.width=this.image.width,n.height=this.image.height,n=new a.StaticCanvas(n),n.add(this.image),n=n.getContext("2d").getImageData(0,0,n.width,n.height).data):(n=(new a.Color(this.color)).getSource(),e=n[0]*this.alpha,f=n[1]*this.alpha,h=n[2]*this.alpha);for(var l=0,w=b.length;l<w;l+=4)switch(m=b[l],j=b[l+1],i=b[l+2],p&&(e=n[l]*this.alpha,
f=n[l+1]*this.alpha,h=n[l+2]*this.alpha),this.mode){case "multiply":b[l]=m*e/255;b[l+1]=j*f/255;b[l+2]=i*h/255;break;case "screen":b[l]=1-(1-m)*(1-e);b[l+1]=1-(1-j)*(1-f);b[l+2]=1-(1-i)*(1-h);break;case "add":b[l]=Math.min(255,m+e);b[l+1]=Math.min(255,j+f);b[l+2]=Math.min(255,i+h);break;case "diff":case "difference":b[l]=Math.abs(m-e);b[l+1]=Math.abs(j-f);b[l+2]=Math.abs(i-h);break;case "subtract":m-=e;j-=f;i-=h;b[l]=m<0?0:m;b[l+1]=j<0?0:j;b[l+2]=i<0?0:i;break;case "darken":b[l]=Math.min(m,e);b[l+
1]=Math.min(j,f);b[l+2]=Math.min(i,h);break;case "lighten":b[l]=Math.max(m,e),b[l+1]=Math.max(j,f),b[l+2]=Math.max(i,h)}c.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});a.Image.filters.Blend.fromObject=function(d){return new a.Image.filters.Blend(d)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=Math.pow,c=Math.floor,b=Math.sqrt,e=Math.abs,f=Math.max,h=Math.round,m=Math.sin,j=Math.ceil;a.Image.filters.Resize=
a.util.createClass(a.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){this.rcpScaleX=1/b;this.rcpScaleY=1/c;var f=a.width,e=a.height,b=h(f*b),c=h(e*c),d;this.resizeType==="sliceHack"&&(d=this.sliceByTwo(a,f,e,b,c));this.resizeType==="hermite"&&(d=this.hermiteFastResize(a,f,e,b,c));this.resizeType==="bilinear"&&(d=this.bilinearFiltering(a,f,e,b,c));this.resizeType==="lanczos"&&(d=this.lanczosResize(a,f,e,b,c));a.width=b;a.height=
c;a.getContext("2d").putImageData(d,0,0)},sliceByTwo:function(b,e,d,g,h){var k=b.getContext("2d"),m,j=0.5,o=0.5,l=1,v=1,s=!1,r=!1,q=e,t=d,u=a.util.createCanvasElement(),x=u.getContext("2d"),g=c(g),h=c(h);u.width=f(g,e);u.height=f(h,d);g>e&&(j=2,l=-1);h>d&&(o=2,v=-1);m=k.getImageData(0,0,e,d);b.width=f(g,e);b.height=f(h,d);for(k.putImageData(m,0,0);!s||!r;)e=q,d=t,g*l<c(q*j*l)?q=c(q*j):(q=g,s=!0),h*v<c(t*o*v)?t=c(t*o):(t=h,r=!0),m=k.getImageData(0,0,e,d),x.putImageData(m,0,0),k.clearRect(0,0,q,t),
k.drawImage(u,0,0,e,d,0,0,q,t);return k.getImageData(0,0,g,h)},lanczosResize:function(a,f,d,h,k){var l,s,u,z;function A(a){var i,m,j,o,v,R,S,T,U,L;u=(a+0.5)*B;l=c(u);for(i=0;i<k;i++){z=(i+0.5)*x;s=c(z);v=0;R=0;S=0;T=0;U=0;for(m=l-K;m<=l+K;m++)if(!(m<0||m>=f)){L=c(1E3*e(m-u));I[L]||(I[L]={});for(var M=s-N;M<=s+N;M++)M<0||M>=d||(j=c(1E3*e(M-z)),I[L][j]||(I[L][j]=t(b(g(L*G,2)+g(j*H,2))/1E3)),j=I[L][j],j>0&&(o=(M*f+m)*4,v+=j,R+=j*r[o],S+=j*r[o+1],T+=j*r[o+2],U+=j*r[o+3]))}o=(i*h+a)*4;q[o]=R/v;q[o+1]=
S/v;q[o+2]=T/v;q[o+3]=U/v}return++a<h?A(a):E}var a=a.getContext("2d"),v=a.getImageData(0,0,f,d),E=a.getImageData(0,0,h,k),r=v.data,q=E.data,t=function(a){return function(b){if(b>a)return 0;b*=Math.PI;if(e(b)<1.0E-16)return 1;var c=b/a;return m(b)*m(c)/b/c}}(this.lanczosLobes),B=this.rcpScaleX,x=this.rcpScaleY,G=2/this.rcpScaleX,H=2/this.rcpScaleY,K=j(B*this.lanczosLobes/2),N=j(x*this.lanczosLobes/2),I={};u=void 0;z=void 0;l=void 0;s=void 0;return A(0)},bilinearFiltering:function(a,b,f,e,d){var g,
h,k,m,j,o,l,r,q,t,s=0,u=this.rcpScaleX,B=this.rcpScaleY;l=a.getContext("2d");var a=4*(b-1),f=l.getImageData(0,0,b,f).data,H=l.getImageData(0,0,e,d),K=H.data;for(l=0;l<d;l++)for(r=0;r<e;r++){j=c(u*r);o=c(B*l);q=u*r-j;t=B*l-o;o=4*(o*b+j);for(j=0;j<4;j++)g=f[o+j],h=f[o+4+j],k=f[o+a+j],m=f[o+a+4+j],g=g*(1-q)*(1-t)+h*q*(1-t)+k*t*(1-q)+m*q*t,K[s++]=g}return H},hermiteFastResize:function(a,f,d,g,h){for(var k=this.rcpScaleX,m=this.rcpScaleY,l=j(k/2),u=j(m/2),a=a.getContext("2d"),d=a.getImageData(0,0,f,d).data,
a=a.getImageData(0,0,g,h),s=a.data,v=0;v<h;v++)for(var B=0;B<g;B++){for(var r=(B+v*g)*4,q=0,t=0,F=0,x=0,G=0,H=0,K=0,N=(v+0.5)*m,I=c(v*m);I<(v+1)*m;I++){var Q=e(N-(I+0.5))/u,V=(B+0.5)*k;Q*=Q;for(var O=c(B*k);O<(B+1)*k;O++){var J=e(V-(O+0.5))/l,q=b(Q+J*J);q>1&&q<-1||(q=2*q*q*q-3*q*q+1,q>0&&(J=4*(O+I*f),K+=q*d[J+3],F+=q,d[J+3]<255&&(q=q*d[J+3]/250),x+=q*d[J],G+=q*d[J+1],H+=q*d[J+2],t+=q))}}s[r]=x/t;s[r+1]=G/t;s[r+2]=H/t;s[r+3]=K/F}return a}});a.Image.filters.Resize.fromObject=function(){return new a.Image.filters.Resize}})(typeof j!==
"undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),g=a.util.object.extend,c=a.util.object.clone,b=a.util.toFixed,e=a.StaticCanvas.supports("setLineDash");a.Text?a.warn("fabric.Text is already defined"):(d=a.Object.prototype.stateProperties.concat(),d.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,
textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:d,stroke:null,shadow:null,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(){this.__skipDimension||
this._render(a.util.createCanvasElement().getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){typeof Cufon==="undefined"||this.useNative===!0?this._renderViaNative(a):this._renderViaCufon(a)},_renderViaNative:function(b){var c=this.text.split(this._reNewline);this._setTextStyles(b);this.width=this._getTextWidth(b,c);this.height=this._getTextHeight(b,c);this.clipTo&&a.util.clipContext(this,
b);this._renderTextBackground(b,c);this._translateForTextAlign(b);this._renderText(b,c);this.textAlign!=="left"&&this.textAlign!=="justify"&&b.restore();this._renderTextDecoration(b,c);this.clipTo&&b.restore();this._setBoundaries(b,c);this._totalLineHeight=0},_renderText:function(a,b){a.save();this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a,b);this._renderTextStroke(a,b);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){this.textAlign!==
"left"&&this.textAlign!=="justify"&&(a.save(),a.translate(this.textAlign==="center"?this.width/2:this.width,0))},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,e=b.length;c<e;c++){var d=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(d);this._boundaries.push({height:this.fontSize*this.lineHeight,width:d,left:g})}},_setTextStyles:function(a){this._setFillStyles(a);this._setStrokeStyles(a);a.textBaseline="alphabetic";if(!this.skipTextAlign)a.textAlign=this.textAlign;a.font=this._getFontDeclaration()},
_getTextHeight:function(a,b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,e=1,d=b.length;e<d;e++){var g=a.measureText(b[e]).width;g>c&&(c=g)}return c},_renderChars:function(a,b,c,e,d){b[a](c,e,d)},_renderTextLine:function(a,b,c,e,d,g){d-=this.fontSize/4;if(this.textAlign!=="justify")this._renderChars(a,b,c,e,d,g);else{var h=b.measureText(c).width,j=this.width;if(j>h)for(var h=c.split(/\s+/),c=b.measureText(c.replace(/\s+/g,"")).width,
j=(j-c)/(h.length-1),l=c=0,s=h.length;l<s;l++)this._renderChars(a,b,h[l],e+c,d,g),c+=b.measureText(h[l]).width+j;else this._renderChars(a,b,c,e,d,g)}},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a,b){if(this.fill||this._skipFillStrokeCheck){this._boundaries=[];for(var c=0,e=0,d=b.length;e<d;e++){var g=this._getHeightOfLine(a,e,b);c+=g;this._renderTextLine("fillText",a,b[e],this._getLeftOffset(),this._getTopOffset()+c,e)}this.shadow&&
!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a,b){if(this.stroke&&this.strokeWidth!==0||this._skipFillStrokeCheck){var c=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var d=0,g=b.length;d<g;d++){var h=this._getHeightOfLine(a,d,b);c+=h;this._renderTextLine("strokeText",a,b[d],this._getLeftOffset(),this._getTopOffset()+
c,d)}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){if(this.backgroundColor)a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore()},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;
for(var c=0,e=b.length;c<e;c++)if(b[c]!==""){var d=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(d);a.fillRect(this._getLeftOffset()+g,this._getTopOffset()+c*this.fontSize*this.lineHeight,d,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return this.textAlign==="center"?(this.width-a)/2:this.textAlign==="right"?this.width-a:0},_getLineWidth:function(a,b){return this.textAlign==="justify"?this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(g){for(var h=
0,j=b.length;h<j;h++){var m=d._getLineWidth(a,b[h]),l=d._getLineLeftOffset(m);a.fillRect(d._getLeftOffset()+l,~~(g+h*d._getHeightOfLine(a,h,b)-e),m,1)}}if(this.textDecoration){var e=this._getTextHeight(a,b)/2,d=this;this.textDecoration.indexOf("underline")>-1&&c(this.fontSize*this.lineHeight);this.textDecoration.indexOf("line-through")>-1&&c(this.fontSize*this.lineHeight-this.fontSize/2);this.textDecoration.indexOf("overline")>-1&&c(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[a.isLikelyNode?
this.fontWeight:this.fontStyle,a.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",a.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){if(this.visible){a.save();b||this.transform(a);var c=this.group&&this.group.type==="path-group";c&&a.translate(-this.group.width/2,-this.group.height/2);this.transformMatrix&&a.transform.apply(a,this.transformMatrix);c&&a.translate(this.left,this.top);this._render(a);a.restore()}},toObject:function(a){a=g(this.callSuper("toObject",
a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=[],c=this.text.split(this._reNewline),e=this._getSVGLeftTopOffsets(c),d=this._getSVGTextAndBg(e.lineTop,e.textLeft,c),
c=this._getSVGShadows(e.lineTop,c);e.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;this._wrapSVGTextAndBg(b,d,c,e);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){return{textLeft:-(this.width/2)+(this.group&&this.group.type==="path-group"?this.left:0),textTop:(this.useNative?this.fontSize*this.lineHeight-0.25*this.fontSize:this.height/2-a.length*this.fontSize-this._totalLineHeight)+(this.group&&this.group.type==="path-group"?this.top:0),lineTop:this.useNative?
this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight}},_wrapSVGTextAndBg:function(a,c,e,d){a.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',c.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+
this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',b(d.textLeft,2)," ",b(d.textTop,2),')">',e.join(""),c.textSpans.join(""),"</text>\n","</g>\n")},_getSVGShadows:function(c,e){var d=[],g,h,j=1;if(!this.shadow||!this._boundaries)return d;for(g=0,h=e.length;g<h;g++)e[g]!==""?(d.push('<tspan x="',b((this._boundaries&&this._boundaries[g]?this._boundaries[g].left:0)+j+this.shadow.offsetX,2),g===0||this.useNative?'" y':'" dy','="',b(this.useNative?c*g-this.height/2+this.shadow.offsetY:
c+(g===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",a.util.string.escapeXml(e[g]),"</tspan>"),j=1):j++;return d},_getSVGTextAndBg:function(a,b,c){var e=[],d=[],g=1;this._setSVGBg(d);for(var h=0,j=c.length;h<j;h++)c[h]!==""?(this._setSVGTextLineText(c[h],h,e,a,g,d),g=1):g++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(d,h,b,a);return{textSpans:e,textBgRects:d}},_setSVGTextLineText:function(c,e,d,g,h){var j=this._boundaries&&this._boundaries[e]?
b(this._boundaries[e].left,2):0;d.push('<tspan x="',j,'" ',e===0||this.useNative?"y":"dy",'="',b(this.useNative?g*e-this.height/2:g*h,2),'" ',this._getFillAttributes(this.fill),">",a.util.string.escapeXml(c),"</tspan>")},_setSVGTextLineBg:function(a,c,e,d){a.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',b(e+this._boundaries[c].left,2),'" y="',b(d*c-this.height/2,2),'" width="',b(this._boundaries[c].width,2),'" height="',b(this._boundaries[c].height,2),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&
this._boundaries&&a.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',b(-this.width/2,2),'" y="',b(-this.height/2,2),'" width="',b(this.width,2),'" height="',b(this.height,2),'"></rect>')},_getFillAttributes:function(b){var c=b&&typeof b==="string"?new a.Color(b):"";return!c||!c.getSource()||c.getAlpha()===1?'fill="'+b+'"':'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"'},_set:function(a,b){if(a==="fontFamily"&&this.path)this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,
"$1"+b+"$3");this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(b,c){if(!b)return null;var e=a.parseAttributes(b,a.Text.ATTRIBUTE_NAMES),c=a.util.object.extend(c?a.util.object.clone(c):{},e);c.top=c.top||0;
c.left=c.left||0;"dx"in e&&(c.left+=e.dx);"dy"in e&&(c.top+=e.dy);if(!("fontSize"in c))c.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE;if(!c.originX)c.originX="left";c.top+=c.fontSize/4;var e=new a.Text(b.textContent,c),d=0;e.originX==="left"&&(d=e.getWidth()/2);e.originX==="right"&&(d=-e.getWidth()/2);e.set({left:e.getLeft()+d,top:e.getTop()-e.getHeight()/2});return e},a.Text.fromObject=function(b){return new a.Text(b.text,c(b))},a.util.createAccessors(a.Text))})(typeof j!=="undefined"?j:this);(function(){var d=
h.util.object.clone;h.IText=h.util.createClass(h.Text,h.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(a,d){this.styles=
d?d.styles||{}:{};this.callSuper("initialize",a,d);this.initBehavior();h.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var a=this.styles,d;for(d in a)for(var c in a[d])for(var b in a[d][c])return!1;return!0},setSelectionStart:function(a){this.selectionStart!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionStart=a;this.hiddenTextarea&&
(this.hiddenTextarea.selectionStart=a)},setSelectionEnd:function(a){this.selectionEnd!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionEnd=a;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=a)},getSelectionStyles:function(a,d){if(arguments.length===2){for(var c=[],b=a;b<d;b++)c.push(this.getSelectionStyles(b));return c}c=this.get2DCursorLocation(a);return this.styles[c.lineIndex]?this.styles[c.lineIndex][c.charIndex]||
{}:{}},setSelectionStyles:function(a){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,a);else for(var d=this.selectionStart;d<this.selectionEnd;d++)this._extendStyles(d,a);return this},_extendStyles:function(a,d){var c=this.get2DCursorLocation(a);this.styles[c.lineIndex]||(this.styles[c.lineIndex]={});this.styles[c.lineIndex][c.charIndex]||(this.styles[c.lineIndex][c.charIndex]={});h.util.object.extend(this.styles[c.lineIndex][c.charIndex],d)},_render:function(a){this.callSuper("_render",
a);this.ctx=a;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var a=this.text.split(""),d;this.selectionStart===this.selectionEnd?(d=this._getCursorBoundaries(a,"cursor"),this.renderCursor(d)):(d=this._getCursorBoundaries(a,"selection"),this.renderSelection(a,d))}},get2DCursorLocation:function(a){if(typeof a==="undefined")a=this.selectionStart;a=this.text.slice(0,a).split(this._reNewline);return{lineIndex:a.length-1,charIndex:a[a.length-1].length}},
getCurrentCharStyle:function(a,d){var c=this.styles[a]&&this.styles[a][d===0?0:d-1];return{fontSize:c&&c.fontSize||this.fontSize,fill:c&&c.fill||this.fill,textBackgroundColor:c&&c.textBackgroundColor||this.textBackgroundColor,textDecoration:c&&c.textDecoration||this.textDecoration,fontFamily:c&&c.fontFamily||this.fontFamily,fontWeight:c&&c.fontWeight||this.fontWeight,fontStyle:c&&c.fontStyle||this.fontStyle,stroke:c&&c.stroke||this.stroke,strokeWidth:c&&c.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(a,
d){return this.styles[a]&&this.styles[a][d===0?0:d-1]&&this.styles[a][d===0?0:d-1].fontSize||this.fontSize},getCurrentCharColor:function(a,d){return this.styles[a]&&this.styles[a][d===0?0:d-1]&&this.styles[a][d===0?0:d-1].fill||this.cursorColor},_getCursorBoundaries:function(a,d){var c=this.get2DCursorLocation(),b=this.text.split(this._reNewline),e=Math.round(this._getLeftOffset()),f=this._getTopOffset(),c=this._getCursorBoundariesOffsets(a,d,c,b);return{left:e,top:f,leftOffset:c.left+c.lineLeft,
topOffset:c.top}},_getCursorBoundariesOffsets:function(a,d,c,b){for(var e=0,f=0,h=0,j=0,c=d==="cursor"?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(c.lineIndex,c.charIndex):0,l=0;l<this.selectionStart;l++)a[l]==="\n"?(j=0,c+=this._getCachedLineHeight(f+(d==="cursor"?1:0)),f++,h=0):(j+=this._getWidthOfChar(this.ctx,a[l],f,h),h++),e=this._getCachedLineOffset(f,b);this._clearCache();return{top:c,left:j,lineLeft:e}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets=
{}},_getCachedLineHeight:function(a){return this.__lineHeights[a]||(this.__lineHeights[a]=this._getHeightOfLine(this.ctx,a))},_getCachedLineWidth:function(a,d){return this.__lineWidths[a]||(this.__lineWidths[a]=this._getWidthOfLine(this.ctx,a,d))},_getCachedLineOffset:function(a,d){var c=this._getCachedLineWidth(a,d);return this.__lineOffsets[a]||(this.__lineOffsets[a]=this._getLineLeftOffset(c))},renderCursor:function(a){var d=this.ctx;d.save();var c=this.get2DCursorLocation(),b=c.lineIndex,c=c.charIndex,
e=this.getCurrentCharFontSize(b,c),f=b===0&&c===0?this._getCachedLineOffset(b,this.text.split(this._reNewline)):a.leftOffset;d.fillStyle=this.getCurrentCharColor(b,c);d.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;d.fillRect(a.left+f,a.top+a.topOffset,this.cursorWidth/this.scaleX,e);d.restore()},renderSelection:function(a,d){var c=this.ctx;c.save();c.fillStyle=this.selectionColor;for(var b=this.get2DCursorLocation(this.selectionStart),e=this.get2DCursorLocation(this.selectionEnd),f=
b.lineIndex,h=e.lineIndex,j=this.text.split(this._reNewline),l=f;l<=h;l++){var i=this._getCachedLineOffset(l,j)||0,n=this._getCachedLineHeight(l),p=0;if(l===f)for(var y=0,w=j[l].length;y<w;y++){if(y>=b.charIndex&&(l!==h||y<e.charIndex))p+=this._getWidthOfChar(c,j[l][y],l,y);y<b.charIndex&&(i+=this._getWidthOfChar(c,j[l][y],l,y))}else if(l>f&&l<h)p+=this._getCachedLineWidth(l,j)||5;else if(l===h){y=0;for(w=e.charIndex;y<w;y++)p+=this._getWidthOfChar(c,j[l][y],l,y)}c.fillRect(d.left+i,d.top+d.topOffset,
p,n);d.topOffset+=n}c.restore()},_renderChars:function(a,d,c,b,e,f){if(this.isEmptyStyles())return this._renderCharsFast(a,d,c,b,e);this.skipTextAlign=!0;b-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var h=this.text.split(this._reNewline),j=this._getWidthOfLine(d,f,h),h=this._getHeightOfLine(d,f,h),l=this._getLineLeftOffset(j),c=c.split(""),i,j="";b+=l||0;d.save();for(var l=0,n=c.length;l<=n;l++){i=i||this.getCurrentCharStyle(f,l);var p=this.getCurrentCharStyle(f,
l+1);if(this._hasStyleChanged(i,p)||l===n)this._renderChar(a,d,f,l-1,j,b,e,h),j="",i=p;j+=c[l]}d.restore()},_renderCharsFast:function(a,d,c,b,e){this.skipTextAlign=!1;a==="fillText"&&this.fill&&this.callSuper("_renderChars",a,d,c,b,e);a==="strokeText"&&this.stroke&&this.callSuper("_renderChars",a,d,c,b,e)},_renderChar:function(a,d,c,b,e,f,h,j){var l;if(this.styles&&this.styles[c]&&(l=this.styles[c][b])){var i=l.stroke||this.stroke,n=l.fill||this.fill;d.save();a=this._applyCharStylesGetWidth(d,e,c,
b,l);c=this._getHeightOfChar(d,e,c,b);n&&d.fillText(e,f,h);i&&d.strokeText(e,f,h);this._renderCharDecoration(d,l,f,h,a,j,c);d.restore();d.translate(a,0)}else{if(a==="strokeText"&&this.stroke)d[a](e,f,h);if(a==="fillText"&&this.fill)d[a](e,f,h);a=this._applyCharStylesGetWidth(d,e,c,b);this._renderCharDecoration(d,null,f,h,a,j);d.translate(d.measureText(e).width,0)}},_hasStyleChanged:function(a,d){return a.fill!==d.fill||a.fontSize!==d.fontSize||a.textBackgroundColor!==d.textBackgroundColor||a.textDecoration!==
d.textDecoration||a.fontFamily!==d.fontFamily||a.fontWeight!==d.fontWeight||a.fontStyle!==d.fontStyle||a.stroke!==d.stroke||a.strokeWidth!==d.strokeWidth},_renderCharDecoration:function(a,d,c,b,e,f,h){var j=d?d.textDecoration||this.textDecoration:this.textDecoration,d=(d?d.fontSize:null)||this.fontSize;j&&(j.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(a,c,b+this.fontSize/this._fontSizeFraction,e,0,this.fontSize/20),j.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(a,
c,b+this.fontSize/this._fontSizeFraction,e,h/2,d/20),j.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(a,c,b,e,f-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(a,d,c,b,e,f){a.fillRect(d,c-e,b,f)},_renderTextLine:function(a,d,c,b,e,f){e+=this.fontSize/4;this.callSuper("_renderTextLine",a,d,c,b,e,f)},_renderTextDecoration:function(a,d){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",a,d)},_renderTextLinesBackground:function(a,
d){if(this.textBackgroundColor||this.styles){a.save();if(this.textBackgroundColor)a.fillStyle=this.textBackgroundColor;for(var c=0,b=this.fontSize/this._fontSizeFraction,e=0,f=d.length;e<f;e++){var h=this._getHeightOfLine(a,e,d);if(d[e]!==""){var j=this._getWidthOfLine(a,e,d),l=this._getLineLeftOffset(j);if(this.textBackgroundColor)a.fillStyle=this.textBackgroundColor,a.fillRect(this._getLeftOffset()+l,this._getTopOffset()+c+b,j,h);if(this.styles[e])for(var j=0,i=d[e].length;j<i;j++)if(this.styles[e]&&
this.styles[e][j]&&this.styles[e][j].textBackgroundColor){var n=d[e][j];a.fillStyle=this.styles[e][j].textBackgroundColor;a.fillRect(this._getLeftOffset()+l+this._getWidthOfCharsAt(a,e,j,d),this._getTopOffset()+c+b,this._getWidthOfChar(a,n,e,j,d)+1,h)}}c+=h}a.restore()}},_getCacheProp:function(a,d){return a+d.fontFamily+d.fontSize+d.fontWeight+d.fontStyle+d.shadow},_applyCharStylesGetWidth:function(a,g,c,b,e){var f;f=(c=e||this.styles[c]&&this.styles[c][b])?d(c):{},c=f;this._applyFontStyles(c);b=
this._getCacheProp(g,c);if(this.isEmptyStyles()&&this._charWidthsCache[b]&&this.caching)return this._charWidthsCache[b];if(typeof c.shadow==="string")c.shadow=new h.Shadow(c.shadow);e=c.fill||this.fill;a.fillStyle=e.toLive?e.toLive(a):e;if(c.stroke)a.strokeStyle=c.stroke&&c.stroke.toLive?c.stroke.toLive(a):c.stroke;a.lineWidth=c.strokeWidth||this.strokeWidth;a.font=this._getFontDeclaration.call(c);this._setShadow.call(c,a);if(!this.caching)return a.measureText(g).width;if(!this._charWidthsCache[b])this._charWidthsCache[b]=
a.measureText(g).width;return this._charWidthsCache[b]},_applyFontStyles:function(a){if(!a.fontFamily)a.fontFamily=this.fontFamily;if(!a.fontSize)a.fontSize=this.fontSize;if(!a.fontWeight)a.fontWeight=this.fontWeight;if(!a.fontStyle)a.fontStyle=this.fontStyle},_getStyleDeclaration:function(a,g){return this.styles[a]&&this.styles[a][g]?d(this.styles[a][g]):{}},_getWidthOfChar:function(a,d,c,b){if(this.textAlign==="justify"&&/\s/.test(d))return this._getWidthOfSpace(a,c);var e=this._getStyleDeclaration(c,
b);this._applyFontStyles(e);e=this._getCacheProp(d,e);if(this._charWidthsCache[e]&&this.caching)return this._charWidthsCache[e];else if(a)return a.save(),d=this._applyCharStylesGetWidth(a,d,c,b),a.restore(),d},_getHeightOfChar:function(a,d,c,b){return this.styles[c]&&this.styles[c][b]?this.styles[c][b].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(a,d,c,b){b=b||this.text.split(this._reNewline);b=b[d].split("")[c];return this._getWidthOfChar(a,b,d,c)},_getHeightOfCharAt:function(a,
d,c,b){b=b||this.text.split(this._reNewline);b=b[d].split("")[c];return this._getHeightOfChar(a,b,d,c)},_getWidthOfCharsAt:function(a,d,c,b){for(var e=0,f=0;f<c;f++)e+=this._getWidthOfCharAt(a,d,f,b);return e},_getWidthOfLine:function(a,d,c){return this._getWidthOfCharsAt(a,d,c[d].length,c)},_getWidthOfSpace:function(a,d){var c=this.text.split(this._reNewline)[d],b=c.split(/\s+/);return(this.width-this._getWidthOfWords(a,c,d))/(b.length-1)},_getWidthOfWords:function(a,d,c){for(var b=0,e=0;e<d.length;e++){var f=
d[e];f.match(/\s/)||(b+=this._getWidthOfChar(a,f,c,e))}return b},_getTextWidth:function(a,d){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",a,d);for(var c=this._getWidthOfLine(a,0,d),b=1,e=d.length;b<e;b++){var f=this._getWidthOfLine(a,b,d);f>c&&(c=f)}return c},_getHeightOfLine:function(a,d,c){for(var c=c||this.text.split(this._reNewline),b=this._getHeightOfChar(a,c[d][0],d,0),c=c[d].split(""),e=1,f=c.length;e<f;e++){var h=this._getHeightOfChar(a,c[e],d,e);h>b&&(b=h)}return b*this.lineHeight},
_getTextHeight:function(a,d){for(var c=0,b=0,e=d.length;b<e;b++)c+=this._getHeightOfLine(a,b,d);return c},_getTopOffset:function(){return h.Text.prototype._getTopOffset.call(this)-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(a){if(this.backgroundColor)a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),a.restore()},toObject:function(a){return h.util.object.extend(this.callSuper("toObject",
a),{styles:d(this.styles)})}});h.IText.fromObject=function(a){return new h.IText(a.text,d(a))};h.IText.instances=[]})();(function(){var d=h.util.object.clone;h.util.object.extend(h.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var a=this;setTimeout(function(){a.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){if(this.canvas&&
!this.canvas._hasITextHandlers)this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){h.IText.prototype.exitEditingOnOthers.call()});this.canvas.on("mouse:up",function(){h.IText.instances.forEach(function(a){a.__isMousedown=!1})});this.canvas.on("object:selected",function(a){h.IText.prototype.exitEditingOnOthers.call(a.target)})},_tick:function(){if(!this._abortCursorAnimation){var a=this;this.animate("_currentCursorOpacity",
1,{duration:this.cursorDuration,onComplete:function(){a._onTickComplete()},onChange:function(){a.canvas&&a.canvas.renderAll()},abort:function(){return a._abortCursorAnimation}})}},_onTickComplete:function(){if(!this._abortCursorAnimation){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){a.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){a._tick()},onChange:function(){a.canvas&&a.canvas.renderAll()},
abort:function(){return a._abortCursorAnimation}})},100)}},initDelayedCursor:function(a){var d=this,c=a?0:this.cursorDelay;if(a)this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll();this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){d._abortCursorAnimation=!1;d._tick()},c)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);
this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var a=this;setTimeout(function(){a._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(a){var d=0,c=a-1;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)d++,
c--;for(;/\S/.test(this.text.charAt(c))&&c>-1;)d++,c--;return a-d},findWordBoundaryRight:function(a){var d=0,c=a;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)d++,c++;for(;/\S/.test(this.text.charAt(c))&&c<this.text.length;)d++,c++;return a+d},findLineBoundaryLeft:function(a){for(var d=0,c=a-1;!/\n/.test(this.text.charAt(c))&&c>-1;)d++,c--;return a-d},findLineBoundaryRight:function(a){for(var d=0,c=a;!/\n/.test(this.text.charAt(c))&&c<this.text.length;)d++,
c++;return a+d},getNumNewLinesInSelectedText:function(){for(var a=0,d=0,c=this.getSelectedText().split(""),b=c.length;d<b;d++)c[d]==="\n"&&a++;return a},searchWordBoundary:function(a,d){for(var c=this._reSpace.test(this.text.charAt(a))?a-1:a,b=this.text.charAt(c),e=/[ \n\.,;!\?\-]/;!e.test(b)&&c>0&&c<this.text.length;)c+=d,b=this.text.charAt(c);e.test(b)&&b!=="\n"&&(c+=d===1?0:1);return c},selectWord:function(a){var d=this.searchWordBoundary(a,-1),a=this.searchWordBoundary(a,1);this.setSelectionStart(d);
this.setSelectionEnd(a);this.initDelayedCursor(!0)},selectLine:function(a){var d=this.findLineBoundaryLeft(a),a=this.findLineBoundaryRight(a);this.setSelectionStart(d);this.setSelectionEnd(a);this.initDelayedCursor(!0)},enterEditing:function(){if(!this.isEditing&&this.editable)return this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),
this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){h.IText.instances.forEach(function(a){a.selected=!1;a.isEditing&&a.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";if(this.canvas)this.canvas.defaultCursor=this.canvas.moveCursor="text";this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea)this.hiddenTextarea.value=
this.text,this.hiddenTextarea.selectionStart=this.selectionStart},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,
this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas))this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor},exitEditing:function(){this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;
this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){var a=this.text.split(this._reNewline),d;for(d in this.styles)a[d]||delete this.styles[d]},_removeCharsFromTo:function(a,d){for(var c=d;c!==a;){var b=this.get2DCursorLocation(c).charIndex;c--;(b=this.get2DCursorLocation(c).charIndex>b)?this.removeStyleObject(b,c+1):this.removeStyleObject(this.get2DCursorLocation(c).charIndex===
0,c)}this.text=this.text.slice(0,a)+this.text.slice(d)},insertChars:function(a){var d=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+a+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd&&this.insertStyleObjects(a,d,this.copiedStyles);this.selectionStart+=a.length;this.selectionEnd=this.selectionStart;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",
{target:this})},insertNewlineStyleObject:function(a,g,c){this.shiftLineStyles(a,1);this.styles[a+1]||(this.styles[a+1]={});var b=this.styles[a][g-1],e={};if(c)e[0]=d(b);else for(var f in this.styles[a])parseInt(f,10)>=g&&(e[parseInt(f,10)-g]=this.styles[a][f],delete this.styles[a][f]);this.styles[a+1]=e},insertCharStyleObject:function(a,g,c){var b=this.styles[a],e=d(b);g===0&&!c&&(g=1);for(var f in e){var h=parseInt(f,10);h>=g&&(b[h+1]=e[h])}this.styles[a][g]=c||d(b[g-1])},insertStyleObjects:function(a,
d,c){var b=this.get2DCursorLocation(),e=b.lineIndex,b=b.charIndex;this.styles[e]||(this.styles[e]={});a==="\n"?this.insertNewlineStyleObject(e,b,d):c?this._insertStyles(c):this.insertCharStyleObject(e,b)},_insertStyles:function(a){for(var d=0,c=a.length;d<c;d++){var b=this.get2DCursorLocation(this.selectionStart+d);this.insertCharStyleObject(b.lineIndex,b.charIndex,a[d])}},shiftLineStyles:function(a,g){var c=d(this.styles),b;for(b in this.styles){var e=parseInt(b,10);e>a&&(this.styles[e+g]=c[e])}},
removeStyleObject:function(a,g){var c=this.get2DCursorLocation(g),b=c.lineIndex,c=c.charIndex;if(a){var e=this.text.split(this._reNewline)[b-1],e=e?e.length:0;this.styles[b-1]||(this.styles[b-1]={});for(c in this.styles[b])this.styles[b-1][parseInt(c,10)+e]=this.styles[b][c];this.shiftLineStyles(b,-1)}else{(b=this.styles[b])&&delete b[c+(this.selectionStart===this.selectionEnd?-1:0)];var f=d(b);for(e in f){var h=parseInt(e,10);h>=c&&h!==0&&(b[h-1]=f[h],delete b[h])}}},insertNewline:function(){this.insertChars("\n")}})})();
h.util.object.extend(h.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(d){this.__newClickTime=+new Date;var a=this.canvas.getPointer(d.e);this.isTripleClick(a)?(this.fire("tripleclick",d),this._stopEvent(d.e)):this.isDoubleClick(a)&&(this.fire("dblclick",d),this._stopEvent(d.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=
this.__newClickTime;this.__lastPointer=a;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y&&this.__lastIsEditing},isTripleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y},_stopEvent:function(d){d.preventDefault&&d.preventDefault();
d.stopPropagation&&d.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(d){this.selectWord(this.getSelectionStartFromPointer(d.e))});this.on("tripleclick",function(d){this.selectLine(this.getSelectionStartFromPointer(d.e))})},initMousedownHandler:function(){this.on("mousedown",function(d){var a=this.canvas.getPointer(d.e);
this.__mousedownX=a.x;this.__mousedownY=a.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(d.e);if(this.isEditing)this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0)})},initMousemoveHandler:function(){this.on("mousemove",function(d){this.__isMousedown&&this.isEditing&&(d=this.getSelectionStartFromPointer(d.e),d>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),
this.setSelectionEnd(d)):(this.setSelectionStart(d),this.setSelectionEnd(this.__selectionStartOnMouseDown)))})},_isObjectMoved:function(d){d=this.canvas.getPointer(d);return this.__mousedownX!==d.x||this.__mousedownY!==d.y},initMouseupHandler:function(){this.on("mouseup",function(d){this.__isMousedown=!1;if(!this._isObjectMoved(d.e))this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0})},setCursorByClick:function(d){var a=this.getSelectionStartFromPointer(d);d.shiftKey?
a<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(a)):this.setSelectionEnd(a):(this.setSelectionStart(a),this.setSelectionEnd(a))},_getLocalRotatedPointer:function(d){var a=this.canvas.getPointer(d),a=new h.Point(a.x,a.y),g=new h.Point(this.left,this.top),a=h.util.rotatePoint(a,g,h.util.degreesToRadians(-this.angle));return this.getLocalPointer(d,a)},getSelectionStartFromPointer:function(d){for(var d=this._getLocalRotatedPointer(d),a=this.text.split(this._reNewline),
g=0,c=0,b=0,e=0,f=0,h=a.length;f<h;f++){b+=this._getHeightOfLine(this.ctx,f)*this.scaleY;c=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,f,a))*this.scaleX;this.flipX&&(a[f]=a[f].split("").reverse().join(""));for(var j=0,l=a[f].length;j<l;j++){var i=a[f][j],g=c;c+=this._getWidthOfChar(this.ctx,i,f,this.flipX?l-j:j)*this.scaleX;if(b<=d.y||c<=d.x)e++;else return this._getNewSelectionStartFromOffset(d,g,c,e+f,l)}if(d.y<b)return this._getNewSelectionStartFromOffset(d,g,c,e+f,l)}return this.text.length},
_getNewSelectionStartFromOffset:function(d,a,g,c,b){d=c+(g-d.x>d.x-a?0:1);this.flipX&&(d=b-d);if(d>this.text.length)d=this.text.length;return d}});h.util.object.extend(h.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=h.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;";h.document.body.appendChild(this.hiddenTextarea);
h.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));h.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));h.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));h.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));if(!this._clickHandlerInitialized&&this.canvas)h.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",
13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(d){if(this.isEditing){if(d.keyCode in this._keysMap)this[this._keysMap[d.keyCode]](d);else if(d.keyCode in this._ctrlKeysMap&&(d.ctrlKey||d.metaKey))this[this._ctrlKeysMap[d.keyCode]](d);
else return;d.stopImmediatePropagation();d.preventDefault();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(d){this.selectionStart===this.selectionEnd&&this.moveCursorRight(d);this.removeChars(d)},copy:function(d){var a=this.getSelectedText();(d=this._getClipboardData(d))&&d.setData("text",a);this.copiedText=a;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(d){var a=null;(a=(d=this._getClipboardData(d))?d.getData("text"):this.copiedText)&&
this.insertChars(a)},cut:function(d){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(d))},_getClipboardData:function(d){return d&&(d.clipboardData||h.window.clipboardData)},onKeyPress:function(d){this.isEditing&&!d.metaKey&&!d.ctrlKey&&(d.which!==0&&this.insertChars(String.fromCharCode(d.which)),d.stopPropagation())},getDownCursorOffset:function(d,a){var g=a?this.selectionEnd:this.selectionStart,c=this.text.split(this._reNewline),b=this.text.slice(0,g),e=this.text.slice(g),
f=b.slice(b.lastIndexOf("\n")+1),b=e.match(/(.*)\n?/)[1],e=(e.match(/.*\n(.*)\n?/)||{})[1]||"",h=this.get2DCursorLocation(g);if(h.lineIndex===c.length-1||d.metaKey||d.keyCode===34)return this.text.length-g;for(var j=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,h.lineIndex,c)),l=h.lineIndex,i=0,n=f.length;i<n;i++)g=f[i],j+=this._getWidthOfChar(this.ctx,g,l,i);c=this._getIndexOnNextLine(h,e,j,c);return b.length+1+c},_getIndexOnNextLine:function(d,a,g,c){for(var d=d.lineIndex+1,b=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,
d,c)),e=0,f,c=0,h=a.length;c<h;c++){var j=this._getWidthOfChar(this.ctx,a[c],d,c);b+=j;if(b>g){f=!0;d=b;b=Math.abs(b-j-g);e=Math.abs(d-g)<b?c+1:c;break}}if(!f)e=a.length;return e},moveCursorDown:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var a=this.getDownCursorOffset(d,this._selectionDirection==="right");d.shiftKey?this.moveCursorDownWithShift(a):this.moveCursorDownWithoutShift(a);this.initDelayedCursor()},moveCursorDownWithoutShift:function(d){this._selectionDirection=
"right";this.selectionStart+=d;if(this.selectionStart>this.text.length)this.selectionStart=this.text.length;this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},swapSelectionPoints:function(){var d=this.selectionEnd;this.selectionEnd=this.selectionStart;this.selectionStart=d},moveCursorDownWithShift:function(d){if(this.selectionEnd===this.selectionStart)this._selectionDirection="right";this[this._selectionDirection===
"right"?"selectionEnd":"selectionStart"]+=d;if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="left")this.swapSelectionPoints(),this._selectionDirection="right";if(this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getUpCursorOffset:function(d,a){var g=a?this.selectionEnd:this.selectionStart,c=this.get2DCursorLocation(g);if(c.lineIndex===0||d.metaKey||d.keyCode===
33)return g;for(var b=this.text.slice(0,g),g=b.slice(b.lastIndexOf("\n")+1),b=(b.match(/\n?(.*)\n.*$/)||{})[1]||"",e=this.text.split(this._reNewline),f,h=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,c.lineIndex,e)),j=c.lineIndex,l=0,i=g.length;l<i;l++)f=g[l],h+=this._getWidthOfChar(this.ctx,f,j,l);c=this._getIndexOnPrevLine(c,b,h,e);return b.length-c+g.length},_getIndexOnPrevLine:function(d,a,g,c){for(var d=d.lineIndex-1,b=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,d,c)),e=0,f,
c=0,h=a.length;c<h;c++){var j=this._getWidthOfChar(this.ctx,a[c],d,c);b+=j;if(b>g){f=!0;d=b;b=Math.abs(b-j-g);e=Math.abs(d-g)<b?c:c-1;break}}f||(e=a.length-1);return e},moveCursorUp:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var a=this.getUpCursorOffset(d,this._selectionDirection==="right");d.shiftKey?this.moveCursorUpWithShift(a):this.moveCursorUpWithoutShift(a);this.initDelayedCursor()},moveCursorUpWithShift:function(d){if(this.selectionEnd===this.selectionStart)this._selectionDirection=
"left";this[this._selectionDirection==="right"?"selectionEnd":"selectionStart"]-=d;if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="right")this.swapSelectionPoints(),this._selectionDirection="left";if(this.selectionStart<0)this.selectionStart=0;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorUpWithoutShift:function(d){this.selectionStart===this.selectionEnd&&(this.selectionStart-=d);if(this.selectionStart<0)this.selectionStart=
0;this.selectionEnd=this.selectionStart;this._selectionDirection="left";this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeft:function(d){if(!(this.selectionStart===0&&this.selectionEnd===0))this.abortCursorAnimation(),this._currentCursorOpacity=1,d.shiftKey?this.moveCursorLeftWithShift(d):this.moveCursorLeftWithoutShift(d),this.initDelayedCursor()},_move:function(d,a,g){d.altKey?this[a]=this["findWordBoundary"+g](this[a]):d.metaKey||
d.keyCode===35||d.keyCode===36?this[a]=this["findLineBoundary"+g](this[a]):this[a]+=g==="Left"?-1:1},_moveLeft:function(d,a){this._move(d,a,"Left")},_moveRight:function(d,a){this._move(d,a,"Right")},moveCursorLeftWithoutShift:function(d){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(d,"selectionStart");this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeftWithShift:function(d){if(this._selectionDirection===
"right"&&this.selectionStart!==this.selectionEnd)this._moveLeft(d,"selectionEnd");else if(this._selectionDirection="left",this._moveLeft(d,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.selectionStart--,this.selectionStart<0)this.selectionStart=0;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRight:function(d){if(!(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length))this.abortCursorAnimation(),
this._currentCursorOpacity=1,d.shiftKey?this.moveCursorRightWithShift(d):this.moveCursorRightWithoutShift(d),this.initDelayedCursor()},moveCursorRightWithShift:function(d){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)this._moveRight(d,"selectionStart");else if(this._selectionDirection="right",this._moveRight(d,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.selectionEnd++,this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.fire("selection:changed");
this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRightWithoutShift:function(d){this._selectionDirection="right";if(this.selectionStart===this.selectionEnd)this._moveRight(d,"selectionStart"),this.selectionEnd=this.selectionStart;else{this.selectionEnd+=this.getNumNewLinesInSelectedText();if(this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.selectionStart=this.selectionEnd}this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",
{target:this})},removeChars:function(d){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(d):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(d){if(this.selectionStart!==0)d.metaKey?(d=this.findLineBoundaryLeft(this.selectionStart),
this._removeCharsFromTo(d,this.selectionStart),this.selectionStart=d):d.altKey?(d=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(d,this.selectionStart),this.selectionStart=d):(this.removeStyleObject(this.text.slice(this.selectionStart-1,this.selectionStart)==="\n"),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1))}});h.util.object.extend(h.IText.prototype,{_setSVGTextLineText:function(d,a,g,c,b,e){this.styles[a]?
this._setSVGTextLineChars(d,a,g,c,b,e):this.callSuper("_setSVGTextLineText",d,a,g,c,b)},_setSVGTextLineChars:function(d,a,g,c,b,e){for(var c=a===0||this.useNative?"y":"dy",d=d.split(""),b=0,f=this._getSVGLineLeftOffset(a),h=this._getSVGLineTopOffset(a),j=this._getHeightOfLine(this.ctx,a),l=0,i=d.length;l<i;l++){var n=this.styles[a][l]||{};g.push(this._createTextCharSpan(d[l],n,f,h,c,b));var p=this._getWidthOfChar(this.ctx,d[l],a,l);n.textBackgroundColor&&e.push(this._createTextCharBg(n,f,h,j,p,b));
b+=p}},_getSVGLineLeftOffset:function(d){return this._boundaries&&this._boundaries[d]?h.util.toFixed(this._boundaries[d].left,2):0},_getSVGLineTopOffset:function(d){for(var a=0,g=0;g<=d;g++)a+=this._getHeightOfLine(this.ctx,g);return a-this.height/2},_createTextCharBg:function(d,a,g,c,b,e){return['<rect fill="',d.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+c,')" x="',a+e,'" y="',g+c,'" width="',b,'" height="',c,'"></rect>'].join("")},_createTextCharSpan:function(d,
a,g,c,b,e){var f=this.getSvgStyles.call(h.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},a));return['<tspan x="',g+e,'" ',b,'="',c,'" ',a.fontFamily?'font-family="'+a.fontFamily.replace(/"/g,"'")+'" ':"",a.fontSize?'font-size="'+a.fontSize+'" ':"",a.fontStyle?'font-style="'+a.fontStyle+'" ':"",a.fontWeight?'font-weight="'+a.fontWeight+'" ':"",a.textDecoration?'text-decoration="'+a.textDecoration+'" ':"",'style="',f,'">',h.util.string.escapeXml(d),"</tspan>"].join("")}});
(function(){function d(a,d,f){var g=c.parse(a);if(!g.port)g.port=g.protocol.indexOf("https:")===0?443:80;a=(g.port===443?e:b).request({hostname:g.hostname,port:g.port,path:g.path,method:"GET"},function(a){var b="";d&&a.setEncoding(d);a.on("end",function(){f(b)});a.on("data",function(c){a.statusCode===200&&(b+=c)})});a.on("error",function(a){a.errno===process.ECONNREFUSED?h.log("ECONNREFUSED: connection refused to "+g.hostname+":"+g.port):h.log(a.message)});a.end()}function a(a,b){require("fs").readFile(a,
function(a,c){if(a)throw h.log(a),a;else b(c)})}if(!(typeof document!=="undefined"&&typeof B!=="undefined")){var g=require("xmldom").DOMParser,c=require("url"),b=require("http"),e=require("https"),f=require("canvas"),j=require("canvas").Image;h.util.loadImage=function(b,c,e){function f(a){g.src=new Buffer(a,"binary");g._src=b;c&&c.call(e,g)}var g=new j;b&&(b instanceof Buffer||b.indexOf("data")===0)?(g.src=g._src=b,c&&c.call(e,g)):b&&b.indexOf("http")!==0?a(b,f):b?d(b,"binary",f):c&&c.call(e,b)};
h.loadSVGFromURL=function(b,c,e){b=b.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();b.indexOf("http")!==0?a(b,function(a){h.loadSVGFromString(a.toString(),c,e)}):d(b,"",function(a){h.loadSVGFromString(a,c,e)})};h.loadSVGFromString=function(a,b,c){a=(new g).parseFromString(a);h.parseSVGDocument(a.documentElement,function(a,c){b&&b(a,c)},c)};h.util.getScript=function(a,b){d(a,"",function(a){eval(a);b&&b()})};h.Image.fromObject=function(a,b){h.util.loadImage(a.src,function(c){var d=new h.Image(c);d._initConfig(a);
d._initFilters(a,function(a){d.filters=a||[];b&&b(d)})})};h.createCanvasForNode=function(a,b,c,d){var d=d||c,e=h.document.createElement("canvas"),a=new f(a||600,b||600,d);e.style={};e.width=a.width;e.height=a.height;c=new (h.Canvas||h.StaticCanvas)(e,c);c.contextContainer=a.getContext("2d");c.nodeCanvas=a;c.Font=f.Font;return c};h.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};h.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};
var l=h.StaticCanvas.prototype.setWidth;h.StaticCanvas.prototype.setWidth=function(a,b){l.call(this,a,b);this.nodeCanvas.width=a;return this};if(h.Canvas)h.Canvas.prototype.setWidth=h.StaticCanvas.prototype.setWidth;var o=h.StaticCanvas.prototype.setHeight;h.StaticCanvas.prototype.setHeight=function(a,b){o.call(this,a,b);this.nodeCanvas.height=a;return this};if(h.Canvas)h.Canvas.prototype.setHeight=h.StaticCanvas.prototype.setHeight}})();B.fabric=h;j=j||{};j.fabric=h;typeof define==="function"&&define.amd&&
define([],function(){return h});return h})})})(function(){var s=window.AmazonUIPageJS||window.P,B=s._namespace||s.attributeErrors;return B?B("AmazonCustomFabricJS"):s}(),window);
(function(s,B,u){s.execute(function(){(function(){s.when("A","ready").register("BuyBox",function(l){return function(j){function h(){var a={},b={};g.controller!==u&&(a=g.controller.getJSON());b.customizationData=JSON.stringify(a);if(j("#amazonCustomUseCaseId").length)b.clientId=j("#amazonCustomUseCaseId").val();j(".pc-error-container").hide();l.post("/gp/product/features/callSetCustomizationDatav2.html",{dataType:"json",params:b,contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(a){a.result.Status===
"OK"&&a.result.pcToken!==u?(l.trigger("amazon-custom-log-ref-tag","AddToCartClick"),j("#UNIQ-pcToken",j(".pc-buy-box")).val(a.result.pcToken),j("#addToCart").submit()):j(".pc-error-container").show()},error:function(){j(".pc-error-container").show()}})}function d(a){var b=j("#pc-atc"),c=j(".pc-atc-wrapper");a?(b.prop("disabled",!1),c.removeClass("a-button-disabled")):(b.prop("disabled",!0),c.addClass("a-button-disabled"))}var a={$el:u,showLabel:!0,controller:u},g={},c=function(b){g=j.extend({},a,
b);return this};c.prototype.getComponentName=function(){return"BuyBox"};c.prototype.Init=function(){b.Bind()};var b={Bind:function(){l.declarative("upload-metadata","click",function(a){a.$event.preventDefault();j("#pc-atc").is(":disabled")||(l.trigger("amazon-custom-popup-close",new Date),h())});l.on("enableBuybox",function(){d(!0)});l.on("disableBuybox",function(){d(!1)})}};return c}(l.$)})})()})})(function(){var s=window.AmazonUIPageJS||window.P,B=s._namespace||s.attributeErrors;return B?B("AmazonCustomBuyBoxAssets"):
s}(),window);